import{d as Rt,r,a5 as Wt,c as Fe,o as Bt,Q as De,g as zt,a as Y,b as a,v as Ue,B as Ve,e as Pt,n as $t,t as L,w as Oe,T as Le,u as Et,f as Z,E as M,$ as ee,p as Ge,l as Je,G as te,F as Ft,h as Dt,a6 as Ut,_ as Vt}from"./index-DXkEbGdZ.js";import{b as Ot}from"./back-icon-xKqy7r3s.js";import{s as Lt}from"./settings-icon-DJLQOoae.js";const Gt={class:"roulette-page"},Jt=["src"],qt=["aria-expanded"],jt=["src"],Ht={class:"wheel-container"},Xt=["disabled"],Kt={key:0,class:"muted"},Qt={class:"popup",role:"dialog","aria-modal":"true","aria-labelledby":"popupText"},Yt={class:"popup-card"},Zt={id:"popupText",class:"pop-value"},en={class:"pop-actions"},tn=["disabled"],nn={class:"popup-card settings-card"},ln={class:"tabs",role:"tablist","aria-label":"Wheel type"},an=["aria-selected"],sn=["aria-selected"],on={class:"tab-panel",role:"tabpanel","aria-label":"Numbers settings"},rn={class:"row"},un={class:"controls-inline"},cn={class:"row"},dn={class:"controls-inline"},fn={class:"tab-panel",role:"tabpanel","aria-label":"Words settings"},vn={class:"row words-head"},mn={class:"words-meta"},hn={class:"words-count"},pn=["disabled"],bn={class:"words-list","aria-label":"Word values list"},gn=["onUpdate:modelValue","placeholder"],wn=["onClick","disabled"],_n={class:"actions"},yn={class:"actions-left"},xn=["disabled"],qe=100,P=12,Sn=6e3,je=1.25,Mn=6,Tn=Rt({__name:"RouletteWheel",setup(In){const we=Et(),ne=r(null);let $=null;const E=r(J("rw_start",1)),F=r(J("rw_end",32)),D=r(G("rw_exclude","")),y=r(Ye()),f=r(Qe()),h=r(et()),v=r([]),m=r([]),C=r(!1),T=r(!1),I=r(!1),R=r(null),W=r(null),B=r(ke()),p=r("numbers"),c=r([]);let U=-Math.PI/2,z=U,le=0,ae=0,k=null;const He=new Audio(Wt),_e=r("sample"),ye=r("single"),xe=r(.25),Xe=r([Ut]);let se=null,g=[],oe=0;const Se=r(null);let re=null;function Ke(){window.history.length>1?we.back():we.push("/")}function G(e,n){try{return localStorage.getItem(e)??n}catch{return n}}function J(e,n){const t=G(e,String(n)),l=Number(t);return Number.isFinite(l)?l:n}function Qe(){return G("rw_mode","numbers")==="words"?"words":"numbers"}function ie(){try{localStorage.setItem("rw_mode",f.value)}catch{}}function Ye(){try{const e=localStorage.getItem("rw_numbers");if(!e)return q(J("rw_start",1),J("rw_end",32),G("rw_exclude",""));const n=JSON.parse(e);if(Array.isArray(n)&&n.every(t=>Number.isInteger(t)))return n}catch{}return q(1,32,"")}function Ze(){try{localStorage.setItem("rw_start",String(E.value)),localStorage.setItem("rw_end",String(F.value)),localStorage.setItem("rw_exclude",D.value)}catch{}}function Me(){try{localStorage.setItem("rw_numbers",JSON.stringify(y.value))}catch{}}function et(){try{const e=localStorage.getItem("rw_words");if(!e)return[];const n=JSON.parse(e);if(Array.isArray(n))return n.map(t=>typeof t=="string"?t.trim():"").filter(t=>t.length>0).slice(0,P)}catch{}return[]}function tt(){try{localStorage.setItem("rw_words",JSON.stringify(h.value))}catch{}}function ue(){v.value=[...y.value],m.value=[...h.value],x(A())}function nt(e){return e.split(",").map(n=>Number(n.trim())).filter(n=>Number.isInteger(n))}function q(e,n,t){const l=Math.min(e,n),s=Math.max(e,n),o=new Set(nt(t)),i=[];for(let u=l;u<=s;u++)o.has(u)||i.push(u);return i}function lt(){const e=q(E.value,F.value,D.value);if(e.length>qe){alert(`You must have ${qe} segments or less.`);return}Ze(),JSON.stringify(e),JSON.stringify(y.value),y.value=e,Me(),f.value="numbers",ie(),ue()}function Te(){c.value.length||(c.value=h.value.length?[...h.value]:[""])}function at(e){return e.map(n=>(n??"").trim()).filter(n=>n.length>0).slice(0,P)}function st(){const e=at(c.value);if(e.length===0){alert("Please add at least one word value (empty rows are ignored).");return}h.value=e,tt(),c.value=[...e],f.value="words",ie(),ue()}function ot(){c.value.length>=P||c.value.push("")}function rt(e){c.value.length<=1||c.value.splice(e,1)}function Ie(e){p.value=e,e==="words"&&Te()}function it(){p.value==="numbers"?lt():st()}const N=Fe(()=>f.value==="words"?m.value.map(e=>e.trim()).filter(e=>e.length>0).slice(0,P):v.value.map(e=>String(e)));function ut(){if(N.value.length){if(f.value==="numbers"){if(!v.value.length)return;for(let e=v.value.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[v.value[e],v.value[n]]=[v.value[n],v.value[e]]}}else{if(!m.value.length)return;for(let e=m.value.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[m.value[e],m.value[n]]=[m.value[n],m.value[e]]}}x(A())}}function ke(){const e=Math.max(320,Math.min(window.innerWidth,1600)),n=Math.max(400,Math.min(window.innerHeight,1200)),t=Math.round(Math.min(e,n)*.72);return Math.max(300,Math.min(720,t))}function ce(){const e=ne.value;if(!e)return;const n=B.value,t=window.devicePixelRatio||1;e.style.width=n+"px",e.style.height=n+"px",e.width=Math.floor(n*t),e.height=Math.floor(n*t),$=e.getContext("2d"),$&&($.setTransform(1,0,0,1,0,0),$.scale(t,t))}function ct(){const e=ke();e!==B.value&&(B.value=e,ce(),x(A()))}function dt(e){return e>=1?1:1-Math.pow(2,-10*e)}function A(){if(!C.value)return z;const e=performance.now(),n=Math.min(1,(e-le)/ae),t=dt(n);return U+(z-U)*t}function ft(){const e=Math.random(),n=e*e*(3-2*e);return je+n*(Mn-je)}function vt(e,n,t,l){const s=n.reduce((i,u)=>Math.max(i,(u??"").length),0);if(s<=3)return t;const o=Math.max(.55,Math.min(1,9/(s+2)));return Math.max(l,Math.round(t*o))}function mt(e,n,t){const l=n??"";if(e.measureText(l).width<=t)return l;const s="…";if(e.measureText(s).width>t)return s;let o=0,i=l.length;for(;o<i;){const u=Math.floor((o+i+1)/2),S=l.slice(0,u)+s;e.measureText(S).width<=t?o=u:i=u-1}return l.slice(0,o)+s}function x(e){const n=ne.value;if(!n)return null;const t=$??n.getContext("2d");if(!t)return null;const l=B.value,s=l,o=l;t.clearRect(0,0,s,o);const i=N.value;if(i.length===0)return null;const u=i.length,S=2*Math.PI/u,w=s/2,_=o/2,b=Math.round(l*.45),Re=[];for(let d=0;d<u;d++){const K=((e+d*S+S/2)*180/Math.PI+360)%360;Re.push({index:d,angleDeg:K})}const V=Ne(Re,270);Se.value=V;const Tt=210,It=8,j=50,We=62,he=54,kt=performance.now(),H=.62+.38*Math.abs(Math.sin(kt/160)),Be=Math.max(14,Math.min(22,b*.12)),ze=f.value==="words"?vt(t,i,Be,12):Be,X=b-Math.max(34,b*.2),Nt=Math.max(28,X*S*.92);for(let d=0;d<u;d++){const O=e+d*S,K=O+S,At=O+S/2,Q=Tt+(d%4-1.5)*(It/1),Ct=`hsl(${Q} ${j}% ${d%2===0?We:he}%)`;if(t.beginPath(),t.moveTo(w,_),t.arc(w,_,b,O,K),t.closePath(),d===V){const ge=t.createRadialGradient(w,_,b*.18,w,_,b);ge.addColorStop(0,`hsla(${Q} ${j+10}% ${We+8}% / ${.9*H})`),ge.addColorStop(1,`hsla(${Q} ${j+10}% ${he-8}% / ${.92*H})`),t.fillStyle=ge,t.shadowColor=`hsla(${Q} ${j+25}% ${he-14}% / ${.9*H})`,t.shadowBlur=24*H}else t.fillStyle=Ct,t.shadowBlur=0;t.fill(),t.strokeStyle="rgba(0,0,0,.18)",t.lineWidth=1,t.stroke(),d===V&&(t.save(),t.beginPath(),t.arc(w,_,b,O,K),t.strokeStyle="rgba(255,255,255,.95)",t.lineWidth=Math.max(3,b*.035),t.shadowColor="rgba(160,200,255,.9)",t.shadowBlur=20,t.stroke(),t.restore()),t.save(),t.translate(w,_),t.rotate(At),t.textAlign="center",t.textBaseline="middle";const Pe=d===V,$e=Pe?ze*1.22:ze;t.font=`800 ${$e}px system-ui, -apple-system, Segoe UI, Arial`;const Ee=i[d]??"",be=f.value==="words"?mt(t,Ee,Nt):Ee;Pe?(t.lineJoin="round",t.miterLimit=2,t.strokeStyle="rgba(255,255,255,.95)",t.lineWidth=Math.max(3,$e*.14),t.strokeText(be,X,0),t.fillStyle="#0b1a2b",t.fillText(be,X,0)):(t.fillStyle="rgba(0,0,0,.82)",t.fillText(be,X,0)),t.restore()}t.beginPath(),t.arc(w,_,Math.max(10,b*.06),0,2*Math.PI);const pe=t.createRadialGradient(w,_,2,w,_,b*.08);return pe.addColorStop(0,"#ffffff"),pe.addColorStop(1,"#e8edf6"),t.fillStyle=pe,t.fill(),t.strokeStyle="rgba(0,0,0,.15)",t.stroke(),V}function Ne(e,n=270){if(!e.length)return null;let t=0,l=360;for(let s=0;s<e.length;s++){let o=Math.abs((e[s].angleDeg-n+360)%360);o>180&&(o=360-o),o<l&&(l=o,t=s)}return e[t].index}function de(){if(N.value.length===0||C.value||T.value||I.value)return;fe()&&bt();const n=ft(),t=Math.random()*(2*Math.PI);U=A(),z=U+n*(2*Math.PI)+t,ae=Sn,le=performance.now(),C.value=!0,re=null,k=requestAnimationFrame(Ae)}function Ae(){const e=performance.now(),n=Math.min(1,(e-le)/ae),t=A(),l=x(t);l!==null&&l!==re&&(re=l,wt()),n<1?k=requestAnimationFrame(Ae):(C.value=!1,k&&cancelAnimationFrame(k),k=null,x(z),setTimeout(ht,280))}function ht(){const e=N.value;if(e.length===0)return;const n=e.length,t=2*Math.PI/n,l=[];for(let o=0;o<n;o++){const u=((z+o*t+t/2)*180/Math.PI+360)%360;l.push({index:o,angleDeg:u})}const s=Ne(l,270);Se.value=s,R.value=s,W.value=s==null?null:e[s]??null;try{const o=He;o.currentTime=0,o.play()}catch{}T.value=!0}function fe(){const e=window.AudioContext||window.webkitAudioContext;if(!e)return null;se||(se=new e);const n=se;return n.state==="suspended"&&n.resume(),n}async function pt(e){const n=fe();if(!n)return null;try{const l=await(await fetch(e)).arrayBuffer();return await n.decodeAudioData(l)}catch{return null}}async function bt(){if(g.length||_e.value!=="sample")return;const e=Xe.value.slice();g=(await Promise.all(e.map(t=>pt(t)))).filter(t=>!!t),oe=0}function gt(){if(!g.length)return null;if(ye.value==="single")return g[0];if(ye.value==="random"){const n=Math.floor(Math.random()*g.length);return g[n]}const e=g[oe%g.length];return oe++,e}function wt(){const e=fe();if(e){if(_e.value==="sample"&&g.length){const n=gt();if(n){const t=e.createBufferSource();t.buffer=n;const l=e.createGain();l.gain.value=xe.value,t.connect(l).connect(e.destination),t.start();return}}_t(e)}}function _t(e){const n=e.createOscillator(),t=e.createGain(),l=e.currentTime,s=1100,o=(Math.random()-.5)*120;n.type="square",n.frequency.setValueAtTime(s+o,l);const i=Math.max(.05,Math.min(1,xe.value));t.gain.setValueAtTime(0,l),t.gain.linearRampToValueAtTime(.22*i,l+.006),t.gain.exponentialRampToValueAtTime(1e-4,l+.07),n.connect(t).connect(e.destination),n.start(l),n.stop(l+.08)}function yt(){I.value=!0,p.value=f.value,p.value==="words"&&(c.value=h.value.length?[...h.value]:[""],Te())}function ve(){I.value=!1}function xt(){if(R.value!=null){if(f.value==="numbers"){const e=W.value;if(e==null)return;const n=Number(e);if(!Number.isFinite(n))return;v.value=v.value.filter(t=>t!==n)}else{const e=R.value;if(e<0||e>=m.value.length)return;m.value.splice(e,1)}T.value=!1,R.value=null,W.value=null,x(A())}}function Ce(){T.value=!1,R.value=null,W.value=null}const St=Fe(()=>W.value==null?"":String(W.value)),me=[];Bt(()=>{y.value.length||(y.value=q(E.value,F.value,D.value),Me()),f.value==="words"&&h.value.length===0&&(f.value="numbers",ie()),v.value=[...y.value],m.value=[...h.value],ce(),x(z);const e=t=>{t.code==="Space"&&!T.value&&!I.value&&(t.preventDefault(),de()),t.code==="Escape"&&(T.value?(t.preventDefault(),Ce()):I.value&&(t.preventDefault(),ve()))},n=Mt(ct,100);window.addEventListener("keydown",e),window.addEventListener("resize",n),me.push(()=>window.removeEventListener("keydown",e)),me.push(()=>window.removeEventListener("resize",n))}),De([y,h,f],()=>{ue()}),De([B],()=>{ce(),x(A())}),zt(()=>{k&&cancelAnimationFrame(k),me.forEach(e=>e())});function Mt(e,n){let t=0,l=null;return function(...s){const o=Date.now();o-t>=n?(t=o,e.apply(this,s)):l||(l=window.setTimeout(()=>{t=Date.now(),l=null,e.apply(this,s)},n-(o-t)))}}return(e,n)=>(Z(),Y("section",Gt,[a("button",{class:"home-button",type:"button",onClick:Ke,"aria-label":"Back"},[a("img",{src:Ve(Ot),alt:""},null,8,Jt)]),a("button",{class:"settings-button",type:"button",onClick:yt,"aria-label":"Open settings","aria-expanded":I.value?"true":"false","aria-controls":"settingsModal"},[a("img",{src:Ve(Lt),alt:""},null,8,jt)],8,qt),a("div",Ht,[a("div",{class:"wheel-wrap",style:$t({"--wheel-size":B.value+"px"}),onClick:de},[n[5]||(n[5]=a("div",{class:"indicator","aria-hidden":"true"},null,-1)),a("canvas",{ref_key:"canvasEl",ref:ne,class:"wheel"},null,512)],4),a("button",{id:"spinButton",class:"spin-btn",type:"button",disabled:N.value.length===0||C.value,onClick:de,"aria-live":"polite"},L(C.value?"SPINNING…":"SPIN"),9,Xt),N.value.length===0?(Z(),Y("p",Kt," No values. Open settings to configure "+L(f.value==="numbers"?"a range":"word entries")+". ",1)):Pt("",!0)]),Ue(Le,{name:"fade-zoom"},{default:Oe(()=>[M(a("div",Qt,[a("div",Yt,[a("h2",Zt,L(St.value),1),a("div",en,[a("button",{class:"btn subtle",type:"button",onClick:xt,disabled:R.value==null}," Remove Value ",8,tn),a("button",{class:"btn",type:"button",onClick:Ce},"Continue")])])],512),[[ee,T.value]])]),_:1}),Ue(Le,{name:"fade-zoom"},{default:Oe(()=>[M(a("div",{class:"popup",role:"dialog","aria-modal":"true","aria-labelledby":"settingsTitle",id:"settingsModal",onClick:Je(ve,["self"])},[a("div",nn,[n[11]||(n[11]=a("h2",{id:"settingsTitle",class:"settings-title"},"Settings",-1)),a("div",ln,[a("button",{class:Ge(["tab",{"is-active":p.value==="numbers"}]),type:"button",role:"tab","aria-selected":p.value==="numbers"?"true":"false",onClick:n[0]||(n[0]=t=>Ie("numbers"))}," Numbers ",10,an),a("button",{class:Ge(["tab",{"is-active":p.value==="words"}]),type:"button",role:"tab","aria-selected":p.value==="words"?"true":"false",onClick:n[1]||(n[1]=t=>Ie("words"))}," Words ",10,sn)]),a("form",{class:"settings-form",onSubmit:Je(it,["prevent"])},[M(a("div",on,[a("div",rn,[n[7]||(n[7]=a("label",{for:"startNum",class:"lbl"},"Range:",-1)),a("div",un,[M(a("input",{id:"startNum",class:"num",type:"number","onUpdate:modelValue":n[2]||(n[2]=t=>E.value=t),min:"1",inputmode:"numeric"},null,512),[[te,E.value,void 0,{number:!0}]]),n[6]||(n[6]=a("span",{class:"dash"},"-",-1)),M(a("input",{id:"endNum",class:"num",type:"number","onUpdate:modelValue":n[3]||(n[3]=t=>F.value=t),min:"1",inputmode:"numeric"},null,512),[[te,F.value,void 0,{number:!0}]])])]),a("div",cn,[n[8]||(n[8]=a("label",{for:"excludeInput",class:"lbl"},"Exclude:",-1)),a("div",dn,[M(a("input",{id:"excludeInput",class:"ex-input",type:"text","onUpdate:modelValue":n[4]||(n[4]=t=>D.value=t),placeholder:"e.g., 3,7,15","aria-label":"Exclude numbers"},null,512),[[te,D.value,void 0,{trim:!0}]])])])],512),[[ee,p.value==="numbers"]]),M(a("div",fn,[a("div",vn,[n[9]||(n[9]=a("div",{class:"lbl words-lbl"},"Values:",-1)),a("div",mn,[a("span",hn,L(c.value.length)+"/"+L(P),1),a("button",{class:"btn subtle sm",type:"button",onClick:ot,disabled:c.value.length>=P}," + Add ",8,pn)])]),a("div",bn,[(Z(!0),Y(Ft,null,Dt(c.value,(t,l)=>(Z(),Y("div",{key:`word-${l}`,class:"word-row"},[M(a("input",{class:"word-input",type:"text","onUpdate:modelValue":s=>c.value[l]=s,placeholder:`Value ${l+1}`,maxlength:"80","aria-label":"Word value"},null,8,gn),[[te,c.value[l],void 0,{trim:!0}]]),a("button",{class:"icon-btn",type:"button",onClick:s=>rt(l),disabled:c.value.length<=1,"aria-label":"Remove value",title:"Remove"}," ✕ ",8,wn)]))),128))])],512),[[ee,p.value==="words"]]),a("div",_n,[a("div",yn,[a("button",{class:"btn rand sm",type:"button",disabled:N.value.length===0,onClick:ut,"aria-label":"Randomize the order of values on the wheel"}," Randomize ",8,xn)]),a("div",{class:"actions-right"},[a("button",{class:"btn subtle sm",type:"button",onClick:ve},"Cancel"),n[10]||(n[10]=a("button",{class:"btn sm",type:"submit"},"Update",-1))])])],32)])],512),[[ee,I.value]])]),_:1})]))}}),Rn=Vt(Tn,[["__scopeId","data-v-2db994c6"]]);export{Rn as default};
