import{d as et,c as j,r as i,o as tt,g as st,a as l,b as e,B as K,p as m,K as nt,i as at,e as k,l as ot,t as u,F as ge,h as _e,L as lt,n as pe,u as it,f as o,_ as rt}from"./index-CxPuBSkI.js";import{b as me,i as ut,a as dt,c as ct,s as ht}from"./on-the-beat-DLHddV1m.js";import{i as vt}from"./megaphone-Cs9AbUGH.js";import{h as fe}from"./home-icon-CTPXHMtR.js";const gt=["src"],_t=["src"],pt=["src"],mt=["src"],ft=["src"],bt={key:0,class:"menu","aria-label":"On The Beat menu"},yt={class:"menu-grid"},wt={class:"menu-card"},jt={class:"menu-card__row menu-card__row--between"},kt={class:"menu-card__row-left"},Tt={class:"menu-card"},St={class:"menu-card__row"},xt={class:"menu-play"},Mt=["disabled"],Ct={key:0,class:"menu-warn"},Bt={class:"words-modal"},Et={class:"words-modal__head"},It={class:"words-modal__title"},Rt={class:"words-modal__meta"},Nt={class:"words-pill"},Ot={class:"words-pill"},$t={key:0,class:"words-pill"},At={key:1,class:"words-pill"},Pt={key:2,class:"words-pill"},Dt={key:3,class:"words-pill"},qt={class:"words-grid-wrap","aria-label":"Words grid (scrollable)"},Ft={class:"words-rounds"},Gt={class:"words-round__head"},Lt={class:"words-round__title"},Ut={class:"words-grid"},Wt={class:"words-card__inner"},Kt={key:0,class:"words-card__img"},Vt=["src"],Jt={key:0,class:"words-card__jp"},zt={key:1,class:"words-card__en"},Xt={key:2,class:"words-card__empty"},Ht={key:1,class:"game","aria-label":"On The Beat game"},Yt={class:"hud","aria-label":"Game HUD"},Qt={class:"hud-center"},Zt={class:"hud-pill hud-pill--round"},es={class:"hud-debug","aria-hidden":"true"},ts={class:"hud-pill hud-pill--debug"},ss={class:"board","aria-label":"Card board"},ns={key:0,class:"finish-center","aria-label":"Continue/Finish"},as={key:1,class:"card-grid",role:"grid","aria-label":"8 cards"},os={class:"beat-card__inner"},ls={key:0,class:"beat-card__jp"},is={key:1,class:"beat-card__text beat-card__text--center"},rs={class:"beat-card__en"},us={key:2,class:"beat-card__text beat-card__text--spacer","aria-hidden":"true"},ds={key:0,class:"overlay overlay--loading",role:"status","aria-live":"polite"},cs={class:"overlay-card"},hs={class:"overlay-progress"},vs={class:"bar"},gs={class:"pct"},_s={key:1,class:"overlay overlay--countdown",role:"status","aria-live":"polite"},ps={class:"countdown-card"},ms={class:"countdown-num"},be=8,ye=5,ee=16,Ee=30,fs=.875,Ie=520,bs=et({__name:"OnTheBeat",setup(ys){const Re=it(),Ne=j(()=>({"--otb-bg-url":`url("${me}")`})),te=vt,se=ut,ne=dt,ae=ct,V=i("menu"),g=i("pronouns"),T=i(!0),S=i(!0),oe=i(!1),d=i("idle"),J=i(0),I=i(3),R={pronouns:{label:"Pronouns",games:[[[{english:"I",jp:"わたし"},{english:"my",jp:"わたしの"},{english:"me",jp:"わたしを／に"},{english:"mine",jp:"わたしのもの"}],[{english:"you",jp:"あなた"},{english:"your",jp:"あなたの"},{english:"you",jp:"あなたを／に"},{english:"yours",jp:"あなたのもの"}],[{english:"it",jp:"それ"},{english:"its",jp:"それの"},{english:"it",jp:"それを／に"},{english:"X",jp:"—"}],[{english:"Mao",jp:"マオ"},{english:"Mao’s",jp:"マオの"},{english:"Mao",jp:"マオ"},{english:"Mao’s",jp:"マオの"}],[{english:"Ken",jp:"ケン"},{english:"Ken’s",jp:"ケンの"},{english:"Ken",jp:"ケン"},{english:"Ken’s",jp:"ケンの"}]],[[{english:"he",jp:"かれ"},{english:"his",jp:"かれの"},{english:"him",jp:"かれを／に"},{english:"his",jp:"かれのもの"}],[{english:"she",jp:"かのじょ"},{english:"her",jp:"かのじょの"},{english:"her",jp:"かのじょを／に"},{english:"hers",jp:"かのじょのもの"}],[{english:"we",jp:"わたしたち"},{english:"our",jp:"わたしたちの"},{english:"us",jp:"わたしたちを／に"},{english:"ours",jp:"わたしたちのもの"}],[{english:"you",jp:"あなた(たち)"},{english:"your",jp:"あなた(たち)の"},{english:"you",jp:"あなた(たち)を／に"},{english:"yours",jp:"あなた(たち)のもの"}],[{english:"they",jp:"かれら／かのじょら"},{english:"their",jp:"かれらの"},{english:"them",jp:"かれらを／に"},{english:"theirs",jp:"かれらのもの"}]]]},demonstratives:{label:"This / That",games:[[[{english:"this",jp:"これ"},{english:"that",jp:"それ"},{english:"these",jp:"これら"},{english:"those",jp:"それら"}],[{english:"here",jp:"ここ"},{english:"there",jp:"そこ"},{english:"near",jp:"ちかく"},{english:"far",jp:"とおく"}],[{english:"this",jp:"これ"},{english:"here",jp:"ここ"},{english:"that",jp:"それ"},{english:"there",jp:"そこ"}],[{english:"this",jp:"これ"},{english:"near",jp:"ちかく"},{english:"there",jp:"そこ"},{english:"far",jp:"とおく"}],[{english:"this",jp:"これ"},{english:"that",jp:"それ"},{english:"these",jp:"これら"},{english:"those",jp:"それら"},{english:"here",jp:"ここ"},{english:"there",jp:"そこ"},{english:"near",jp:"ちかく"},{english:"far",jp:"とおく"}]]]}},x=i(0),P=i(0),z=i(0),f=i(-1),N=i([]),y=i(0),le=j(()=>R[g.value].games.length),Oe=j(()=>le.value*5),$e=j(()=>x.value*5+P.value+1),O=i(!1),D=i(!1),Ae=j(()=>R[g.value].label);function ie(s){if(s.length===8)return s;if(s.length===4)return[...s,...s];if(s.length<8){const t=[];let n=0;for(;t.length<8;)t.push(s[n%s.length]),n++;return t}return s.slice(0,8)}const re=j(()=>{const s=R[g.value],t=[];for(let n=0;n<s.games.length;n++)for(let a=0;a<s.games[n].length;a++){const b=ie(s.games[n][a]).map((c,r)=>({...c,_key:`${g.value}-${n}-${a}-${r}-${c.english}-${c.jp}-${c.img??""}`}));t.push({_key:`${g.value}-g${n}-r${a}`,gameIndex:n,roundIndex:a,words:b})}return t}),X=i(Ee),Pe=j(()=>{const s=Math.round(X.value*1e3/ye);return Math.max(80,Math.round(s/ee*fs))}),M=i(!1),q=i(!0),C=i(!1),$=i(!1);function De(s){const t=Math.PI*2*s/8,n=Math.cos(t),a=Math.sin(t),v=130,b=120,c=(s%2===0?1:-1)*(18+s*2);return{"--dx":`${(n*v).toFixed(1)}vw`,"--dy":`${(a*b).toFixed(1)}vh`,"--rot":`${c}deg`,"--sc":`${1.03}`,animationDuration:`${Ie}ms`}}let H=null,_=null,w=null,F=null,G=0,Y=null,Q=null,L=null;const ue=j(()=>!!R[g.value]?.games?.length);function we(s){g.value=s}function qe(){T.value=!T.value}function Fe(){S.value=!S.value}function Ge(){oe.value=!0}function je(){oe.value=!1}function Le(){try{Re.back()}catch{}}function B(s){return new Promise(t=>{if(!s)return t();const n=new Image;n.decoding="async",n.loading="eager",n.onload=()=>t(),n.onerror=()=>t(),n.src=s})}async function ke(){if(H)return H;const s=window.AudioContext||window.webkitAudioContext;return H=new s,H}async function Ue(s){const t=await ke(),a=await(await fetch(s,{cache:"force-cache"})).arrayBuffer();return await t.decodeAudioData(a)}function We(s,t,n){const v=R[s].games[t][n];return ie(v)}function Ke(s){return s.map((t,n)=>({...t,_slotKey:`${Date.now()}-${Math.random().toString(16).slice(2)}-${n}`}))}function Te(s,t,n){const a=We(s,t,n);N.value=Ke(a)}function Ve(s){if(s<8){f.value=-1;return}const t=s-8;f.value=t>=0&&t<8?t:-1}function U(){Q!=null&&(window.clearTimeout(Q),Q=null),L!=null&&(window.clearTimeout(L),L=null),Y!=null&&(window.clearTimeout(Y),Y=null)}function de(s=!0){P.value=0,z.value=0,f.value=-1,y.value=0,M.value=!1,q.value=!0,C.value=!1,$.value=!1,O.value=!1,D.value=!1,s&&(x.value=0)}function W(){try{w&&w.stop()}catch{}w=null,F=null,G=0}function Je(){U(),W(),de(!0),N.value=[],d.value="idle",V.value="menu"}function ze(){U(),W(),de(!0),N.value=[],d.value="idle",V.value="menu"}function Z(){$.value||O.value||D.value||(d.value="finished",f.value=-1,M.value=!1,$.value=!0,window.setTimeout(()=>{$.value=!1,N.value=[];const s=x.value<le.value-1;O.value=s,D.value=!s},Ie+40))}function Se(){U(),Z()}function xe(s,t){const n=Pe.value,a=be+ye*ee,v=()=>{if(d.value!=="countdown"&&d.value!=="playing")return;const c=performance.now()-G,r=Math.max(0,Math.floor(c/n));if(r>=a){Z();return}if(M.value=r%2===1,r<be)return q.value=!0,C.value=!1,y.value=0,f.value=-1,r<2?I.value=3:r<4?I.value=2:r<6?I.value=1:(I.value=0,d.value="playing"),z.value=0,b(r+1,n);q.value=!1,d.value="playing";const E=r-be,h=Math.floor(E/ee),p=E%ee;return P.value=Xe(h,0,ye-1),z.value=p,p===0&&(Te(s,t,P.value),f.value=-1,y.value=0),P.value===0&&p<8?(C.value=!0,y.value=p+1,f.value=-1):(C.value=!1,y.value=8,Ve(p)),b(r+1,n)};function b(c,r){const E=G+c*r,h=Math.max(0,E-performance.now());Q=window.setTimeout(v,h)}Te(s,t,0),y.value=0,f.value=-1,q.value=!0,C.value=!1,v()}function Xe(s,t,n){return Math.max(t,Math.min(n,s))}async function He(){x.value=0,await Me()}async function Ye(){x.value>=le.value-1||(U(),W(),x.value+=1,O.value=!1,D.value=!1,await Me())}async function Me(){if(!ue.value)return;d.value="loading",V.value="game",de(!1),N.value=[],J.value=0;const s=g.value,t=x.value,n=R[s],a=[];for(let A=0;A<n.games.length;A++)for(let he=0;he<n.games[A].length;he++){const Ce=ie(n.games[A][he]);for(let ve=0;ve<Ce.length;ve++){const Be=Ce[ve]?.img;Be&&a.push(Be)}}const v=[me,te,se,ne,ae,fe,...a].filter(Boolean),b=Array.from(new Set(v)),c=b.length+1;let r=0;const E=()=>{r+=1,J.value=Math.min(1,r/c)};await Promise.all(b.map(async A=>{await B(A),E()}));try{_=await Ue(ht)}catch{_=null}E(),_?.duration&&Number.isFinite(_.duration)&&_.duration>1?X.value=_.duration:X.value=Ee,d.value="countdown",I.value=3;const h=await ke();if(h.state==="suspended"&&await h.resume().catch(()=>{}),W(),!_){G=performance.now()+90,xe(s,t),L=window.setTimeout(()=>Z(),Math.round(X.value*1e3)+900);return}w=h.createBufferSource(),w.buffer=_,F=h.createGain(),F.gain.value=1,w.connect(F),F.connect(h.destination);const p=120,Qe=(h.baseLatency??0)+(h.outputLatency??0),ce=Math.max(0,Math.round(Qe*1e3)),Ze=h.currentTime+p/1e3;w.start(Ze),G=performance.now()+p+ce,w.onended=()=>Se(),Y=window.setTimeout(()=>Se(),Math.round(_.duration*1e3)+p+ce+120),xe(s,t),L=window.setTimeout(()=>{(d.value==="countdown"||d.value==="playing")&&Z()},Math.round(_.duration*1e3)+p+ce+1200)}return tt(()=>{B(me),B(te),B(se),B(ne),B(ae),B(fe)}),st(()=>{U(),W()}),(s,t)=>(o(),l("section",{class:"otb-page",style:pe(Ne.value),"aria-label":"On The Beat"},[t[8]||(t[8]=e("div",{class:"otb-bg","aria-hidden":"true"},null,-1)),t[9]||(t[9]=e("div",{class:"otb-bg-overlay","aria-hidden":"true"},null,-1)),e("button",{class:"home-btn",type:"button",onClick:Le,"aria-label":"Back"},[e("img",{src:K(fe),alt:""},null,8,gt)]),e("img",{class:m(["corner-icon tl corner-icon--mega",{"is-beating":M.value}]),src:K(te),alt:"","aria-hidden":"true"},null,10,_t),e("img",{class:m(["corner-icon tr",{"is-beating":M.value}]),src:K(se),alt:"","aria-hidden":"true"},null,10,pt),e("img",{class:m(["corner-icon bl",{"is-beating":M.value}]),src:K(ne),alt:"","aria-hidden":"true"},null,10,mt),e("img",{class:m(["corner-icon br",{"is-beating":M.value}]),src:K(ae),alt:"","aria-hidden":"true"},null,10,ft),V.value==="menu"?(o(),l("section",bt,[t[4]||(t[4]=nt('<header class="menu-head" data-v-bd3fb98f><div class="title-stack" aria-label="Game title" data-v-bd3fb98f><div class="title-main" data-v-bd3fb98f>Say the word</div><div class="title-sub" data-v-bd3fb98f>on the beat!</div></div><p class="menu-subtitle" data-v-bd3fb98f>A rhythm game</p></header>',1)),e("div",yt,[e("div",wt,[t[2]||(t[2]=e("div",{class:"menu-card__title"},"Set",-1)),e("div",jt,[e("div",kt,[e("button",{class:m(["sq-btn",{"is-active":g.value==="pronouns"}]),type:"button",onClick:t[0]||(t[0]=n=>we("pronouns"))}," Pronouns ",2),e("button",{class:m(["sq-btn",{"is-active":g.value==="demonstratives"}]),type:"button",onClick:t[1]||(t[1]=n=>we("demonstratives"))}," This / That ",2)]),e("div",{class:"menu-card__row-right"},[e("button",{class:"sq-btn",type:"button",onClick:Ge},"Show Words")])])]),e("div",Tt,[t[3]||(t[3]=e("div",{class:"menu-card__title"},"Card Text",-1)),e("div",St,[e("button",{class:m(["sq-btn",{"is-active":S.value}]),type:"button",onClick:Fe}," Japanese ",2),e("button",{class:m(["sq-btn",{"is-active":T.value}]),type:"button",onClick:qe}," English ",2)])])]),e("div",xt,[e("button",{class:"sq-btn sq-btn--primary",type:"button",disabled:!ue.value,onClick:He},"Play",8,Mt),ue.value?k("",!0):(o(),l("div",Ct,"This set is unavailable."))]),(o(),at(lt,{to:"body"},[oe.value?(o(),l("div",{key:0,class:"words-overlay",role:"dialog","aria-modal":"true","aria-label":"Words in set",onClick:ot(je,["self"])},[e("section",Bt,[e("header",Et,[e("div",It,"Words — "+u(Ae.value),1),e("div",{class:"words-modal__actions"},[e("button",{class:"sq-btn",type:"button",onClick:je},"Close")])]),e("div",Rt,[e("div",Nt,"Rounds: "+u(re.value.length),1),e("div",Ot,"Cards: "+u(re.value.length*8),1),S.value?(o(),l("div",$t,"JP: On")):(o(),l("div",At,"JP: Off")),T.value?(o(),l("div",Pt,"EN: On")):(o(),l("div",Dt,"EN: Off"))]),e("div",qt,[e("div",Ft,[(o(!0),l(ge,null,_e(re.value,n=>(o(),l("section",{key:n._key,class:"words-round"},[e("header",Gt,[e("div",Lt,"Game "+u(n.gameIndex+1)+" — Round "+u(n.roundIndex+1),1)]),e("div",Ut,[(o(!0),l(ge,null,_e(n.words,(a,v)=>(o(),l("article",{key:a._key+"-"+v,class:"words-card"},[e("div",Wt,[a.img?(o(),l("div",Kt,[e("img",{src:a.img,alt:"",loading:"lazy"},null,8,Vt)])):k("",!0),e("div",{class:m(["words-card__text",{"words-card__text--noimg":!a.img}])},[S.value?(o(),l("div",Jt,u(a.jp),1)):k("",!0),T.value?(o(),l("div",zt,u(a.english),1)):k("",!0),!S.value&&!T.value?(o(),l("div",Xt,"(Text hidden)")):k("",!0)],2)])]))),128))])]))),128))])])])])):k("",!0)]))])):(o(),l("section",Ht,[e("header",Yt,[e("div",Qt,[e("div",Zt,"Round "+u($e.value)+" / "+u(Oe.value),1)]),e("div",es,[e("div",ts,"Beat "+u(z.value+1)+" / 16",1)]),e("div",{class:"hud-right"},[e("button",{class:"sq-btn",type:"button",onClick:Je},"Stop")])]),e("div",ss,[O.value||D.value?(o(),l("div",ns,[O.value?(o(),l("button",{key:0,class:"sq-btn sq-btn--primary",type:"button",onClick:Ye}," Continue ")):(o(),l("button",{key:1,class:"sq-btn sq-btn--primary",type:"button",onClick:ze},"Finish"))])):(o(),l("div",as,[(o(!0),l(ge,null,_e(N.value,(n,a)=>(o(),l("article",{key:n._slotKey,class:m(["beat-card no-image",[q.value?"deal-hidden":"",C.value&&a<y.value?"deal-in":"",C.value&&a>=y.value?"deal-hidden":"",$.value?"explode-out":"",f.value===a?"is-highlighted":""]]),role:"gridcell",style:pe($.value?De(a):void 0)},[e("div",os,[S.value?(o(),l("div",ls,u(n.jp),1)):k("",!0),T.value?(o(),l("div",is,[e("div",rs,u(n.english),1)])):(o(),l("div",us))])],6))),128))]))]),d.value==="loading"?(o(),l("div",ds,[e("div",cs,[t[5]||(t[5]=e("div",{class:"overlay-title"},"Loading…",-1)),t[6]||(t[6]=e("div",{class:"overlay-sub"},"Preparing audio.",-1)),e("div",hs,[e("div",vs,[e("div",{class:"bar__fill",style:pe({width:`${Math.round(J.value*100)}%`})},null,4)]),e("div",gs,u(Math.round(J.value*100))+"%",1)])])])):d.value==="countdown"?(o(),l("div",_s,[e("div",ps,[e("div",ms,u(I.value),1),t[7]||(t[7]=e("div",{class:"countdown-sub"},"Get ready",-1))])])):k("",!0)]))],4))}}),Ms=rt(bs,[["__scopeId","data-v-bd3fb98f"]]);export{Ms as default};
