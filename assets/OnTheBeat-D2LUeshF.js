import{d as ht,c as y,r as u,o as gt,g as mt,a as o,b as t,B as Y,p as h,K as pt,i as _t,e as x,t as d,l as ft,F as ke,h as Se,L as bt,n as Te,u as yt,f as l,_ as wt}from"./index-CPYovS2m.js";import{b as Me,i as jt,a as kt,c as St,s as Tt}from"./on-the-beat-DLHddV1m.js";import{i as Mt}from"./megaphone-Cs9AbUGH.js";import{h as xe}from"./home-icon-CTPXHMtR.js";const xt=["src"],Et=["src"],Bt=["src"],Ct=["src"],Rt=["src"],It={key:0,class:"menu","aria-label":"On The Beat menu"},At={class:"menu-stack","aria-label":"Menu options"},Nt={class:"menu-card"},$t={class:"menu-card__row menu-card__row--between"},Ot={class:"menu-card__row-left"},Dt={class:"menu-card"},Pt={class:"menu-card__row"},qt={class:"menu-card"},Ft={class:"menu-card__row"},Gt={class:"menu-play"},Lt=["disabled"],Ut={key:0,class:"menu-warn"},Vt={class:"words-modal"},Wt={class:"words-modal__head"},Kt={class:"words-modal__title"},Jt={class:"words-modal__meta"},zt={class:"words-pill"},Xt={class:"words-pill"},Ht={key:0,class:"words-pill"},Yt={key:1,class:"words-pill"},Qt={key:2,class:"words-pill"},Zt={key:3,class:"words-pill"},es={class:"words-grid-wrap","aria-label":"Words grid (scrollable)"},ts={class:"words-rounds"},ss={class:"words-round__head"},ns={class:"words-round__title"},as={class:"words-grid"},ls={class:"words-card__inner"},os={key:0,class:"words-card__img"},is=["src"],us={key:0,class:"words-card__jp"},rs={key:1,class:"words-card__en"},cs={key:2,class:"words-card__empty"},ds={key:1,class:"game","aria-label":"On The Beat game"},vs={class:"hud","aria-label":"Game HUD"},hs={class:"hud-center"},gs={class:"hud-pill hud-pill--round"},ms={class:"hud-debug","aria-hidden":"true"},ps={class:"hud-pill hud-pill--debug"},_s={class:"board","aria-label":"Card board"},fs={key:0,class:"finish-center","aria-label":"Continue/Finish"},bs={key:1,class:"card-grid",role:"grid","aria-label":"8 cards"},ys={class:"beat-card__inner"},ws={key:0,class:"beat-card__jp"},js={key:1,class:"beat-card__text beat-card__text--center"},ks={class:"beat-card__en"},Ss={key:2,class:"beat-card__text beat-card__text--spacer","aria-hidden":"true"},Ts={key:0,class:"overlay overlay--loading",role:"status","aria-live":"polite"},Ms={class:"overlay-card"},xs={class:"overlay-progress"},Es={class:"bar"},Bs={class:"pct"},Cs={key:1,class:"overlay overlay--countdown",role:"status","aria-live":"polite"},Rs={class:"countdown-card"},Is={class:"countdown-num"},Ee=.92,As=1.08,N=8,$=5,O=16,Fe=30,Ns=.875,Ge=100,Le=520,$s=ht({__name:"OnTheBeat",setup(Os){const Ue=yt(),Ve=y(()=>({"--otb-bg-url":`url("${Me}")`})),ue=Mt,re=jt,ce=kt,de=St,Q=u("menu"),_=u("pronouns"),S=u(!0),T=u(!0),i=u("normal"),Z={slow:.92,normal:1,fast:1.08};function ee(s){if(i.value!=="speeding"){const n=i.value==="slow"||i.value==="fast"?i.value:"normal";return Z[n]??1}const e=(As-Ee)/Math.max(1,$-1);return Ee+e*be(s,0,$-1)}function We(s){if(i.value!=="speeding"){const a=i.value==="slow"||i.value==="fast"?i.value:"normal";return Z[a]??1}if(s<N)return ee(0);const e=s-N,n=Math.floor(e/O);return ee(n)}const ve=u(!1),g=u("idle"),te=u(0),D=u(3),E={pronouns:{label:"Pronouns",games:[[[{english:"I",jp:"わたし"},{english:"my",jp:"わたしの"},{english:"me",jp:"わたしを／に"},{english:"mine",jp:"わたしのもの"}],[{english:"you",jp:"あなた"},{english:"your",jp:"あなたの"},{english:"you",jp:"あなたを／に"},{english:"yours",jp:"あなたのもの"}],[{english:"it",jp:"それ"},{english:"its",jp:"それの"},{english:"it",jp:"それを／に"},{english:"X",jp:"—"}],[{english:"Mao",jp:"マオ"},{english:"Mao’s",jp:"マオの"},{english:"Mao",jp:"マオ"},{english:"Mao’s",jp:"マオの"}],[{english:"Ken",jp:"ケン"},{english:"Ken’s",jp:"ケンの"},{english:"Ken",jp:"ケン"},{english:"Ken’s",jp:"ケンの"}]],[[{english:"he",jp:"かれ"},{english:"his",jp:"かれの"},{english:"him",jp:"かれを／に"},{english:"his",jp:"かれのもの"}],[{english:"she",jp:"かのじょ"},{english:"her",jp:"かのじょの"},{english:"her",jp:"かのじょを／に"},{english:"hers",jp:"かのじょのもの"}],[{english:"we",jp:"わたしたち"},{english:"our",jp:"わたしたちの"},{english:"us",jp:"わたしたちを／に"},{english:"ours",jp:"わたしたちのもの"}],[{english:"you",jp:"あなた(たち)"},{english:"your",jp:"あなた(たち)の"},{english:"you",jp:"あなた(たち)を／に"},{english:"yours",jp:"あなた(たち)のもの"}],[{english:"they",jp:"かれら／かのじょら"},{english:"their",jp:"かれらの"},{english:"them",jp:"かれらを／に"},{english:"theirs",jp:"かれらのもの"}]]]},demonstratives:{label:"This / That",games:[[[{english:"this",jp:"これ"},{english:"that",jp:"それ"},{english:"these",jp:"これら"},{english:"those",jp:"それら"}],[{english:"here",jp:"ここ"},{english:"there",jp:"そこ"},{english:"near",jp:"ちかく"},{english:"far",jp:"とおく"}],[{english:"this",jp:"これ"},{english:"here",jp:"ここ"},{english:"that",jp:"それ"},{english:"there",jp:"そこ"}],[{english:"this",jp:"これ"},{english:"near",jp:"ちかく"},{english:"there",jp:"そこ"},{english:"far",jp:"とおく"}],[{english:"this",jp:"これ"},{english:"that",jp:"それ"},{english:"these",jp:"これら"},{english:"those",jp:"それら"},{english:"here",jp:"ここ"},{english:"there",jp:"そこ"},{english:"near",jp:"ちかく"},{english:"far",jp:"とおく"}]]]}},B=u(0),L=u(0),se=u(0),w=u(-1),P=u([]),M=u(0),he=y(()=>E[_.value].games.length),Ke=y(()=>he.value*5),Je=y(()=>B.value*5+L.value+1),q=u(!1),U=u(!1),ze=y(()=>E[_.value].label);function ge(s){if(s.length===8)return s;if(s.length===4)return[...s,...s];if(s.length<8){const e=[];let n=0;for(;e.length<8;)e.push(s[n%s.length]),n++;return e}return s.slice(0,8)}const me=y(()=>{const s=E[_.value],e=[];for(let n=0;n<s.games.length;n++)for(let a=0;a<s.games[n].length;a++){const f=ge(s.games[n][a]).map((p,m)=>({...p,_key:`${_.value}-${n}-${a}-${m}-${p.english}-${p.jp}-${p.img??""}`}));e.push({_key:`${_.value}-g${n}-r${a}`,gameIndex:n,roundIndex:a,words:f})}return e}),ne=u(Fe),Xe=y(()=>{const s=Math.round(ne.value*1e3/$);return Math.max(40,Math.max(80,Math.round(s/O*Ns)))}),V=u(null);function pe(){const s=N+$*O,e=new Array(s+1);e[0]=0;for(let n=0;n<s;n++){const a=Math.max(.6,We(n)),c=Math.max(30,Math.round(Xe.value/a));e[n+1]=e[n]+c}return e}const C=u(!1),W=u(!0),R=u(!1),F=u(!1);function He(s){const e=Math.PI*2*s/8,n=Math.cos(e),a=Math.sin(e),c=130,f=120,p=(s%2===0?1:-1)*(18+s*2);return{"--dx":`${(n*c).toFixed(1)}vw`,"--dy":`${(a*f).toFixed(1)}vh`,"--rot":`${p}deg`,"--sc":`${1.03}`,animationDuration:`${Le}ms`}}let ae=null,j=null,b=null,K=null,J=0,le=null,oe=null,z=null;const Ye=y(()=>S.value||T.value),_e=y(()=>!!E[_.value]?.games?.length&&Ye.value),Qe=y(()=>!E[_.value]?.games?.length?"This set is unavailable.":"");function Be(s){_.value=s}function Ze(){S.value=!S.value}function et(){T.value=!T.value}function tt(){ve.value=!0}function Ce(){ve.value=!1}function st(){try{Ue.back()}catch{}}function I(s){return new Promise(e=>{if(!s)return e();const n=new Image;n.decoding="async",n.loading="eager",n.onload=()=>e(),n.onerror=()=>e(),n.src=s})}async function Re(){if(ae)return ae;const s=window.AudioContext||window.webkitAudioContext;return ae=new s,ae}async function nt(s){const e=await Re(),a=await(await fetch(s,{cache:"force-cache"})).arrayBuffer();return await e.decodeAudioData(a)}function at(s,e,n){const c=E[s].games[e][n];return ge(c)}function lt(s){return s.map((e,n)=>({...e,_slotKey:`${Date.now()}-${Math.random().toString(16).slice(2)}-${n}`}))}function Ie(s,e,n){const a=at(s,e,n);P.value=lt(a)}function ot(s){if(s<8){w.value=-1;return}const e=s-8;w.value=e>=0&&e<8?e:-1}function X(){oe!=null&&(window.clearTimeout(oe),oe=null),z!=null&&(window.clearTimeout(z),z=null),le!=null&&(window.clearTimeout(le),le=null)}function fe(s=!0){L.value=0,se.value=0,w.value=-1,M.value=0,C.value=!1,W.value=!0,R.value=!1,F.value=!1,q.value=!1,U.value=!1,s&&(B.value=0)}function H(){try{b&&b.stop()}catch{}b=null,K=null,J=0}function it(){X(),H(),fe(!0),P.value=[],g.value="idle",Q.value="menu"}function ut(){X(),H(),fe(!0),P.value=[],g.value="idle",Q.value="menu"}function ie(){F.value||q.value||U.value||(g.value="finished",w.value=-1,C.value=!1,F.value=!0,window.setTimeout(()=>{F.value=!1,P.value=[];const s=B.value<he.value-1;q.value=s,U.value=!s},Le+40))}function Ae(){X(),ie()}function Ne(s,e){const n=V.value??pe();V.value=n;const a=N+$*O,c=m=>{let r=0;for(;r+1<=a&&n[r+1]<=m;)r++;return be(r,0,a)},f=()=>{if(g.value!=="countdown"&&g.value!=="playing")return;const m=performance.now()-J,r=c(Math.max(0,m));if(r>=a){ie();return}if(C.value=r%2===1,r<N)return W.value=!0,R.value=!1,M.value=0,w.value=-1,r<2?D.value=3:r<4?D.value=2:r<6?D.value=1:(D.value=0,g.value="playing"),se.value=0,p(r+1);W.value=!1,g.value="playing";const v=r-N,G=Math.floor(v/O),A=v%O;return L.value=be(G,0,$-1),se.value=A,A===0&&(Ie(s,e,L.value),w.value=-1,M.value=0),L.value===0&&A<8?(R.value=!0,M.value=A+1,w.value=-1):(R.value=!1,M.value=8,ot(A)),p(r+1)};function p(m){const r=J+(n[m]??n[n.length-1]),v=Math.max(0,r-performance.now());oe=window.setTimeout(f,v)}Ie(s,e,0),M.value=0,w.value=-1,W.value=!0,R.value=!1,f()}function be(s,e,n){return Math.max(e,Math.min(n,s))}async function rt(){B.value=0,await $e()}async function ct(){B.value>=he.value-1||(X(),H(),B.value+=1,q.value=!1,U.value=!1,await $e())}function dt(s,e,n){if(i.value!=="speeding")return;const a=V.value??pe();V.value=a,e.playbackRate.setValueAtTime(ee(0),n);for(let c=1;c<$;c++){const f=N+c*O,m=(a[f]??0)/1e3,r=ee(c);e.playbackRate.setValueAtTime(r,n+m)}}function vt(s){if(i.value==="speeding")return Math.round(s*1e3/Math.max(.6,Ee));const e=i.value==="slow"||i.value==="fast"?Z[i.value]:1;return Math.round(s*1e3/Math.max(.6,e))}async function $e(){if(!_e.value)return;g.value="loading",Q.value="game",fe(!1),P.value=[],te.value=0;const s=_.value,e=B.value,n=E[s],a=[];for(let k=0;k<n.games.length;k++)for(let we=0;we<n.games[k].length;we++){const Pe=ge(n.games[k][we]);for(let je=0;je<Pe.length;je++){const qe=Pe[je]?.img;qe&&a.push(qe)}}const c=[Me,ue,re,ce,de,xe,...a].filter(Boolean),f=Array.from(new Set(c)),p=f.length+1;let m=0;const r=()=>{m+=1,te.value=Math.min(1,m/p)};await Promise.all(f.map(async k=>{await I(k),r()}));try{j=await nt(Tt)}catch{j=null}r(),j?.duration&&Number.isFinite(j.duration)&&j.duration>1?ne.value=j.duration:ne.value=Fe,V.value=pe(),g.value="countdown",D.value=3;const v=await Re();if(v.state==="suspended"&&await v.resume().catch(()=>{}),H(),!j){J=performance.now()+90+Ge,Ne(s,e),z=window.setTimeout(()=>ie(),Math.round(ne.value*1e3)+900);return}if(b=v.createBufferSource(),b.buffer=j,i.value!=="speeding"){const k=i.value==="slow"||i.value==="fast"?Z[i.value]:1;b.playbackRate.value=k}K=v.createGain(),K.gain.value=1,b.connect(K),K.connect(v.destination);const G=120,A=(v.baseLatency??0)+(v.outputLatency??0),ye=Math.max(0,Math.round(A*1e3)),Oe=v.currentTime+G/1e3;dt(v,b,Oe),b.start(Oe),J=performance.now()+G+ye+Ge,b.onended=()=>Ae();const De=vt(j.duration);le=window.setTimeout(()=>Ae(),De+G+ye+200),Ne(s,e),z=window.setTimeout(()=>{(g.value==="countdown"||g.value==="playing")&&ie()},De+G+ye+1200)}return gt(()=>{I(Me),I(ue),I(re),I(ce),I(de),I(xe)}),mt(()=>{X(),H()}),(s,e)=>(l(),o("section",{class:"otb-page",style:Te(Ve.value),"aria-label":"On The Beat"},[e[13]||(e[13]=t("div",{class:"otb-bg","aria-hidden":"true"},null,-1)),e[14]||(e[14]=t("div",{class:"otb-bg-overlay","aria-hidden":"true"},null,-1)),t("button",{class:"home-btn",type:"button",onClick:st,"aria-label":"Back"},[t("img",{src:Y(xe),alt:""},null,8,xt)]),t("img",{class:h(["corner-icon tl corner-icon--mega",{"is-beating":C.value}]),src:Y(ue),alt:"","aria-hidden":"true"},null,10,Et),t("img",{class:h(["corner-icon tr",{"is-beating":C.value}]),src:Y(re),alt:"","aria-hidden":"true"},null,10,Bt),t("img",{class:h(["corner-icon bl",{"is-beating":C.value}]),src:Y(ce),alt:"","aria-hidden":"true"},null,10,Ct),t("img",{class:h(["corner-icon br",{"is-beating":C.value}]),src:Y(de),alt:"","aria-hidden":"true"},null,10,Rt),Q.value==="menu"?(l(),o("section",It,[e[9]||(e[9]=pt('<header class="menu-head" data-v-311f301b><div class="title-stack" aria-label="Game title" data-v-311f301b><div class="title-main" data-v-311f301b>Say the word</div><div class="title-sub" data-v-311f301b>on the beat!</div></div><p class="menu-subtitle" data-v-311f301b>A rhythm game</p></header>',1)),t("div",At,[t("div",Nt,[e[6]||(e[6]=t("div",{class:"menu-card__title"},"Set",-1)),t("div",$t,[t("div",Ot,[t("button",{class:h(["sq-btn",{"is-active":_.value==="pronouns"}]),type:"button",onClick:e[0]||(e[0]=n=>Be("pronouns"))}," Pronouns ",2),t("button",{class:h(["sq-btn",{"is-active":_.value==="demonstratives"}]),type:"button",onClick:e[1]||(e[1]=n=>Be("demonstratives"))}," This / That ",2)]),t("div",{class:"menu-card__row-right"},[t("button",{class:"sq-btn",type:"button",onClick:tt},"Show Words")])])]),t("div",Dt,[e[7]||(e[7]=t("div",{class:"menu-card__title"},"Speed",-1)),t("div",Pt,[t("button",{class:h(["sq-btn",{"is-active":i.value==="slow"}]),type:"button",onClick:e[2]||(e[2]=n=>i.value="slow")}," Slow ",2),t("button",{class:h(["sq-btn",{"is-active":i.value==="normal"}]),type:"button",onClick:e[3]||(e[3]=n=>i.value="normal")}," Normal ",2),t("button",{class:h(["sq-btn",{"is-active":i.value==="fast"}]),type:"button",onClick:e[4]||(e[4]=n=>i.value="fast")}," Fast ",2),t("button",{class:h(["sq-btn",{"is-active":i.value==="speeding"}]),type:"button",onClick:e[5]||(e[5]=n=>i.value="speeding")}," Speeding Up ",2)])]),t("div",qt,[e[8]||(e[8]=t("div",{class:"menu-card__title"},"Card Text",-1)),t("div",Ft,[t("button",{class:h(["sq-btn",{"is-active":T.value}]),type:"button",onClick:et}," Japanese ",2),t("button",{class:h(["sq-btn",{"is-active":S.value}]),type:"button",onClick:Ze}," English ",2)])])]),t("div",Gt,[t("button",{class:"sq-btn sq-btn--primary",type:"button",disabled:!_e.value,onClick:rt},"Play",8,Lt),_e.value?x("",!0):(l(),o("div",Ut,d(Qe.value),1))]),(l(),_t(bt,{to:"body"},[ve.value?(l(),o("div",{key:0,class:"words-overlay",role:"dialog","aria-modal":"true","aria-label":"Words in set",onClick:ft(Ce,["self"])},[t("section",Vt,[t("header",Wt,[t("div",Kt,"Words — "+d(ze.value),1),t("div",{class:"words-modal__actions"},[t("button",{class:"sq-btn",type:"button",onClick:Ce},"Close")])]),t("div",Jt,[t("div",zt,"Rounds: "+d(me.value.length),1),t("div",Xt,"Cards: "+d(me.value.length*8),1),T.value?(l(),o("div",Ht,"JP: On")):(l(),o("div",Yt,"JP: Off")),S.value?(l(),o("div",Qt,"EN: On")):(l(),o("div",Zt,"EN: Off"))]),t("div",es,[t("div",ts,[(l(!0),o(ke,null,Se(me.value,n=>(l(),o("section",{key:n._key,class:"words-round"},[t("header",ss,[t("div",ns,"Game "+d(n.gameIndex+1)+" — Round "+d(n.roundIndex+1),1)]),t("div",as,[(l(!0),o(ke,null,Se(n.words,(a,c)=>(l(),o("article",{key:a._key+"-"+c,class:"words-card"},[t("div",ls,[a.img?(l(),o("div",os,[t("img",{src:a.img,alt:"",loading:"lazy"},null,8,is)])):x("",!0),t("div",{class:h(["words-card__text",{"words-card__text--noimg":!a.img}])},[T.value?(l(),o("div",us,d(a.jp),1)):x("",!0),S.value?(l(),o("div",rs,d(a.english),1)):x("",!0),!T.value&&!S.value?(l(),o("div",cs,"(Text hidden)")):x("",!0)],2)])]))),128))])]))),128))])])])])):x("",!0)]))])):(l(),o("section",ds,[t("header",vs,[t("div",hs,[t("div",gs,"Round "+d(Je.value)+" / "+d(Ke.value),1)]),t("div",ms,[t("div",ps,"Beat "+d(se.value+1)+" / 16",1)]),t("div",{class:"hud-right"},[t("button",{class:"sq-btn",type:"button",onClick:it},"Stop")])]),t("div",_s,[q.value||U.value?(l(),o("div",fs,[q.value?(l(),o("button",{key:0,class:"sq-btn sq-btn--primary",type:"button",onClick:ct}," Continue ")):(l(),o("button",{key:1,class:"sq-btn sq-btn--primary",type:"button",onClick:ut},"Finish"))])):(l(),o("div",bs,[(l(!0),o(ke,null,Se(P.value,(n,a)=>(l(),o("article",{key:n._slotKey,class:h(["beat-card no-image",[W.value?"deal-hidden":"",R.value&&a<M.value?"deal-in":"",R.value&&a>=M.value?"deal-hidden":"",F.value?"explode-out":"",w.value===a?"is-highlighted":""]]),role:"gridcell",style:Te(F.value?He(a):void 0)},[t("div",ys,[T.value?(l(),o("div",ws,d(n.jp),1)):x("",!0),S.value?(l(),o("div",js,[t("div",ks,d(n.english),1)])):(l(),o("div",Ss))])],6))),128))]))]),g.value==="loading"?(l(),o("div",Ts,[t("div",Ms,[e[10]||(e[10]=t("div",{class:"overlay-title"},"Loading…",-1)),e[11]||(e[11]=t("div",{class:"overlay-sub"},"Preparing audio.",-1)),t("div",xs,[t("div",Es,[t("div",{class:"bar__fill",style:Te({width:`${Math.round(te.value*100)}%`})},null,4)]),t("div",Bs,d(Math.round(te.value*100))+"%",1)])])])):g.value==="countdown"?(l(),o("div",Cs,[t("div",Rs,[t("div",Is,d(D.value),1),e[12]||(e[12]=t("div",{class:"countdown-sub"},"Get ready",-1))])])):x("",!0)]))],4))}}),Us=wt($s,[["__scopeId","data-v-311f301b"]]);export{Us as default};
