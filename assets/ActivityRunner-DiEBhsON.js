import{i as N,r as d,c as n,m as C,j as S,w as O,o as U,a as r,d as i,t as _,h as D,E as G,F as V,e as j,s as y,b as c,_ as H}from"./index-DljZKD9D.js";const Q={class:"page activity-runner"},T={class:"head title-head"},J={class:"title"},K={class:"content runner-content"},P=["src"],X={key:1,class:"empty"},Y={class:"muted"},Z={key:0,class:"tags"},ee={class:"chips"},ae=N({__name:"ActivityRunner",setup(te){const o=C(),p=d(null),w=d(null),E="https://games.eitake.app",u=n(()=>o.params.slug),k=n(()=>o.params.id),R=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,l=(o.meta??{}).activity??void 0,s=d(null),m=d(!1),v=d(null);async function b(){if(v.value=null,s.value=null,!y)return;const a=k.value||u.value||l?.slug;if(a){m.value=!0;try{let e;if(R.test(a)?e=await y.from("activities").select("id,slug,name,type,url_path,external_url,icon_url,thumbnail_url,tags,launch_params,status,archived_at").eq("id",a).maybeSingle():e=await y.from("activities").select("id,slug,name,type,url_path,external_url,icon_url,thumbnail_url,tags,launch_params,status,archived_at").eq("slug",a).maybeSingle(),e.error)throw e.error;s.value=e.data??null,s.value||(v.value="Activity not found.")}catch(e){v.value=e?.message||"Failed to load activity."}finally{m.value=!1}}}S(b),O([u,k],()=>b());function q(){const a=o.query?.tags;return a?Array.isArray(a)?a.flatMap(e=>String(e).split(",")).map(e=>e.trim()).filter(Boolean):String(a).split(",").map(e=>e.trim()).filter(Boolean):[]}const F=n(()=>s.value?.name??l?.name??(l?.title||void 0)??(u.value?u.value.replace(/-/g," "):"Activity")),A=n(()=>(s.value?.tags??l?.tags??q()??[]).filter(Boolean));function B(a){if(!a)return"";let e=String(a).trim();if(!e)return"";if(/^[a-z][a-z0-9+\-.]*:\/\//i.test(e)||/^[a-z][a-z0-9+\-.]*:/i.test(e))return e;if(e.startsWith("//"))return(window.location?.protocol||"https:")+e;/^[\w.-]+\.[a-z]{2,}([/:?#]|$)/i.test(e)&&(e="https://"+e);try{const t=new URL(e,window.location.origin),M=t.pathname.split("/").pop()||"";return!/\.[a-z0-9]+$/i.test(M)&&!t.search&&!t.hash&&!t.pathname.endsWith("/")&&(t.pathname+="/"),t.toString()}catch{return e}}const h=n(()=>s.value?.slug||u.value||l?.slug||"activity"),z=n(()=>s.value?.external_url??l?.external_url??o.query.url??`${E.replace(/\/+$/,"")}/${h.value}/`),g=n(()=>B(z.value));function W(a){try{return new URL(a).origin}catch{return null}}const $=new Set(["https://games.eitake.app","http://localhost:8788","http://127.0.0.1:8788"]),f=n(()=>{const a=W(g.value);return a&&$.has(a)?a:null});function I(){if(!f.value)return;const a={version:"1.0.0",activity_id:s.value?.id||h.value,slug:s.value?.slug||h.value};p.value?.contentWindow?.postMessage({type:"parent:init",payload:a},f.value)}function x(a){if(!f.value||a.origin!==f.value)return;const{type:e,payload:t}=a.data||{};e==="request:fullscreen"&&L(),e==="xp:award"&&console.info("[ActivityRunner] xp:award",t),e==="track:event"&&console.info("[ActivityRunner] track:event",t)}function L(){const a=p.value||w.value||document.documentElement,e=a.requestFullscreen||a.webkitRequestFullscreen||a.msRequestFullscreen;e&&e.call(a)}return S(()=>window.addEventListener("message",x)),U(()=>window.removeEventListener("message",x)),(a,e)=>(c(),r("div",Q,[i("header",T,[i("h1",J,_(F.value),1)]),i("main",K,[i("div",{class:"frame-wrap",ref_key:"frameWrap",ref:w},[g.value?(c(),r("iframe",{key:0,ref_key:"frameEl",ref:p,src:g.value,title:"",allow:"fullscreen; autoplay; gamepad",allowfullscreen:"",sandbox:"allow-scripts allow-same-origin allow-pointer-lock allow-forms allow-popups",onLoad:I},null,40,P)):(c(),r("div",X,[i("p",Y,_(m.value?"Loading activityâ€¦":v.value||"No external URL configured for this activity."),1)]))],512),i("div",{class:"under-actions"},[i("button",{class:"btn primary",onClick:L}," Go Fullscreen ")]),A.value.length?(c(),r("section",Z,[i("div",ee,[(c(!0),r(V,null,j(A.value,t=>(c(),r("span",{key:t,class:"chip"},"# "+_(t),1))),128))])])):D("",!0),e[0]||(e[0]=G('<section class="achievements" data-v-31389a4c><h2 class="section-title" data-v-31389a4c>Achievements</h2><div class="badges" data-v-31389a4c><div class="badge locked" data-v-31389a4c><div class="icon" aria-hidden="true" data-v-31389a4c>ğŸ†</div><div class="label" data-v-31389a4c>Locked</div></div><div class="badge locked" data-v-31389a4c><div class="icon" aria-hidden="true" data-v-31389a4c>â­</div><div class="label" data-v-31389a4c>Locked</div></div><div class="badge locked" data-v-31389a4c><div class="icon" aria-hidden="true" data-v-31389a4c>ğŸ¯</div><div class="label" data-v-31389a4c>Locked</div></div><div class="badge locked" data-v-31389a4c><div class="icon" aria-hidden="true" data-v-31389a4c>â±ï¸</div><div class="label" data-v-31389a4c>Locked</div></div></div><small class="muted note" data-v-31389a4c>Achievement tracking coming soon.</small></section>',1))])]))}}),le=H(ae,[["__scopeId","data-v-31389a4c"]]);export{le as default};
