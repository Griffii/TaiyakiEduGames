import{d as y,r as k,U as P,c as N,o as H,k as I,a,b as n,t as r,F as V,h as A,v as x,C as D,f as o,i as F,w as G,e as h,B as M,R,s as p,_ as w}from"./index-DQVeBxL9.js";const z={class:"page"},J={class:"content"},K={key:0,class:"muted"},O={key:1,class:"error"},j={key:2,class:"muted"},Q={key:3,class:"grid","aria-label":"Textbook list"},W={class:"cover-wrap"},X=["src","alt","onError"],Y={key:1,class:"cover-fallback"},Z={class:"cover-title"},ee={class:"chips br"},te={key:0,class:"chip"},se={key:1,class:"chip"},oe={class:"meta"},ae={class:"t"},ne={key:0,class:"s"},ce={key:1,class:"s year"},re={class:"s level"},ie={class:"cd-centered"},le="public-assets",de=y({__name:"TextbookList",setup(b){const d=k(!0),l=k(null),v=k([]),S=k(!1),f=P(new Set),B=t=>f.has(t),T=t=>f.add(t);function $(t){return!!t&&/^https?:\/\//i.test(t)}function C(t){const{data:s}=p.storage.from(le).getPublicUrl(t);return s?.publicUrl||""}function m(t){const s=t.cover_image_url||"";return s?$(s)?s:C(String(s)):""}function g(t){return t.series?String(t.series):""}function U(t){const s=(t.tags||[]).map(e=>String(e).toUpperCase().trim());return s.includes("ES")?"å°å­¦æ ¡":s.includes("JHS")?"ä¸­å­¦æ ¡":s.includes("HS")?"é«˜æ ¡":"ä»–"}const L=N(()=>{const t=[...v.value],s=(e,i)=>{const u=`${e.series||""}${e.year||""}${e.title}`,c=`${i.series||""}${i.year||""}${i.title}`;return u.localeCompare(c,void 0,{numeric:!0})};return t.sort(s),t});async function q(){d.value=!0,l.value=null;try{const{data:t,error:s}=await p.from("textbooks").select("id, title, slug, series, year, tags, cover_image_url").order("title",{ascending:!0});if(s)throw s;const{data:e,error:i}=await p.from("v_textbook_deck_card_totals").select("textbook_id, deck_count, unique_card_count");if(i)throw i;const u=new Map;for(const c of e||[]){const _=c.textbook_id??c.id??c.textbook_uuid;_&&u.set(String(_),{deck_count:c.deck_count??null,unique_card_count:c.unique_card_count??null})}v.value=(t||[]).map(c=>{const _=u.get(c.id)||{deck_count:null,unique_card_count:null};return{...c,..._}})}catch(t){l.value=t?.message??String(t)}finally{d.value=!1}}async function E(){const{data:t}=await p.auth.getSession();S.value=!!t.session}return H(async()=>{await I(async()=>{await Promise.all([q(),E()])},150)}),(t,s)=>(o(),a("div",z,[s[0]||(s[0]=n("header",{class:"head"},[n("div",{class:"head-inner"},[n("div",{class:"head-text"})])],-1)),n("main",J,[d.value?(o(),a("p",K,"Loading textbooksâ€¦")):l.value?(o(),a("p",O,r(l.value),1)):v.value.length===0?(o(),a("p",j,"No textbooks found.")):(o(),a("section",Q,[(o(!0),a(V,null,A(L.value,e=>(o(),F(M(R),{key:e.id,class:"card",role:"listitem",to:{name:"textbook_details",params:{id:e.id}},title:e.title},{default:G(()=>[n("div",W,[!B(e.id)&&m(e)?(o(),a("img",{key:0,class:"cover",src:m(e),alt:e.title,loading:"lazy",decoding:"async",onError:()=>T(e.id)},null,40,X)):(o(),a("div",Y,[n("span",Z,r(e.title),1)])),n("div",ee,[typeof e.deck_count=="number"?(o(),a("span",te," ðŸ“š "+r(e.deck_count),1)):h("",!0),typeof e.unique_card_count=="number"?(o(),a("span",se," ðŸƒ "+r(e.unique_card_count),1)):h("",!0)])]),n("div",oe,[n("div",ae,r(e.title),1),g(e)?(o(),a("div",ne,r(g(e)),1)):h("",!0),e.year?(o(),a("div",ce,r(e.year),1)):h("",!0),n("div",re,r(U(e)),1)])]),_:2},1032,["to","title"]))),128))])),n("section",ie,[x(D)])])]))}}),ue=w(de,[["__scopeId","data-v-c64e1cbf"]]),_e={class:"flashcard-grid-page"},ke={class:"center-area"},he=y({__name:"TextbookGridPage",setup(b){return(d,l)=>(o(),a("section",_e,[n("div",ke,[x(ue)])]))}}),ve=w(he,[["__scopeId","data-v-d9204b0b"]]);export{ve as default};
