import{i as Ee,r as f,c as $,o as Pe,a as c,g as Y,d as a,h as C,f as B,t as k,k as be,v as ke,T as Te,F as D,e as L,p as Re,E as qe,b as r,n as ye,_ as Ue,N as Xe,w as Je,j as Be,C as we,H as Se,G as xe,x as he,y as Fe,u as Ke,B as $e,O as Ie}from"./index-BgZ5dwRh.js";import{b as Qe}from"./back-icon-xKqy7r3s.js";import{s as Ze}from"./settings-icon-DJLQOoae.js";import{h as Oe,w as We}from"./shokichi-KW1WytDh.js";const et="/TaiyakiEduGames/assets/mystery-machine-icon-DFeu74Q1.png",tt="/TaiyakiEduGames/assets/mystery-machine-body-D8HKPlGZ.png",at="/TaiyakiEduGames/assets/slot-arm-christmas-42_i7_I_.png",st="/TaiyakiEduGames/assets/slot-machine-DpezDdAa.mp3",ze="/TaiyakiEduGames/assets/daikichi-C_c_FTXQ.mp3",Le="/TaiyakiEduGames/assets/daikyo-CY7yqnN5.mp3",lt="/TaiyakiEduGames/assets/kichi--kgZ_B-c.mp3",Ge="/TaiyakiEduGames/assets/kyo-B7Jx3MGi.mp3",nt={class:"mm-stage"},ot={class:"mm-machine"},it={class:"mm-stack"},rt={class:"mm-top-panel"},ut={class:"wager-section"},ct={class:"wager-inner"},dt={class:"wager-header"},pt={class:"wager-controls"},vt=["disabled"],ft={class:"wager-value-block"},mt={class:"wager-amount"},yt=["disabled"],ht={class:"mm-toast-panel"},bt={key:"toast",class:"mm-toast"},_t={class:"mm-toast-text"},gt={class:"reels-layer"},wt={class:"slot-frame"},kt={class:"reel-symbol"},Tt=["src"],Ct=["disabled","aria-disabled"],St=["src"],xt={key:0,class:"effect-modal"},$t={class:"effect-header"},Mt={class:"effect-title"},Et={class:"effect-body"},Pt={class:"effect-description"},Ut=48,Ne=3500,At=Ee({__name:"MysteryMachine",props:{maxWager:{}},emits:["close","resolved","effect-opened"],setup(_e,{emit:Q}){const I=tt,G=at;let M=null;const T=new Map;typeof window<"u"&&typeof Audio<"u"&&(M=new Audio(st),T.set("return",Oe),T.set("quadruple",ze),T.set("lose_all",Le),T.set("double",lt),T.set("lose_half",Ge),T.set("triple",We));function d(){if(M)try{M.currentTime=0,M.play().catch(()=>{})}catch{}}function v(o){const i=T.get(o);if(i)try{const u=new Audio(i);u.currentTime=0,u.play().catch(()=>{})}catch{}}const h=_e,S=Q,y=f(10),H=["ðŸ’£","âš–ï¸","â­•","âœ¨","ðŸ†","7ï¸âƒ£"],b={lose_all:"ðŸ’£",lose_half:"â­•",return:"âš–ï¸",double:"âœ¨",triple:"ðŸ†",quadruple:"7ï¸âƒ£"},j=360/H.length,g=[2300,2900,3400],U=f([0,0,0]),w=f(!1),Z=f(!1),q=f(!1),X=f(null),E=f(null),F=f(0),O=f(null),N=f(!1),W=f(!1),J=f(!1),se=f(""),ue=[{id:"t1_reflip",tier:1,label:"Re-flip: must take the second card"},{id:"t1_flip2_pick1",tier:1,label:"Flip 2 cards and pick 1"},{id:"t1_shield",tier:1,label:"Shield: no one can steal from you until the next Mystery round"}],le=[{id:"t2_double_next",tier:2,label:"Double next card: your next card is worth 2x"},{id:"t2_steal40_one",tier:2,label:"Steal 40 points from one team"},{id:"t2_give40_one",tier:2,label:"Give 40 points to one team"}],ce=[{id:"t3_triple_next",tier:3,label:"Triple next card: your next card is worth 3x"},{id:"t3_steal20_each",tier:3,label:"Steal 20 points from each team"},{id:"t3_swap_any_team",tier:3,label:"Swap total points with any one team"},{id:"t3_rain_of_points",tier:3,label:"Rain of points: +80 for you, +40 for all other teams"}],R={t1_reflip:"Use once: if you dislike your next card, flip again â€” but you must keep the second card.",t1_flip2_pick1:"Next time you earn a card, flip 2 cards instead of 1 and choose which one to keep.",t1_shield:"Until the next Mystery round, other teams cannot steal points from you.",t2_double_next:"Your next card is worth double its normal value. Use it on your next card flip.",t2_steal40_one:"Immediately steal 40 points from any one team of your choice.",t2_give40_one:"Immediately give 40 points to any one team. Use it to help or create alliances.",t3_triple_next:"Your next card is worth triple its normal value. Big risk, big reward.",t3_steal20_each:"Immediately steal 20 points from every other team and add them to your score.",t3_swap_any_team:"Swap your total score with any one team. You choose who trades with you.",t3_rain_of_points:"You gain +80 points, then every other team on the board gains +40 points."},z=[{type:"lose_all",weight:22},{type:"lose_half",weight:18},{type:"return",weight:25},{type:"double",weight:18},{type:"triple",weight:10},{type:"quadruple",weight:7}],ee=[],x=$(()=>!(w.value||y.value<10||y.value%10!==0||h.maxWager!=null&&y.value>h.maxWager)),A=$(()=>!!E.value&&!!X.value&&!w.value),te=$(()=>V(y.value)),K=$(()=>E.value?R[E.value.id]??E.value.label:"");function de(o){switch(o){case"lose_all":return"Lose all wager";case"lose_half":return"Lose half wager";case"return":return"No change (return wager)";case"double":return"Double wager";case"triple":return"Triple wager";case"quadruple":return"Quadruple wager"}}$(()=>{const o=z.reduce((i,u)=>i+u.weight,0);return z.map(({type:i,weight:u})=>{const _=u/o*100;return{type:i,name:de(i),percent:_.toFixed(1)}})});function ne(){y.value<0&&(y.value=0),h.maxWager!=null&&y.value>h.maxWager&&(y.value=h.maxWager),y.value%10!==0&&(y.value=Math.round(y.value/10)*10)}function V(o){return o>=100?3:o>=50?2:1}function P(o){let i=[];o>=1&&(i=i.concat(ue)),o>=2&&(i=i.concat(le)),o>=3&&(i=i.concat(ce));const u=Math.floor(Math.random()*i.length);return i[u]}function pe(){const o=z.reduce((_,re)=>_+re.weight,0),i=Math.random()*o;let u=0;for(const _ of z)if(u+=_.weight,i<=u)return _.type;return"return"}function ve(o,i){let u="",_=0;switch(o){case"lose_all":u="You lost your entire wager",_=-i;break;case"lose_half":u="You lost half your wager",_=-Math.round(i/2);break;case"return":u="Your wager was returned (no change)",_=0;break;case"double":u="Your wager was doubled",_=i;break;case"triple":u="Your wager was tripled",_=2*i;break;case"quadruple":u="Your wager was quadrupled",_=3*i;break}return{outcome:{type:o,label:u},delta:_}}function fe(o){const u=`rotateX(${U.value[o]}deg)`;if(Z.value)return{transform:u,transition:"transform 0s"};if(w.value){const _=g[o]??Ne;return{transform:u,transition:`transform ${_}ms cubic-bezier(.2,.8,.3,1.1)`}}return{transform:u,transition:"transform 0s"}}function oe(o){return{transform:`rotateX(${o*j}deg) translateZ(${Ut}px)`}}function ie(o,i){const u=o===0?"0 points":`${o>0?"+":""}${o} points`;se.value=u,J.value=!0,v(i)}function ae(){J.value=!1}function l(){if(!x.value)return;ne(),X.value=null,E.value=null,F.value=0,O.value=null,N.value=!1,J.value=!1;const o=pe(),{outcome:i,delta:u}=ve(o,y.value),_=V(y.value),re=P(_),ge=b[o],Ae=H.indexOf(ge),He=Ae>=0?Ae:0;w.value=!1,Z.value=!0,U.value=[0,0,0];try{document.body.offsetHeight}catch{}window.requestAnimationFrame(()=>{Z.value=!1,w.value=!0;const Ve=3;U.value=U.value.map((Ce,je)=>-((Ve+je)*360+He*j));const Ye=window.setTimeout(()=>{X.value=i,E.value=re,F.value=u,w.value=!1;const Ce={wager:y.value,wagerOutcome:i,pointsDelta:u,tier:_,effect:re};O.value=Ce,S("resolved",Ce),ie(u,i.type)},Ne);ee.push(Ye)})}function e(){if(!x.value||w.value)return;q.value=!0,d();const o=window.setTimeout(()=>{q.value=!1},350);ee.push(o),l()}function t(o){w.value||(y.value+=o,y.value<0&&(y.value=0),ne())}function s(){!A.value||!E.value||(N.value=!0,O.value&&S("effect-opened",O.value))}function n(){N.value=!1}function p(){S("close")}function m(){p()}return Pe(()=>{ee.forEach(o=>clearTimeout(o))}),(o,i)=>(r(),c("section",{class:"mystery-machine-overlay",role:"dialog","aria-modal":"true",onClick:Y(m,["self"])},[a("button",{class:"overlay-prizes-btn",type:"button",onClick:i[0]||(i[0]=u=>W.value=!0),"aria-label":"View prize tiers"}," â“ "),a("button",{class:"overlay-close-btn",type:"button",onClick:p,"aria-label":"Close Mystery Machine"}," âœ• "),a("div",nt,[a("section",ot,[a("div",it,[a("div",rt,[a("section",ut,[a("div",ct,[a("div",dt,[i[4]||(i[4]=a("span",{class:"wager-label"},"Wager",-1)),a("span",{class:B(["wager-tier-pill",`tier-${te.value}`])}," Tier "+k(te.value),3)]),a("div",pt,[a("button",{type:"button",class:"arrow-btn",onClick:i[1]||(i[1]=u=>t(-10)),disabled:w.value||y.value<=0,"aria-label":"Decrease wager"}," â—€ ",8,vt),a("div",ft,[a("span",mt,k(y.value)+" pts ",1)]),a("button",{type:"button",class:"arrow-btn",onClick:i[2]||(i[2]=u=>t(10)),disabled:w.value||o.maxWager!=null&&y.value>=o.maxWager,"aria-label":"Increase wager"}," â–¶ ",8,yt)])])])]),a("div",ht,[be(Te,{name:"mm-toast-slide"},{default:ke(()=>[J.value?(r(),c("div",bt,[a("span",_t,k(se.value),1),a("button",{class:"mm-toast-close",type:"button",onClick:ae,"aria-label":"Dismiss message"}," âœ• ")])):C("",!0)]),_:1})]),a("div",gt,[a("div",wt,[(r(!0),c(D,null,L(U.value,(u,_)=>(r(),c("div",{key:_,class:"reel3d"},[a("div",{class:"reel3d-inner",style:ye(fe(_))},[(r(),c(D,null,L(H,(re,ge)=>a("div",{key:ge,class:"reel-face",style:ye(oe(ge))},[a("span",kt,k(re),1)],4)),64))],4)]))),128))])]),a("img",{src:Re(I),alt:"Mystery Machine body",class:"machine-body-img",draggable:"false"},null,8,Tt),A.value&&!N.value?(r(),c("button",{key:0,class:B(["prize-btn",{"has-prize":A.value}]),type:"button",onClick:s},[...i[5]||(i[5]=[a("span",{class:"prize-label"},"ðŸŽ Mystery Prize",-1)])],2)):C("",!0),a("button",{class:"slot-arm-btn",type:"button",disabled:!x.value||w.value,onClick:e,"aria-disabled":!x.value||w.value},[a("img",{src:Re(G),alt:"Pull to spin",class:B(["slot-arm-img",{"is-disabled":!x.value||w.value,"is-pulled":q.value}]),draggable:"false"},null,10,St)],8,Ct)])])]),N.value&&E.value?(r(),c("div",{key:0,class:"effect-modal-overlay",onClick:Y(n,["self"])},[be(Te,{name:"mm-card-pop"},{default:ke(()=>[N.value?(r(),c("div",xt,[a("div",$t,[a("h3",Mt,k(E.value.label),1),a("span",{class:B(["effect-tier-chip",`tier-${E.value.tier}`])}," Tier "+k(E.value.tier),3)]),a("div",Et,[a("p",Pt,k(K.value),1)]),a("div",{class:"effect-actions"},[a("button",{class:"pill-btn primary",type:"button",onClick:n}," Close ")])])):C("",!0)]),_:1})])):C("",!0),W.value?(r(),c("div",{key:1,class:"effect-modal-overlay",onClick:i[3]||(i[3]=Y(u=>W.value=!1,["self"]))},[...i[6]||(i[6]=[qe('<div class="effect-modal info-modal" data-v-0ee0e5e5><h3 class="effect-title" data-v-0ee0e5e5>Outcomes &amp; Prizes</h3><div class="prize-grid" data-v-0ee0e5e5><section class="prize-col" data-v-0ee0e5e5><h4 class="prize-heading" data-v-0ee0e5e5>Wager Outcomes</h4><div class="outcome-grid" data-v-0ee0e5e5><div class="outcome-card outcome-bad-1" data-v-0ee0e5e5><span class="outcome-label" data-v-0ee0e5e5>Lose all</span><span class="outcome-pct" data-v-0ee0e5e5>~22%</span></div><div class="outcome-card outcome-bad-2" data-v-0ee0e5e5><span class="outcome-label" data-v-0ee0e5e5>Lose half</span><span class="outcome-pct" data-v-0ee0e5e5>~18%</span></div><div class="outcome-card outcome-neutral" data-v-0ee0e5e5><span class="outcome-label" data-v-0ee0e5e5>No change</span><span class="outcome-pct" data-v-0ee0e5e5>~25%</span></div><div class="outcome-card outcome-good" data-v-0ee0e5e5><span class="outcome-label" data-v-0ee0e5e5>2Ã—</span><span class="outcome-pct" data-v-0ee0e5e5>~18%</span></div><div class="outcome-card outcome-good" data-v-0ee0e5e5><span class="outcome-label" data-v-0ee0e5e5>3Ã—</span><span class="outcome-pct" data-v-0ee0e5e5>~10%</span></div><div class="outcome-card outcome-good" data-v-0ee0e5e5><span class="outcome-label" data-v-0ee0e5e5>4Ã—</span><span class="outcome-pct" data-v-0ee0e5e5>~7%</span></div></div></section><section class="prize-col" data-v-0ee0e5e5><h4 class="prize-heading" data-v-0ee0e5e5>Prize Cards by Tier</h4><div class="tier-grid" data-v-0ee0e5e5><article class="tier-card tier-1" data-v-0ee0e5e5><header class="tier-header" data-v-0ee0e5e5><span class="tier-title" data-v-0ee0e5e5>Tier 1: 10+ points</span></header><ul class="tier-list" data-v-0ee0e5e5><li data-v-0ee0e5e5>Re-flip</li><li data-v-0ee0e5e5>Flip 2, pick 1</li><li data-v-0ee0e5e5>Shield (block a bad card)</li></ul></article><article class="tier-card tier-2" data-v-0ee0e5e5><header class="tier-header" data-v-0ee0e5e5><span class="tier-title" data-v-0ee0e5e5>Tier 2: 50+ points</span></header><ul class="tier-list" data-v-0ee0e5e5><li data-v-0ee0e5e5>Double next card (x2)</li><li data-v-0ee0e5e5>Steal 40 from one team</li><li data-v-0ee0e5e5>Give 40 to one team</li></ul></article><article class="tier-card tier-3" data-v-0ee0e5e5><header class="tier-header" data-v-0ee0e5e5><span class="tier-title" data-v-0ee0e5e5>Tier 3: 100+ points</span></header><ul class="tier-list" data-v-0ee0e5e5><li data-v-0ee0e5e5>Triple next card (x3)</li><li data-v-0ee0e5e5>Steal 20 from each team</li><li data-v-0ee0e5e5>Swap scores with any team</li><li data-v-0ee0e5e5>Rain of Points (+80 you, +40 others)</li></ul></article></div></section></div><p class="prize-disclaimer" data-v-0ee0e5e5> *All cards except for <strong data-v-0ee0e5e5>Re-flip</strong> and <strong data-v-0ee0e5e5>Flip 2 â†’ 1</strong> are applied automatically. If a team has either of those perks, points will <u data-v-0ee0e5e5>not</u> be auto-assigned when a card is flipped. You can remove perk chips by editing the team or by clicking the ðŸš« button at the top right of the team tabs to remove all chips from all teams. </p></div>',1)])])):C("",!0)]))}}),Rt=Ue(At,[["__scopeId","data-v-0ee0e5e5"]]),Ft={key:0,class:"team-points-tracker"},It={key:0,class:"tracker-shell"},Nt={class:"tracker-row"},Dt={class:"left-stack"},Bt=["disabled"],Ot=["aria-pressed","title"],Wt={class:"tabs-row"},zt=["onClick"],Lt={class:"tab-inner"},Gt={class:"team-name"},Ht={class:"team-points"},Vt={key:0,class:"team-powerups"},Yt={key:0,class:"leader-crown","aria-label":"Current leader",role:"img"},jt={class:"team-controls"},qt=["disabled"],Xt=["disabled"],Jt={class:"edit-field"},Kt={class:"edit-field"},Qt={key:0,class:"edit-field powerups-field"},Zt={class:"edit-powerups-list"},ea=["onClick"],ta={class:"chip-label"},aa={class:"edit-actions"},sa=["disabled"],la={class:"fullscreen-modal"},na={class:"fullscreen-grid"},oa={key:0,class:"fullscreen-crown","aria-label":"Current leader",role:"img"},ia={class:"fullscreen-name"},ra={class:"fullscreen-points"},ua={class:"fullscreen-modal"},ca={class:"fullscreen-header"},da={class:"fullscreen-title"},pa={class:"fullscreen-subtitle"},va={class:"fullscreen-grid"},fa=["onClick"],ma={key:0,class:"fullscreen-crown","aria-label":"Current leader",role:"img"},ya={class:"fullscreen-name"},ha={class:"fullscreen-points"},ba={key:0,class:"rain-overlay"},_a=Ee({__name:"TeamPointsTracker",props:{teams:{},maxTeams:{}},emits:["update:teams","team-selected"],setup(_e,{expose:Q,emit:I}){const G=_e,M=I,T=$(()=>{const e=G.maxTeams??8;return Math.min(Math.max(e,1),8)}),d=f([]),v=f(-1),h=f(!1),S=f(!1),y=f(!0),H=f(!1),b=Xe({name:"",points:0,powerUps:[]}),j=f(null);Je(()=>G.teams,e=>{if(Array.isArray(e)&&e.length>0)d.value=e.slice(0,T.value).map((t,s)=>({id:t.id??s,name:t.name??`Team ${s+1}`,points:Number.isFinite(t.points)?t.points:0,powerUps:Array.isArray(t.powerUps)?[...t.powerUps]:[]}));else if(!d.value.length){const t=Math.min(4,T.value);d.value=Array.from({length:t}).map((s,n)=>({id:n,name:`Team ${n+1}`,points:0,powerUps:[]}))}},{immediate:!0,deep:!0});const g=$(()=>d.value.slice(0,T.value));function U(e){return e<0||e>=d.value.length?null:d.value[e]}function w(e,t){const s=[...d.value];s[e]=t,d.value=s,M("update:teams",s)}function Z(e){v.value===e?(v.value=-1,h.value=!1,M("team-selected",null)):(v.value=e,h.value=!1,M("team-selected",g.value[e]??null))}function q(){const e=v.value;if(!(e<0||e>=g.value.length)&&(h.value=!h.value,h.value)){const t=g.value[e];b.name=t.name,b.points=t.points,b.powerUps=Array.isArray(t.powerUps)?[...t.powerUps]:[]}}function X(){if(v.value<0||v.value>=g.value.length)return;const e=v.value,t=[...d.value],s=Number.isFinite(b.points)?Math.round(b.points):0,n=t[e];t[e]={...n,name:b.name.trim()||`Team ${e+1}`,points:s,powerUps:[...b.powerUps]},d.value=t,M("update:teams",t),h.value=!1}function E(e){if(!h.value)return;const t=j.value;if(!t)return;const s=e.target;s&&(t.contains(s)||(h.value=!1))}const F=$(()=>{const e=g.value;if(!e.length)return-1;let t=-1/0,s=-1;return e.forEach((n,p)=>{n.points>t&&(t=n.points,s=p)}),t<=0?-1:s}),O=$(()=>F.value!==-1),N=$(()=>d.value.length<T.value),W=$(()=>d.value.length>1);function J(){if(!N.value)return;const e=[...d.value],t=e.length,n={id:(e.length>0?Math.max(...e.map(p=>p.id)):-1)+1,name:`Team ${t+1}`,points:0,powerUps:[]};e.push(n),d.value=e,v.value=t,h.value=!1,M("update:teams",e),M("team-selected",n)}function se(){if(!W.value)return;const e=v.value;e<0||le(e)}function ue(){W.value&&(v.value<0||v.value>=g.value.length||le(v.value))}function le(e){const t=[...d.value];if(e<0||e>=t.length)return;t.splice(e,1);const s=Math.min(e,t.length-1);v.value=t.length?Math.max(s,0):-1,h.value=!1,d.value=t,M("update:teams",t),M("team-selected",t[v.value]??null)}function ce(e){e<0||e>=b.powerUps.length||b.powerUps.splice(e,1)}function R(){S.value=!S.value}function z(){S.value=!1}function ee(e){if(!g.value.length||!Number.isFinite(e))return;const t=v.value;if(t<0||t>=g.value.length)return;const s=U(t);if(!s)return;const n=Math.round(e),p={...s,points:(s.points??0)+n,powerUps:s.powerUps??[]};w(t,p)}function x(e,t){if(e<0||e>=d.value.length||!Number.isFinite(t))return;const s=U(e);if(!s)return;const n={...s,points:s.points+Math.round(t),powerUps:s.powerUps??[]};w(e,n)}function A(e,t){if(e<0||e>=d.value.length)return;const s=U(e);if(!s)return;const n={...s,points:Math.round(t),powerUps:s.powerUps??[]};w(e,n)}function te(e,t,s,n,p){if(e<0||e>=d.value.length)return;const m=U(e);if(!m)return;const i=[...m.powerUps??[],{id:t,tier:s,label:n,scope:p}],u={...m,powerUps:i};w(e,u)}function K(e){const t=v.value;t<0||t>=g.value.length||te(t,e.id,e.tier,e.label,"round")}function de(){const e=v.value;if(e<0||e>=d.value.length)return[];const t=d.value[e];return Array.isArray(t.powerUps)?[...t.powerUps]:[]}function ne(e){const t=v.value;if(t<0||t>=d.value.length)return;const s=U(t);if(!s)return;const n=Array.isArray(s.powerUps)?[...s.powerUps]:[],p=n.findIndex(o=>o.id===e);if(p===-1)return;n.splice(p,1);const m={...s,powerUps:n};w(t,m)}function V(){const e=d.value.map(t=>({...t,powerUps:[]}));d.value=e,M("update:teams",e)}const P=f(null),pe=$(()=>{const e=P.value;if(!e)return"";switch(e.mode){case"steal40_one":return"Steal 40 points";case"give40_one":return"Give 40 points";case"swap_any_team":return"Swap scores with a team"}}),ve=$(()=>{const e=P.value;if(!e)return"";switch(e.mode){case"steal40_one":return"Click a team to steal 40 points from them.";case"give40_one":return"Click a team to give them 40 points.";case"swap_any_team":return"Click a team to swap total scores with them."}});function fe(e){const t=d.value;t.length&&(H.value=!0,window.setTimeout(()=>{t.forEach((s,n)=>{n===e?x(n,80):x(n,40)}),H.value=!1},900))}function oe(e){const t=v.value;if(!(t<0||t>=g.value.length))switch(e.id){case"t2_steal40_one":P.value={mode:"steal40_one",prize:e,sourceIndex:t};return;case"t2_give40_one":P.value={mode:"give40_one",prize:e,sourceIndex:t};return;case"t3_swap_any_team":P.value={mode:"swap_any_team",prize:e,sourceIndex:t};return;case"t3_rain_of_points":{fe(t);return}case"t3_steal20_each":{const s=d.value;if(s.length<=1)return;let n=0;s.forEach((p,m)=>{m!==t&&(x(m,-20),n+=20)}),n!==0&&x(t,n);return}default:return}}function ie(){P.value=null}function ae(e){const t=P.value;if(!t)return;const s=t.sourceIndex;if(!(e<0||e>=d.value.length)&&e!==s){switch(t.mode){case"steal40_one":{x(e,-40),x(s,40);break}case"give40_one":{x(e,40);break}case"swap_any_team":{const n=U(s),p=U(e);if(!n||!p)break;const m=n.points,o=p.points;A(s,o),A(e,m);break}}P.value=null}}function l(e,t){switch(e){case"t1_reflip":return"Re-flip";case"t1_flip2_pick1":return"2â†’1";case"t1_shield":return"Shield";case"t2_double_next":return"x2";case"t3_triple_next":return"x3";case"t2_steal40_one":return"Steal 40";case"t2_give40_one":return"Give 40";case"t3_steal20_each":return"Steal 20 each";case"t3_swap_any_team":return"Swap";case"t3_rain_of_points":return"Rain";default:return t}}return Q({addPoints:x,setPoints:A,applyDeltaToSelected:ee,addPrizeToSelected:K,getHeldPowersForSelected:de,consumeHeldPower:ne,clearRoundPowerUps:V,resolveImmediateMysteryEffect:oe}),Be(()=>{window.addEventListener("pointerdown",E,{capture:!0})}),Pe(()=>{window.removeEventListener("pointerdown",E,{capture:!0})}),(e,t)=>g.value.length?(r(),c("section",Ft,[y.value?(r(),c("button",{key:0,type:"button",class:"reopen-btn",onClick:t[0]||(t[0]=s=>y.value=!1),title:"Show team scores"}," â–¾ ")):C("",!0),be(Te,{name:"tracker-slide"},{default:ke(()=>[y.value?C("",!0):(r(),c("div",It,[a("div",Nt,[a("div",Dt,[a("button",{type:"button",class:"stack-btn collapse-btn",onClick:t[1]||(t[1]=s=>y.value=!0),title:"Hide team bar"}," â–´ "),a("button",{type:"button",class:"stack-btn edit-btn",onClick:q,disabled:v.value<0||v.value>=g.value.length,title:"Edit selected team"}," âœ ",8,Bt),a("button",{type:"button",class:"stack-btn fullscreen-btn",onClick:R,"aria-pressed":S.value,title:S.value?"Close scoreboard view":"Open scoreboard view"}," â›¶ ",8,Ot)]),a("div",Wt,[(r(!0),c(D,null,L(g.value,(s,n)=>(r(),c("button",{key:s.id,class:B(["team-tab",{"is-selected":n===v.value,"is-leader":n===F.value}]),type:"button",onClick:p=>Z(n)},[a("div",Lt,[a("span",Gt,k(s.name||`Team ${n+1}`),1),a("span",Ht,k(s.points),1),s.powerUps&&s.powerUps.length?(r(),c("div",Vt,[(r(!0),c(D,null,L(s.powerUps,(p,m)=>(r(),c("span",{key:`${s.id}-pu-${m}`,class:B(["powerup-chip",[`tier-${p.tier}`,p.scope==="round"?"is-round":"is-next"]])},k(l(p.id,p.label)),3))),128))])):C("",!0)]),F.value===n&&O.value?(r(),c("span",Yt," ðŸ‘‘ ")):C("",!0)],10,zt))),128))]),a("div",jt,[a("button",{class:"side-btn",type:"button",onClick:V,title:"Remove all perks from all teams"}," ðŸš« "),a("button",{class:"side-btn",type:"button",disabled:!W.value,onClick:se,title:"Remove team"}," âˆ’ ",8,qt),a("button",{class:"side-btn",type:"button",disabled:!N.value,onClick:J,title:"Add team"}," ï¼‹ ",8,Xt)])]),h.value&&v.value!==-1?(r(),c("div",{key:0,class:"edit-panel",ref_key:"editPanelRef",ref:j},[a("div",Jt,[a("label",null,[t[4]||(t[4]=xe(" Team name ",-1)),he(a("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>b.name=s),type:"text",maxlength:"24"},null,512),[[Fe,b.name]])])]),a("div",Kt,[a("label",null,[t[5]||(t[5]=xe(" Points ",-1)),he(a("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>b.points=s),type:"number",step:"1"},null,512),[[Fe,b.points,void 0,{number:!0}]])])]),b.powerUps&&b.powerUps.length?(r(),c("div",Qt,[a("label",null,[t[7]||(t[7]=xe(" Power-ups ",-1)),a("div",Zt,[(r(!0),c(D,null,L(b.powerUps,(s,n)=>(r(),c("button",{key:`edit-pu-${n}-${s.id}`,type:"button",class:"edit-powerup-chip",onClick:p=>ce(n)},[a("span",ta,k(l(s.id,s.label)),1),t[6]||(t[6]=a("span",{class:"chip-remove"},"âœ•",-1))],8,ea))),128))])])])):C("",!0),a("div",aa,[a("button",{type:"button",class:"btn small danger",disabled:!W.value,onClick:ue}," Delete ",8,sa),a("button",{type:"button",class:"btn small primary",onClick:X}," Save ")])],512)):C("",!0)]))]),_:1}),(r(),we(Se,{to:"body"},[S.value?(r(),c("div",{key:0,class:"fullscreen-overlay",onClick:Y(z,["self"])},[a("div",la,[a("header",{class:"fullscreen-header"},[t[8]||(t[8]=a("h2",{class:"fullscreen-title"}," Team Scores ",-1)),a("button",{type:"button",class:"btn small secondary",onClick:z}," Close ")]),a("div",na,[(r(!0),c(D,null,L(g.value,(s,n)=>(r(),c("article",{key:s.id,class:B(["fullscreen-card",{"is-leader":n===F.value}])},[n===F.value&&O.value?(r(),c("div",oa," ðŸ‘‘ ")):C("",!0),a("div",ia,k(s.name||`Team ${n+1}`),1),a("div",ra,k(s.points),1)],2))),128))])])])):C("",!0)])),(r(),we(Se,{to:"body"},[P.value?(r(),c("div",{key:0,class:"fullscreen-overlay",onClick:Y(ie,["self"])},[a("div",ua,[a("header",ca,[a("h2",da,k(pe.value),1),a("button",{type:"button",class:"btn small secondary",onClick:ie}," Cancel ")]),a("p",pa,k(ve.value),1),a("div",va,[(r(!0),c(D,null,L(g.value,(s,n)=>(r(),c("article",{key:"effect-"+s.id,class:B(["fullscreen-card",{"is-leader":n===F.value,"is-disabled":n===P.value?.sourceIndex}]),onClick:p=>ae(n)},[n===F.value&&O.value?(r(),c("div",ma," ðŸ‘‘ ")):C("",!0),a("div",ya,k(s.name||`Team ${n+1}`),1),a("div",ha,k(s.points),1)],10,fa))),128))])])])):C("",!0)])),(r(),we(Se,{to:"body"},[be(Te,{name:"rain-pop"},{default:ke(()=>[H.value?(r(),c("div",ba,[...t[9]||(t[9]=[a("div",{class:"rain-label"}," ðŸŒ§ï¸ Rain of Points! ðŸŒˆ ",-1)])])):C("",!0)]),_:1})]))])):C("",!0)}}),ga=Ue(_a,[["__scopeId","data-v-f55ab833"]]),wa="/TaiyakiEduGames/assets/mystery-machine-a5NpraJ-.mp3",ka=["aria-expanded"],Ta={class:"menu-row"},Ca={class:"menu-row"},Sa={class:"menu-row"},xa={class:"mute-row"},$a=["aria-pressed"],Ma={class:"label-cell row"},Ea=["onClick","onKeydown"],Pa={class:"face back"},Ua=.35,De="random-points-settings",Me=4,me=6,Aa=150,Ra=110,Fa=Ee({__name:"RandomPoints",setup(_e){const Q=f(!1),I=f(null),G=f(!1),M=f(null),T=f(!1),d=f(!0),v=f(!1),h=f(!0);f(!1);const S=f(!1),y=Me*me,H=["A","B","C","D","E","F"],b=f(Array.from({length:y},(l,e)=>({id:e,value:0,display:"",revealed:!1}))),j=f(typeof window<"u"?window.innerHeight:800),g=f(typeof window<"u"?window.innerWidth:1280),U=Ke(),w=()=>U.back();function Z(){Q.value=!1}function q(){const l=I.value;if(!l||typeof l.getHeldPowersForSelected!="function")return[];const e=l.getHeldPowersForSelected();return Array.isArray(e)?e:[]}function X(l){return q().some(e=>e.id===l)}function E(l){const e=I.value,t=q(),s=t.some(o=>o.id==="t3_triple_next"),n=t.some(o=>o.id==="t2_double_next");let p=1;s?p=3:n&&(p=2);const m=l*p;if(p>1&&e&&typeof e.consumeHeldPower=="function"){const o=s?"t3_triple_next":"t2_double_next";e.consumeHeldPower(o)}return m}function F(l){if(!l||!l.effect||!G.value||!I.value)return;const e=I.value,t=l.effect,s=new Set(["t2_steal20_one","t2_give20_one","t3_steal10_each","t3_rain_of_points","t3_swap_any_team"]),n={id:t.id,tier:t.tier,label:t.label,source:"mystery",wager:l.wager};if(s.has(t.id)){typeof e.resolveImmediateMysteryEffect=="function"&&e.resolveImmediateMysteryEffect(n);return}typeof e.addPrizeToSelected=="function"&&e.addPrizeToSelected(n)}function O(l){if(!l||typeof l.pointsDelta!="number"||!G.value)return;const e=l.pointsDelta;e!==0&&I.value?.applyDeltaToSelected(e)}function N(l){G.value=!!l}const W=$(()=>{const l=g.value;return l<=360?22:l<=420?24:l<=520?26:l<=680?28:30}),J=$(()=>{const l=g.value;return l<=360?6:l<=420?7:l<=520?8:l<=680?9:10}),se=$(()=>({"--labelW":`${W.value}px`,"--gap":`${J.value}px`})),ue=$(()=>({height:`${Math.max(320,j.value-Aa-Ra)}px`,gridTemplateColumns:`var(--labelW) repeat(${me}, 1fr)`,gridTemplateRows:`repeat(${Me}, 1fr)`,gap:"var(--gap)"})),le=$(()=>({gridTemplateColumns:`var(--labelW) repeat(${me}, 1fr)`,gap:"var(--gap)"})),ce=(l,e)=>(l-1)*me+(e-1),R=(l,e)=>b.value[ce(l,e)],z=l=>typeof l!="number";function ee(l){return typeof l=="number"?l>0?"val-pos":l<0?"val-neg":"val-zero":"val-mystery val-text"}function x(l,e){return Math.floor(Math.random()*(e-l+1))+l}const A={positive:new Audio(We),negative:new Audio(Ge),swap:new Audio(Oe),loseAll:new Audio(Le),jackpot:new Audio(ze),mystery:new Audio(wa)};function te(){const l=S.value?0:Ua;A.positive.volume=l,A.negative.volume=l,A.swap.volume=l,A.loseAll.volume=l,A.jackpot.volume=l,A.mystery.volume=l}function K(l){const e=A[l];try{e.currentTime=0,e.play()}catch{}}function de(){S.value=!S.value,te(),oe()}function ne(){const l=[],t=v.value?200:100;if(l.push(t),h.value){const m=y-l.length;if(m>0){const o=x(2,5),i=Math.min(o,m);for(let u=0;u<i;u++)l.push("Mystery Machine")}}const s=y-l.length;let n=s,p=0;d.value&&(n=Math.floor(s*.7),p=s-n);for(let m=0;m<n;m++){const o=10*x(1,10),i=v.value?o*2:o;l.push(i)}for(let m=0;m<p;m++){const o=-10*x(1,5),i=v.value?o*2:o;l.push(i)}for(let m=l.length-1;m>0;m--){const o=Math.floor(Math.random()*(m+1));[l[m],l[o]]=[l[o],l[m]]}return l}function V(){const l=ne();for(let e=0;e<y;e++){const t=l[e],s=b.value[e];s.value=t,s.display=typeof t=="number"?String(t):t,s.revealed=!1}}function P(l){if(!l||l.revealed)return;if(typeof l.value=="string")K("mystery");else{const o=v.value?200:100;l.value===o?K("jackpot"):l.value>0?K("positive"):K("negative")}if(l.revealed=!0,typeof l.value!="number"||!G.value)return;const e=I.value;if(!e)return;const t=X("t1_flip2_pick1"),s=X("t1_reflip");if(t||s){console.debug("[RandomPoints] Card revealed but points not auto-assigned due to Flip2/Re-flip power.",{hasFlip2Pick1:t,hasReflip:s,cellValue:l.value});return}const n=l.value,p=E(n);e.applyDeltaToSelected(p)}function pe(){for(const l of b.value)l.revealed=!0}function ve(){V()}function fe(){T.value=!T.value}function oe(){localStorage.setItem(De,JSON.stringify({allowNegatives:d.value,doublePoints:v.value,allowSpecial:h.value,sfxMuted:S.value}))}function ie(){oe(),V(),T.value=!1}function ae(){j.value=window.innerHeight,g.value=window.innerWidth}return Be(()=>{try{const l=localStorage.getItem(De);if(l){const e=JSON.parse(l);typeof e.allowNegatives=="boolean"&&(d.value=e.allowNegatives),typeof e.doublePoints=="boolean"&&(v.value=e.doublePoints),typeof e.allowSpecial=="boolean"&&(h.value=e.allowSpecial),typeof e.sfxMuted=="boolean"&&(S.value=e.sfxMuted)}}catch{}te(),V(),ae(),window.addEventListener("resize",ae,{passive:!0})}),Pe(()=>{window.removeEventListener("resize",ae)}),(l,e)=>(r(),c("section",{class:"random-points-page app-bg",style:ye(se.value)},[be(ga,{ref_key:"teamTracker",ref:I,onTeamSelected:N},null,512),a("button",{class:"icon-btn back",type:"button",onClick:w,"aria-label":"Back",title:"Back"},[...e[6]||(e[6]=[a("img",{class:"icon",src:Qe,alt:""},null,-1)])]),a("button",{class:"icon-btn settings",type:"button",onClick:fe,"aria-haspopup":"dialog","aria-expanded":T.value,"aria-controls":"settings-menu","aria-label":"Open settings",title:"Settings"},[...e[7]||(e[7]=[a("img",{class:"icon",src:Ze,alt:""},null,-1)])],8,ka),a("button",{class:"icon-btn mystery",type:"button",onClick:e[0]||(e[0]=t=>Q.value=!0),"aria-label":"Open Mystery Machine",title:"Mystery Machine"},[...e[8]||(e[8]=[a("img",{class:"icon",src:et,alt:""},null,-1)])]),Q.value?(r(),we(Rt,{key:0,maxWager:M.value,onClose:Z,onResolved:O,onEffectOpened:F},null,8,["maxWager"])):C("",!0),T.value?(r(),c("div",{key:1,class:"settings-overlay",role:"presentation",onClick:e[5]||(e[5]=t=>T.value=!1)},[a("div",{id:"settings-menu",class:"settings-menu",role:"dialog","aria-modal":"true",onClick:e[4]||(e[4]=Y(()=>{},["stop"]))},[e[12]||(e[12]=a("h3",{class:"menu-title"},"Settings",-1)),a("label",Ta,[he(a("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=t=>d.value=t)},null,512),[[$e,d.value]]),e[9]||(e[9]=a("span",null,"Negative Numbers",-1))]),a("label",Ca,[he(a("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t)},null,512),[[$e,v.value]]),e[10]||(e[10]=a("span",null,"Double Points",-1))]),a("label",Sa,[he(a("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=t=>h.value=t)},null,512),[[$e,h.value]]),e[11]||(e[11]=a("span",null,"Mystery Machine Cards",-1))]),a("div",xa,[a("button",{class:"mute-btn","aria-pressed":S.value,onClick:de},k(S.value?"Unmute SFX":"Mute SFX"),9,$a)]),a("button",{class:"apply",onClick:ie},"Apply")])])):C("",!0),e[15]||(e[15]=a("h1",{class:"title"},null,-1)),a("div",{class:"labels",style:ye(le.value)},[e[13]||(e[13]=a("div",null,null,-1)),(r(),c(D,null,L(H,t=>a("div",{key:t,class:"label-cell"},k(t),1)),64))],4),a("div",{class:"grid",style:ye(ue.value)},[(r(),c(D,null,L(Me,t=>(r(),c(D,{key:`r-${t}`},[a("div",Ma,k(t),1),(r(),c(D,null,L(me,s=>a("div",{key:`c-${t}-${s}`,class:"grid-item"},[a("div",{class:B(["card",{"mystery-card":z(R(t,s).value),"mystery-card--revealed":z(R(t,s).value)&&R(t,s).revealed}]),role:"button",tabindex:"0",onClick:Y(n=>P(R(t,s)),["stop"]),onKeydown:[Ie(Y(n=>P(R(t,s)),["prevent"]),["enter"]),Ie(Y(n=>P(R(t,s)),["prevent"]),["space"])]},[a("div",{class:B(["flip-inner",{revealed:R(t,s).revealed}])},[e[14]||(e[14]=a("div",{class:"face front"},null,-1)),a("div",Pa,[a("span",{class:B(["value",ee(R(t,s).value)])},k(R(t,s).display),3)])],2)],42,Ea)])),64))],64))),64))],4),a("div",{class:"controls"},[a("button",{class:"big-btn",onClick:ve},"Reset"),a("button",{class:"big-btn",onClick:pe},"See All")])],4))}}),za=Ue(Fa,[["__scopeId","data-v-9be84c1e"]]);export{za as default};
