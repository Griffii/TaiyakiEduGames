import{i as Qe,S as Ye,r as n,m as Ze,c as m,N as ea,a3 as aa,a2 as sa,j as ta,w as la,L as _e,a as i,d as s,k as j,p as se,h as v,t as o,n as te,f as x,F as z,e as le,v as L,T as U,a0 as na,s as ne,u as oa,b as r,g as ia,x as we,G as be,a4 as ke,a1 as ra,_ as ua}from"./index-CRwM6Ms3.js";import{h as ca}from"./home-icon-CTPXHMtR.js";import{s as da}from"./settings-icon-DJLQOoae.js";import{h as va,w as fa}from"./shokichi-KW1WytDh.js";import{p as pa}from"./fanfare-CkYegsGg.js";const ma={class:"sg-wrap",role:"application","aria-label":"Spelling Guesser"},ga={class:"sg-head"},ha={class:"left"},_a=["src"],wa={class:"center"},ba={class:"sub"},ka={key:0,class:"category"},ya={class:"right"},Sa=["aria-expanded"],xa=["src"],Ca={class:"hint-wrap"},Ma=["disabled"],Ta={class:"sg-main"},Pa={class:"life-zone"},Aa=["aria-label"],ja={class:"answer-card",role:"group","aria-label":"Answer"},Na={key:0,class:"slot space","aria-hidden":"true"},Ea={class:"alpha-wrap"},Ra={class:"alpha-grid",role:"group","aria-label":"Letters"},Fa=["disabled","onMouseenter","onFocus","onClick"],La={key:0,class:"perfect-flash","aria-live":"polite","aria-atomic":"true"},Ua={key:0,class:"hint-overlay",role:"dialog","aria-modal":"true","aria-live":"polite"},Wa={class:"hint-box"},Da={class:"hint-jp"},Xa={class:"hint-penalty"},Ia={key:0,class:"popup",role:"dialog","aria-modal":"true"},Oa={class:"popup-card endword-card"},Ba={class:"endword-grid"},Ga={class:"end-left"},Ha=["src"],Va={class:"end-texts"},$a={key:0,class:"end-jp"},qa={class:"end-en"},za={class:"end-right"},Ja={class:"pop-nums"},Ka={class:"pop-xp-block"},Qa={class:"line"},Ya={class:"line"},Za={class:"line"},es={key:0,class:"line"},as={key:1,class:"line"},ss={class:"line total"},ts={class:"modal-card"},ls={class:"modal-body"},ns={class:"field"},os={class:"radio"},is={class:"radio"},rs={key:0,class:"end-screen","aria-live":"polite"},us={class:"end-screen-inner"},cs={class:"end-table-wrap"},ds={class:"end-table"},vs={class:"w"},fs={class:"xp"},ps={key:0,class:"badge perfect-badge"},ye=450,Se=3,ms=900,gs=Qe({__name:"SpellingGuesser",props:{deckCards:{},deckId:{},deckName:{},maxMisses:{}},setup(xe){const C=xe,J=Ze(),Ce=oa(),N=Ye(),_=n(null),g=n(C.deckCards??[]),d=n("");function Me(){try{const e=sessionStorage.getItem("eitake.spellingguesser.transit.v1");if(!e)return{cards:[]};const a=JSON.parse(e);return{cards:Array.isArray(a?.cards)?a.cards:[],name:typeof a?.deckName=="string"?a.deckName:void 0}}catch{return{cards:[]}}}function Te(e){if(!e)return"";const{data:a}=ne.storage.from("public-assets").getPublicUrl(e);return a?.publicUrl??""}async function Pe(e){const{data:a,error:t}=await ne.from("v_deck_cards_expanded").select("card_id, english, japanese_kanji, japanese_furigana, image_url, position").eq("deck_id",e).order("position",{ascending:!0});if(t)throw t;return(a||[]).map(l=>({id:l.card_id,english:l.english??"",japanese:{kanji:l.japanese_kanji??"",furigana:l.japanese_furigana??""},image_url:Te(l.image_url)}))}async function oe(e){try{const{data:a,error:t}=await ne.from("decks").select("name").eq("id",e).maybeSingle();if(t)throw t;return a?.name||""}catch{return""}}async function Ae(){if(g.value.length)return;if(N.cards?.length){g.value=N.cards,!d.value&&N?.deckName&&(d.value=N.deckName);return}const e=Me();if(e.cards.length){g.value=e.cards,!d.value&&e.name&&(d.value=e.name);return}const a=C.deckId||J.params.id||"";if(a)try{g.value=await Pe(a),d.value||(d.value=C.deckName||await oe(a)||"Deck")}catch(t){console.error(t)}}d.value=C.deckName||N?.deckName||J.query.title||d.value||"Deck";const f=n(C.maxMisses??6),K=n(.75),W=n(f.value>=12?"easy":"hard"),E=n(!1),M=n(W.value),je="ABCDEFGHIJKLMNOPQRSTUVWXYZ".split(""),Q=n([]),w=n(null),Y=m(()=>(w.value?.english??"").trim()),D=m(()=>{const e=w.value?.japanese;return e?typeof e=="string"?e:e.kanji||"":""}),ie=m(()=>De(Y.value)),T=n([]),b=n(new Set),X=n(new Set),I=n(new Set),p=n(0),h=n(!1),O=n(!1),B=n(!1);let P=null;const G=n(!1),H=n(0),Ne=m(()=>g.value.length),R=n(!1),k=ea({id:"",answer:"",correct:0,wrong:0,xp:0,perfect:!1}),re=n(0),ue=n(!1),F=n([]),c=n(!1),V=n(!1),$=n(new Set);function Ee(e){$.value.delete(e),setTimeout(()=>{$.value.add(e),setTimeout(()=>$.value.delete(e),250)},0)}const Z=["ðŸ˜„","ðŸ˜ƒ","ðŸ™‚","ðŸ˜","ðŸ˜•","ðŸ™","â˜¹ï¸","ðŸ˜Ÿ","ðŸ˜£","ðŸ˜–","ðŸ˜«","ðŸ˜­","ðŸ’€"],Re=m(()=>Math.max(0,f.value-p.value)),Fe=m(()=>{const e=Math.max(1,f.value),a=Math.min(Z.length-1,Math.floor(p.value/e*(Z.length-1)));return Z[a]}),Le=m(()=>{const e=Re.value/Math.max(1,f.value);return e>.66?"life-good":e>.33?"life-warn":"life-bad"}),ce=m(()=>{const e=p.value,a=Math.max(1,f.value),t=1,l=.3,u=(t-l)/a;return Math.max(l,t-e*u)}),Ue=m(()=>Number((1/ce.value).toFixed(4))),y={reveal:new Audio(sa),wrong:new Audio(aa),wordComplete:new Audio(fa),perfect:new Audio(pa),hint:new Audio(va)};Object.values(y).forEach(e=>{e.preload="auto",e.volume=.55});function We(){try{const e=new Audio(ra);e.volume=.4,e.play().catch(()=>{})}catch{}}function A(e){try{e.currentTime=0,e.play().catch(()=>{})}catch{}}function de(e){b.value.has(e)||h.value||c.value||We()}const ve=m(()=>T.value.every(e=>e.isSpace||e.letter&&e.letter.length===1));ta(async()=>{if(await Ae(),!d.value){const e=C.deckId||J.params.id||"";if(e){const a=await oe(e);a&&(d.value=a)}}if(!g.value.length){c.value=!0;return}me(),Q.value=fe(g.value),q()}),la(ve,e=>{e&&!c.value&&!h.value&&ee(!0)});function De(e){return e.toUpperCase().split("").filter(a=>a>="A"&&a<="Z"||a===" ").join("")}function fe(e){const a=e.slice();for(let t=a.length-1;t>0;t--){const l=Math.floor(Math.random()*(t+1));[a[t],a[l]]=[a[l],a[t]]}return a}function Xe(e){T.value=e.split("").map(a=>({ch:a,isSpace:a===" ",letter:null}))}function Ie(){return T.value.filter(e=>!e.isSpace&&e.letter).length}function q(){if(h.value=!1,b.value.clear(),X.value.clear(),I.value.clear(),p.value=0,O.value=!1,B.value=!1,P&&(window.clearTimeout(P),P=null),w.value=Q.value.shift()||null,!w.value){pe();return}const e=ie.value;if(!e||e.replace(/\s/g,"").length===0){q();return}Xe(e)}function Oe(e){if(h.value||c.value||b.value.has(e))return;b.value.add(e);const a=ie.value,t=[];for(let l=0;l<a.length;l++)!T.value[l].isSpace&&a[l]===e&&t.push(l);t.length>0?(X.value.add(e),t.forEach(l=>{T.value[l].letter=e,Ee(l)}),A(y.reveal)):(I.value.add(e),p.value++,A(y.wrong),Be(),p.value>=f.value&&ee(!1))}function Be(){const e=document.querySelector(".sg-wrap");e&&(e.classList.remove("miss"),e.offsetWidth,e.classList.add("miss"),setTimeout(()=>e.classList.remove("miss"),220))}function Ge(){G.value||(G.value=!0,window.setTimeout(()=>{G.value=!1},650))}function He(){h.value||c.value||(B.value=!0,O.value=!0,A(y.hint),P&&window.clearTimeout(P),P=window.setTimeout(()=>{O.value=!1},1400))}function Ve(e,a){const t=e*5+a*-2;return Math.max(0,Math.round(t))}function ee(e){h.value=!0;const a=Ie(),t=p.value,l=Ve(a,t);re.value=l;const u=e&&t===0;ue.value=u;let S=0;e&&(S=l,u&&(S=Math.round(S*Se)),B.value&&S>0&&(S=Math.round(S*K.value)));const he={id:w.value.id,answer:Y.value,correct:a,wrong:t,xp:S,perfect:u};F.value.push(he),Object.assign(k,he),u?(A(y.perfect),V.value=!0,setTimeout(()=>{V.value=!1,setTimeout(()=>{R.value=!0,A(y.wordComplete)},ye)},ms)):setTimeout(()=>{R.value=!0,A(y.wordComplete)},ye)}function $e(){R.value=!1,H.value++,H.value>=g.value.length?pe():q()}function pe(){c.value=!0,_e().then(()=>{window.setTimeout(()=>{const e=F.value.reduce((l,u)=>l+u.xp,0);if(e<=0)return;const a=Math.round(e*.7),t=e-a;_.value?.open(),_.value?.addReadingXp(t),_.value?.addWritingXp(a)},400)})}function qe(){me(),Q.value=fe(g.value),q()}function me(){c.value=!1,F.value=[],H.value=0,R.value=!1,V.value=!1}function ge(){Ce.back()}function ze(){c.value||(c.value=!0,_e().then(()=>{window.setTimeout(()=>{const e=F.value.reduce((l,u)=>l+u.xp,0);if(e<=0)return;const a=Math.round(e*.7),t=e-a;_.value?.open(),_.value?.addWritingXp(a),_.value?.addReadingXp(t)},400)}))}function ae(){M.value=W.value,E.value=!E.value}function Je(){W.value=M.value,f.value=W.value==="easy"?12:6,p.value>=f.value&&!h.value&&!c.value&&ee(!1),E.value=!1}function Ke(e){let a="#f8f8f8",t="#000000",l="#3a3a3a",u="0 4px 0 rgba(0,0,0,.12), 0 8px 16px rgba(0,0,0,.12)";return X.value.has(e)?(a="lightgreen",t="#063b25",l="#2fc386",u="0 2px 0 rgba(0,0,0,.12)"):I.value.has(e)?(a="lightcoral",t="#1f2937",l="#8fa1b8",u="0 2px 0 rgba(0,0,0,.12)"):b.value.has(e)&&(a="#f0f0f0",t="#111111",l="#666666"),{backgroundColor:a,color:t,borderColor:l,boxShadow:u}}return(e,a)=>(r(),i("section",ma,[s("header",ga,[s("div",ha,[s("button",{class:"icon-bare home",onClick:ge,"aria-label":"Back"},[s("img",{class:"icon",src:se(ca),alt:""},null,8,_a)])]),s("div",wa,[a[2]||(a[2]=s("h2",{class:"title"},"Spelling Guesser",-1)),s("div",ba," Word "+o(H.value+1)+" / "+o(Ne.value)+" Â â€¢Â  Misses "+o(p.value)+"/"+o(f.value),1),d.value?(r(),i("div",ka,"Category: "+o(d.value),1)):v("",!0)]),s("div",ya,[s("button",{class:"icon-bare settings",onClick:ae,"aria-haspopup":"dialog","aria-expanded":E.value,"aria-label":"Settings",title:"Settings"},[s("img",{class:"icon",src:se(da),alt:""},null,8,xa)],8,Sa),s("div",Ca,[s("button",{class:"btn hint lg",type:"button",onClick:He,disabled:h.value||c.value,title:"Show hint (points Ã—0.75)"}," ðŸ’¡ Hint ",8,Ma)])])]),s("main",Ta,[s("div",Pa,[s("div",{class:x(["life-circle",Le.value]),style:te({transform:`scale(${ce.value})`}),role:"img","aria-label":`Remaining strikes: ${f.value-p.value}`},[s("div",{class:"life-face",style:te({transform:`scale(${Ue.value})`}),onMouseenter:Ge},[s("span",{class:x(["life-face-inner",{wiggle:G.value}])},o(Fe.value),3)],36)],14,Aa)]),s("div",ja,[s("div",{class:x(["blanks",{solved:ve.value}]),"aria-label":"Answer slots"},[(r(!0),i(z,null,le(T.value,(t,l)=>(r(),i(z,{key:l},[t.isSpace?(r(),i("div",Na)):(r(),i("div",{key:1,class:x(["slot",{filled:!!t.letter}])},[s("span",{class:x(["slot-letter",{pop:$.value.has(l)}])},o(t.letter||""),3),a[3]||(a[3]=s("span",{class:"slot-line"},null,-1))],2))],64))),128))],2)]),s("div",Ea,[s("div",Ra,[(r(!0),i(z,null,le(se(je),t=>(r(),i("button",{key:t,class:x(["alpha",{used:b.value.has(t),good:X.value.has(t),bad:I.value.has(t)}]),disabled:b.value.has(t)||h.value||c.value,style:te(Ke(t)),onMouseenter:l=>de(t),onFocus:l=>de(t),onClick:l=>Oe(t)},o(t),47,Fa))),128))])])]),j(U,{name:"perfect-pop"},{default:L(()=>[V.value?(r(),i("div",La," PERFECT! ")):v("",!0)]),_:1}),j(U,{name:"hint-center"},{default:L(()=>[O.value&&D.value?(r(),i("div",Ua,[s("div",Wa,[s("div",Da,o(D.value),1),s("div",Xa,"Points Ã—"+o(K.value),1)])])):v("",!0)]),_:1}),j(U,{name:"pop"},{default:L(()=>[R.value?(r(),i("div",Ia,[s("div",Oa,[s("div",Ba,[s("div",Ga,[w.value?.image_url?(r(),i("img",{key:0,src:w.value.image_url,alt:"",class:"end-img"},null,8,Ha)):v("",!0),s("div",Va,[D.value?(r(),i("div",$a,o(D.value),1)):v("",!0),s("div",qa,o(Y.value),1)])]),s("div",za,[s("div",Ja,[s("span",null,"âœ… "+o(k.correct),1),a[4]||(a[4]=s("span",{class:"dot"},"â€¢",-1)),s("span",null,"âŒ "+o(k.wrong),1)]),s("div",Ka,[s("div",Qa,[a[5]||(a[5]=s("span",null,"Correct Ã— 5",-1)),s("span",null,"+"+o(k.correct*5)+" XP",1)]),s("div",Ya,[a[6]||(a[6]=s("span",null,"Wrong Ã— 2",-1)),s("span",null,"-"+o(k.wrong*2)+" XP",1)]),s("div",Za,[a[7]||(a[7]=s("span",null,"Subtotal",-1)),s("span",null,o(re.value)+" XP",1)]),ue.value?(r(),i("div",es,[a[8]||(a[8]=s("span",null,"Perfect Bonus",-1)),s("span",null,"Ã— "+o(Se))])):v("",!0),B.value&&k.xp>0?(r(),i("div",as,[a[9]||(a[9]=s("span",null,"Hint Penalty",-1)),s("span",null,"Ã— "+o(K.value),1)])):v("",!0),s("div",ss,[a[10]||(a[10]=s("span",null,"Total",-1)),s("span",null,"+"+o(k.xp)+" XP",1)])])])]),s("div",{class:"pop-actions"},[s("button",{class:"btn primary big",onClick:$e},"Continue â†’")])])])):v("",!0)]),_:1}),j(U,{name:"fade"},{default:L(()=>[E.value?(r(),i("div",{key:0,class:"modal",role:"dialog","aria-modal":"true","aria-labelledby":"settings-title",onClick:ia(ae,["self"])},[s("div",ts,[s("header",{class:"modal-head"},[a[11]||(a[11]=s("h3",{id:"settings-title"},"Settings",-1)),s("button",{class:"icon",onClick:ae,"aria-label":"Close"},"âœ•")]),s("div",ls,[s("fieldset",ns,[a[14]||(a[14]=s("legend",null,"Difficulty",-1)),s("label",os,[we(s("input",{type:"radio",value:"easy","onUpdate:modelValue":a[0]||(a[0]=t=>M.value=t)},null,512),[[ke,M.value]]),a[12]||(a[12]=be(" Easy (12 misses) ",-1))]),s("label",is,[we(s("input",{type:"radio",value:"hard","onUpdate:modelValue":a[1]||(a[1]=t=>M.value=t)},null,512),[[ke,M.value]]),a[13]||(a[13]=be(" Hard (6 misses) ",-1))])])]),s("footer",{class:"modal-foot"},[s("button",{class:"btn primary",onClick:Je},"Apply"),s("button",{class:"btn danger",onClick:ze},"End Game")])])])):v("",!0)]),_:1}),j(U,{name:"fade"},{default:L(()=>[c.value?(r(),i("div",rs,[s("div",us,[a[16]||(a[16]=s("div",{class:"end-top"},[s("div",{class:"end-title"},"Results")],-1)),s("div",cs,[s("table",ds,[a[15]||(a[15]=s("thead",null,[s("tr",null,[s("th",null,"Word"),s("th",null,"Correct"),s("th",null,"Wrong"),s("th",null,"XP"),s("th",null,"Note")])],-1)),s("tbody",null,[(r(!0),i(z,null,le(F.value,t=>(r(),i("tr",{key:t.id,class:x({perfect:t.perfect})},[s("td",vs,o(t.answer),1),s("td",null,o(t.correct),1),s("td",null,o(t.wrong),1),s("td",fs,"+"+o(t.xp),1),s("td",null,[t.perfect?(r(),i("span",ps,"PERFECT")):v("",!0)])],2))),128))])])]),s("div",{class:"end-actions"},[s("button",{class:"btn primary",onClick:qe},"Play Again"),s("button",{class:"btn ghost",onClick:ge},"Done")])])])):v("",!0)]),_:1}),j(na,{ref_key:"levelsRef",ref:_,overlay:!0},null,512)]))}}),ys=ua(gs,[["__scopeId","data-v-d67c2b65"]]);export{ys as default};
