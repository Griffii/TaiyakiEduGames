import{d as Pt,r,a5 as $t,c as Ue,o as Et,Q as Ve,g as Ft,a as Q,b as a,v as Oe,B as Le,e as Dt,n as Ut,t as L,w as Ge,T as Je,u as Vt,f as Y,E as S,$ as Z,p as qe,l as je,G as ee,F as Ot,h as Lt,a6 as Gt,_ as Jt}from"./index-CPYovS2m.js";import{b as qt}from"./back-icon-xKqy7r3s.js";import{s as jt}from"./settings-icon-DJLQOoae.js";const Ht={class:"roulette-page"},Xt=["src"],Kt=["aria-expanded"],Qt=["src"],Yt={class:"wheel-container"},Zt=["disabled"],en={key:0,class:"muted"},tn={class:"popup",role:"dialog","aria-modal":"true","aria-labelledby":"popupText"},nn={class:"popup-card"},ln={id:"popupText",class:"pop-value"},an={class:"pop-actions"},sn=["disabled"],on={class:"popup-card settings-card"},rn={class:"tabs",role:"tablist","aria-label":"Wheel type"},un=["aria-selected"],cn=["aria-selected"],dn={class:"tab-panel",role:"tabpanel","aria-label":"Numbers settings"},fn={class:"row"},vn={class:"controls-inline"},mn={class:"row"},hn={class:"controls-inline"},pn={class:"tab-panel",role:"tabpanel","aria-label":"Words settings"},bn={class:"row words-head"},gn={class:"words-meta"},wn={class:"words-count"},_n=["disabled"],xn={class:"words-list","aria-label":"Word values list"},yn=["onUpdate:modelValue","placeholder"],Sn=["onClick","disabled"],Mn={class:"actions"},Tn={class:"actions-left"},In=["disabled"],He=100,P=12,kn=6e3,Xe=1.25,Nn=6,An=Pt({__name:"RouletteWheel",setup(Cn){const we=Vt(),te=r(null);let $=null;const E=r(J("rw_start",1)),F=r(J("rw_end",32)),D=r(G("rw_exclude","")),x=r(et()),f=r(Ze()),p=r(nt()),v=r([]),m=r([]),C=r(!1),M=r(!1),T=r(!1),R=r(null),W=r(null),B=r(ke()),b=r("numbers"),c=r([]);let U=-Math.PI/2,z=U,ne=0,le=0,I=null;const Ke=new Audio($t),_e=r("sample"),xe=r("single"),ye=r(.25),Qe=r([Gt]);let ae=null,g=[],se=0;const Se=r(null);let oe=null;function Ye(){window.history.length>1?we.back():we.push("/")}function G(e,n){try{return localStorage.getItem(e)??n}catch{return n}}function J(e,n){const t=G(e,String(n)),l=Number(t);return Number.isFinite(l)?l:n}function Ze(){return G("rw_mode","numbers")==="words"?"words":"numbers"}function re(){try{localStorage.setItem("rw_mode",f.value)}catch{}}function et(){try{const e=localStorage.getItem("rw_numbers");if(!e)return q(J("rw_start",1),J("rw_end",32),G("rw_exclude",""));const n=JSON.parse(e);if(Array.isArray(n)&&n.every(t=>Number.isInteger(t)))return n}catch{}return q(1,32,"")}function tt(){try{localStorage.setItem("rw_start",String(E.value)),localStorage.setItem("rw_end",String(F.value)),localStorage.setItem("rw_exclude",D.value)}catch{}}function Me(){try{localStorage.setItem("rw_numbers",JSON.stringify(x.value))}catch{}}function nt(){try{const e=localStorage.getItem("rw_words");if(!e)return[];const n=JSON.parse(e);if(Array.isArray(n))return n.map(t=>typeof t=="string"?t.trim():"").filter(t=>t.length>0).slice(0,P)}catch{}return[]}function lt(){try{localStorage.setItem("rw_words",JSON.stringify(p.value))}catch{}}function ie(){v.value=[...x.value],m.value=[...p.value],y(N())}function at(e){return e.split(",").map(n=>Number(n.trim())).filter(n=>Number.isInteger(n))}function q(e,n,t){const l=Math.min(e,n),s=Math.max(e,n),o=new Set(at(t)),i=[];for(let u=l;u<=s;u++)o.has(u)||i.push(u);return i}function st(){const e=q(E.value,F.value,D.value);if(e.length>He){alert(`You must have ${He} segments or less.`);return}tt(),JSON.stringify(e),JSON.stringify(x.value),x.value=e,Me(),f.value="numbers",re(),ie()}function Te(){c.value.length||(c.value=p.value.length?[...p.value]:[""])}function ot(e){return e.map(n=>(n??"").trim()).filter(n=>n.length>0).slice(0,P)}function rt(){const e=ot(c.value);if(e.length===0){alert("Please add at least one word value (empty rows are ignored).");return}p.value=e,lt(),c.value=[...e],f.value="words",re(),ie()}function it(){c.value.length>=P||c.value.push("")}function ut(e){c.value.length<=1||c.value.splice(e,1)}function Ie(e){b.value=e,e==="words"&&Te()}function ct(){b.value==="numbers"?st():rt()}const k=Ue(()=>f.value==="words"?m.value.map(e=>e.trim()).filter(e=>e.length>0).slice(0,P):v.value.map(e=>String(e)));function dt(){if(k.value.length){if(f.value==="numbers"){if(!v.value.length)return;for(let e=v.value.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[v.value[e],v.value[n]]=[v.value[n],v.value[e]]}}else{if(!m.value.length)return;for(let e=m.value.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[m.value[e],m.value[n]]=[m.value[n],m.value[e]]}}y(N())}}function ke(){const e=Math.max(320,Math.min(window.innerWidth,1600)),n=Math.max(400,Math.min(window.innerHeight,1200)),t=Math.round(Math.min(e,n)*.72);return Math.max(300,Math.min(720,t))}function ue(){const e=te.value;if(!e)return;const n=B.value,t=window.devicePixelRatio||1;e.style.width=n+"px",e.style.height=n+"px",e.width=Math.floor(n*t),e.height=Math.floor(n*t),$=e.getContext("2d"),$&&($.setTransform(1,0,0,1,0,0),$.scale(t,t))}function ft(){const e=ke();e!==B.value&&(B.value=e,ue(),y(N()))}function vt(e){return e>=1?1:1-Math.pow(2,-10*e)}function N(){if(!C.value)return z;const e=performance.now(),n=Math.min(1,(e-ne)/le),t=vt(n);return U+(z-U)*t}function mt(){const e=Math.random(),n=e*e*(3-2*e);return Xe+n*(Nn-Xe)}function ht(e,n,t,l){const s=n.reduce((i,u)=>Math.max(i,(u??"").length),0);if(s<=3)return t;const o=Math.max(.55,Math.min(1,9/(s+2)));return Math.max(l,Math.round(t*o))}function pt(e,n,t){const l=n??"";if(e.measureText(l).width<=t)return l;const s="…";if(e.measureText(s).width>t)return s;let o=0,i=l.length;for(;o<i;){const u=Math.floor((o+i+1)/2),A=l.slice(0,u)+s;e.measureText(A).width<=t?o=u:i=u-1}return l.slice(0,o)+s}function y(e){const n=te.value;if(!n)return null;const t=$??n.getContext("2d");if(!t)return null;const l=B.value,s=l,o=l;t.clearRect(0,0,s,o);const i=k.value;if(i.length===0)return null;const u=i.length,A=2*Math.PI/u,w=s/2,_=o/2,h=Math.round(l*.45),Re=[];for(let d=0;d<u;d++){const X=((e+d*A+A/2)*180/Math.PI+360)%360;Re.push({index:d,angleDeg:X})}const V=Ne(Re,270);Se.value=V;const kt=210,Nt=8,j=50,We=62,me=54,At=performance.now(),H=.62+.38*Math.abs(Math.sin(At/160)),Be=Math.max(14,Math.min(22,h*.12)),ze=f.value==="words"?ht(t,i,Be,12):Be,Pe=f.value==="words",Ct=Math.max(22,h*.11),Rt=Math.max(18,h*.1),$e=h-Ct,Wt=Math.max(40,$e-Rt);for(let d=0;d<u;d++){const O=e+d*A,X=O+A,Bt=O+A/2,K=kt+(d%4-1.5)*(Nt/1),zt=`hsl(${K} ${j}% ${d%2===0?We:me}%)`;if(t.beginPath(),t.moveTo(w,_),t.arc(w,_,h,O,X),t.closePath(),d===V){const ge=t.createRadialGradient(w,_,h*.18,w,_,h);ge.addColorStop(0,`hsla(${K} ${j+10}% ${We+8}% / ${.9*H})`),ge.addColorStop(1,`hsla(${K} ${j+10}% ${me-8}% / ${.92*H})`),t.fillStyle=ge,t.shadowColor=`hsla(${K} ${j+25}% ${me-14}% / ${.9*H})`,t.shadowBlur=24*H}else t.fillStyle=zt,t.shadowBlur=0;t.fill(),t.strokeStyle="rgba(0,0,0,.18)",t.lineWidth=1,t.stroke(),d===V&&(t.save(),t.beginPath(),t.arc(w,_,h,O,X),t.strokeStyle="rgba(255,255,255,.95)",t.lineWidth=Math.max(3,h*.035),t.shadowColor="rgba(160,200,255,.9)",t.shadowBlur=20,t.stroke(),t.restore()),t.save(),t.translate(w,_),t.rotate(Bt);const Ee=d===V,Fe=Ee?ze*1.22:ze;t.font=`800 ${Fe}px system-ui, -apple-system, Segoe UI, Arial`,t.textAlign=Pe?"right":"center",t.textBaseline="middle";const De=i[d]??"",pe=Pe?pt(t,De,Wt):De,be=$e;Ee?(t.lineJoin="round",t.miterLimit=2,t.strokeStyle="rgba(255,255,255,.95)",t.lineWidth=Math.max(3,Fe*.14),t.strokeText(pe,be,0),t.fillStyle="#0b1a2b",t.fillText(pe,be,0)):(t.fillStyle="rgba(0,0,0,.82)",t.fillText(pe,be,0)),t.restore()}t.beginPath(),t.arc(w,_,Math.max(10,h*.06),0,2*Math.PI);const he=t.createRadialGradient(w,_,2,w,_,h*.08);return he.addColorStop(0,"#ffffff"),he.addColorStop(1,"#e8edf6"),t.fillStyle=he,t.fill(),t.strokeStyle="rgba(0,0,0,.15)",t.stroke(),V}function Ne(e,n=270){if(!e.length)return null;let t=0,l=360;for(let s=0;s<e.length;s++){let o=Math.abs((e[s].angleDeg-n+360)%360);o>180&&(o=360-o),o<l&&(l=o,t=s)}return e[t].index}function ce(){if(k.value.length===0||C.value||M.value||T.value)return;de()&&wt();const n=mt(),t=Math.random()*(2*Math.PI);U=N(),z=U+n*(2*Math.PI)+t,le=kn,ne=performance.now(),C.value=!0,oe=null,I=requestAnimationFrame(Ae)}function Ae(){const e=performance.now(),n=Math.min(1,(e-ne)/le),t=N(),l=y(t);l!==null&&l!==oe&&(oe=l,xt()),n<1?I=requestAnimationFrame(Ae):(C.value=!1,I&&cancelAnimationFrame(I),I=null,y(z),setTimeout(bt,280))}function bt(){const e=k.value;if(e.length===0)return;const n=e.length,t=2*Math.PI/n,l=[];for(let o=0;o<n;o++){const u=((z+o*t+t/2)*180/Math.PI+360)%360;l.push({index:o,angleDeg:u})}const s=Ne(l,270);Se.value=s,R.value=s,W.value=s==null?null:e[s]??null;try{const o=Ke;o.currentTime=0,o.play()}catch{}M.value=!0}function de(){const e=window.AudioContext||window.webkitAudioContext;if(!e)return null;ae||(ae=new e);const n=ae;return n.state==="suspended"&&n.resume(),n}async function gt(e){const n=de();if(!n)return null;try{const l=await(await fetch(e)).arrayBuffer();return await n.decodeAudioData(l)}catch{return null}}async function wt(){if(g.length||_e.value!=="sample")return;const e=Qe.value.slice();g=(await Promise.all(e.map(t=>gt(t)))).filter(t=>!!t),se=0}function _t(){if(!g.length)return null;if(xe.value==="single")return g[0];if(xe.value==="random"){const n=Math.floor(Math.random()*g.length);return g[n]}const e=g[se%g.length];return se++,e}function xt(){const e=de();if(e){if(_e.value==="sample"&&g.length){const n=_t();if(n){const t=e.createBufferSource();t.buffer=n;const l=e.createGain();l.gain.value=ye.value,t.connect(l).connect(e.destination),t.start();return}}yt(e)}}function yt(e){const n=e.createOscillator(),t=e.createGain(),l=e.currentTime,s=1100,o=(Math.random()-.5)*120;n.type="square",n.frequency.setValueAtTime(s+o,l);const i=Math.max(.05,Math.min(1,ye.value));t.gain.setValueAtTime(0,l),t.gain.linearRampToValueAtTime(.22*i,l+.006),t.gain.exponentialRampToValueAtTime(1e-4,l+.07),n.connect(t).connect(e.destination),n.start(l),n.stop(l+.08)}function St(){T.value=!0,b.value=f.value,b.value==="words"&&(c.value=p.value.length?[...p.value]:[""],Te())}function fe(){T.value=!1}function Mt(){if(R.value!=null){if(f.value==="numbers"){const e=W.value;if(e==null)return;const n=Number(e);if(!Number.isFinite(n))return;v.value=v.value.filter(t=>t!==n)}else{const e=R.value;if(e<0||e>=m.value.length)return;m.value.splice(e,1)}M.value=!1,R.value=null,W.value=null,y(N())}}function Ce(){M.value=!1,R.value=null,W.value=null}const Tt=Ue(()=>W.value==null?"":String(W.value)),ve=[];Et(()=>{x.value.length||(x.value=q(E.value,F.value,D.value),Me()),f.value==="words"&&p.value.length===0&&(f.value="numbers",re()),v.value=[...x.value],m.value=[...p.value],ue(),y(z);const e=t=>{t.code==="Space"&&!M.value&&!T.value&&(t.preventDefault(),ce()),t.code==="Escape"&&(M.value?(t.preventDefault(),Ce()):T.value&&(t.preventDefault(),fe()))},n=It(ft,100);window.addEventListener("keydown",e),window.addEventListener("resize",n),ve.push(()=>window.removeEventListener("keydown",e)),ve.push(()=>window.removeEventListener("resize",n))}),Ve([x,p,f],()=>{ie()}),Ve([B],()=>{ue(),y(N())}),Ft(()=>{I&&cancelAnimationFrame(I),ve.forEach(e=>e())});function It(e,n){let t=0,l=null;return function(...s){const o=Date.now();o-t>=n?(t=o,e.apply(this,s)):l||(l=window.setTimeout(()=>{t=Date.now(),l=null,e.apply(this,s)},n-(o-t)))}}return(e,n)=>(Y(),Q("section",Ht,[a("button",{class:"home-button",type:"button",onClick:Ye,"aria-label":"Back"},[a("img",{src:Le(qt),alt:""},null,8,Xt)]),a("button",{class:"settings-button",type:"button",onClick:St,"aria-label":"Open settings","aria-expanded":T.value?"true":"false","aria-controls":"settingsModal"},[a("img",{src:Le(jt),alt:""},null,8,Qt)],8,Kt),a("div",Yt,[a("div",{class:"wheel-wrap",style:Ut({"--wheel-size":B.value+"px"}),onClick:ce},[n[5]||(n[5]=a("div",{class:"indicator","aria-hidden":"true"},null,-1)),a("canvas",{ref_key:"canvasEl",ref:te,class:"wheel"},null,512)],4),a("button",{id:"spinButton",class:"spin-btn",type:"button",disabled:k.value.length===0||C.value,onClick:ce,"aria-live":"polite"},L(C.value?"SPINNING…":"SPIN"),9,Zt),k.value.length===0?(Y(),Q("p",en," No values. Open settings to configure "+L(f.value==="numbers"?"a range":"word entries")+". ",1)):Dt("",!0)]),Oe(Je,{name:"fade-zoom"},{default:Ge(()=>[S(a("div",tn,[a("div",nn,[a("h2",ln,L(Tt.value),1),a("div",an,[a("button",{class:"btn subtle",type:"button",onClick:Mt,disabled:R.value==null}," Remove Value ",8,sn),a("button",{class:"btn",type:"button",onClick:Ce},"Continue")])])],512),[[Z,M.value]])]),_:1}),Oe(Je,{name:"fade-zoom"},{default:Ge(()=>[S(a("div",{class:"popup",role:"dialog","aria-modal":"true","aria-labelledby":"settingsTitle",id:"settingsModal",onClick:je(fe,["self"])},[a("div",on,[n[11]||(n[11]=a("h2",{id:"settingsTitle",class:"settings-title"},"Settings",-1)),a("div",rn,[a("button",{class:qe(["tab",{"is-active":b.value==="numbers"}]),type:"button",role:"tab","aria-selected":b.value==="numbers"?"true":"false",onClick:n[0]||(n[0]=t=>Ie("numbers"))}," Numbers ",10,un),a("button",{class:qe(["tab",{"is-active":b.value==="words"}]),type:"button",role:"tab","aria-selected":b.value==="words"?"true":"false",onClick:n[1]||(n[1]=t=>Ie("words"))}," Words ",10,cn)]),a("form",{class:"settings-form",onSubmit:je(ct,["prevent"])},[S(a("div",dn,[a("div",fn,[n[7]||(n[7]=a("label",{for:"startNum",class:"lbl"},"Range:",-1)),a("div",vn,[S(a("input",{id:"startNum",class:"num",type:"number","onUpdate:modelValue":n[2]||(n[2]=t=>E.value=t),min:"1",inputmode:"numeric"},null,512),[[ee,E.value,void 0,{number:!0}]]),n[6]||(n[6]=a("span",{class:"dash"},"-",-1)),S(a("input",{id:"endNum",class:"num",type:"number","onUpdate:modelValue":n[3]||(n[3]=t=>F.value=t),min:"1",inputmode:"numeric"},null,512),[[ee,F.value,void 0,{number:!0}]])])]),a("div",mn,[n[8]||(n[8]=a("label",{for:"excludeInput",class:"lbl"},"Exclude:",-1)),a("div",hn,[S(a("input",{id:"excludeInput",class:"ex-input",type:"text","onUpdate:modelValue":n[4]||(n[4]=t=>D.value=t),placeholder:"e.g., 3,7,15","aria-label":"Exclude numbers"},null,512),[[ee,D.value,void 0,{trim:!0}]])])])],512),[[Z,b.value==="numbers"]]),S(a("div",pn,[a("div",bn,[n[9]||(n[9]=a("div",{class:"lbl words-lbl"},"Values:",-1)),a("div",gn,[a("span",wn,L(c.value.length)+"/"+L(P),1),a("button",{class:"btn subtle sm",type:"button",onClick:it,disabled:c.value.length>=P}," + Add ",8,_n)])]),a("div",xn,[(Y(!0),Q(Ot,null,Lt(c.value,(t,l)=>(Y(),Q("div",{key:`word-${l}`,class:"word-row"},[S(a("input",{class:"word-input",type:"text","onUpdate:modelValue":s=>c.value[l]=s,placeholder:`Value ${l+1}`,maxlength:"80","aria-label":"Word value"},null,8,yn),[[ee,c.value[l],void 0,{trim:!0}]]),a("button",{class:"icon-btn",type:"button",onClick:s=>ut(l),disabled:c.value.length<=1,"aria-label":"Remove value",title:"Remove"}," ✕ ",8,Sn)]))),128))])],512),[[Z,b.value==="words"]]),a("div",Mn,[a("div",Tn,[a("button",{class:"btn rand sm",type:"button",disabled:k.value.length===0,onClick:dt,"aria-label":"Randomize the order of values on the wheel"}," Randomize ",8,In)]),a("div",{class:"actions-right"},[a("button",{class:"btn subtle sm",type:"button",onClick:fe},"Cancel"),n[10]||(n[10]=a("button",{class:"btn sm",type:"submit"},"Update",-1))])])],32)])],512),[[Z,T.value]])]),_:1})]))}}),Pn=Jt(An,[["__scopeId","data-v-85573133"]]);export{Pn as default};
