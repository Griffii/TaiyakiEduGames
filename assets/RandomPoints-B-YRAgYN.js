import{i as Ae,r as v,c as $,o as Ue,a as d,g as J,d as s,h as C,f as j,t as g,k as we,v as Me,T as Ce,F as B,e as Y,p as Ie,E as qe,b as u,n as ge,_ as De,N as Ke,w as Ne,j as Le,C as xe,H as $e,G as Pe,x as me,y as Re,u as Xe,B as Te,O as Fe}from"./index-CrgvobsY.js";import{b as Je}from"./back-icon-xKqy7r3s.js";import{s as Qe}from"./settings-icon-DJLQOoae.js";import{s as Ze,a as ze}from"./shokichi-CwuZ8r0p.js";import{s as Be,a as je,b as et,c as He}from"./kyo-CsNlWR0S.js";const tt="/TaiyakiEduGames/assets/mystery-machine-icon-DFeu74Q1.png",at="/TaiyakiEduGames/assets/mystery-machine-body-D8HKPlGZ.png",st="/TaiyakiEduGames/assets/slot-arm-DQdLv0uY.png",nt="/TaiyakiEduGames/assets/slot-machine-DpezDdAa.mp3",lt={class:"mm-stage"},ot={class:"mm-machine"},it={class:"mm-stack"},rt={class:"mm-top-panel"},ut={class:"wager-section"},ct={class:"wager-inner"},dt={class:"wager-header"},ft={class:"wager-controls"},vt=["disabled"],pt={class:"wager-value-block"},mt={class:"wager-amount"},bt=["disabled"],yt={class:"mm-toast-panel"},ht={key:"toast",class:"mm-toast"},_t={class:"mm-toast-text"},gt={class:"reels-layer"},wt={class:"slot-frame"},kt={class:"reel-symbol"},Tt=["src"],xt=["disabled","aria-disabled"],Mt=["src"],Ct={key:0,class:"effect-modal"},St={class:"effect-header"},$t={class:"effect-title"},Pt={class:"effect-body"},Et={class:"effect-description"},At=48,Oe=3500,Ut=Ae({__name:"MysteryMachine",props:{maxWager:{}},emits:["close","resolved","effect-opened"],setup(ke,{emit:ae}){const O=at,G=st;let P=null;const T=new Map;typeof window<"u"&&typeof Audio<"u"&&(P=new Audio(nt),T.set("return",Ze),T.set("quadruple",Be),T.set("lose_all",je),T.set("double",et),T.set("lose_half",He),T.set("triple",ze));function c(){if(P)try{P.currentTime=0,P.play().catch(()=>{})}catch{}}function m(e){const t=T.get(e);if(t)try{const n=new Audio(t);n.currentTime=0,n.play().catch(()=>{})}catch{}}const y=ke,A=ae,p=v(10),I=["ðŸ’£","âš–ï¸","â­•","âœ¨","ðŸ†","7ï¸âƒ£"],W={lose_all:"ðŸ’£",lose_half:"â­•",return:"âš–ï¸",double:"âœ¨",triple:"ðŸ†",quadruple:"7ï¸âƒ£"},h=360/I.length,se=[2300,2900,3400],z=v([0,0,0]),E=v(!1),_=v(!1),ne=v(!1),D=v(null),w=v(null),le=v(0),oe=v(null),H=v(!1),Q=v(!1),N=v(!1),Z=v(""),de=[{id:"t1_tip_jar",tier:1,label:"+20 points"},{id:"t1_party_favor",tier:1,label:"+10 points to every team"},{id:"t1_donation",tier:1,label:"+20 points to the lowest team"},{id:"t1_nothing",tier:1,label:"Nothing happens"}],ee=[{id:"t2_double_next",tier:2,label:"2x next card"},{id:"t2_steal40_one",tier:2,label:"Steal 40 points from one team"},{id:"t2_give40_one",tier:2,label:"+40 points to one team"}],be=[{id:"t3_triple_next",tier:3,label:"3x next card"},{id:"t3_steal20_each",tier:3,label:"Steal 20 points from each team"},{id:"t3_swap_any_team",tier:3,label:"Swap total points with another team"},{id:"t3_rain_of_points",tier:3,label:"Rain of points: +80 for you, +40 for all other teams"}],U={t1_tip_jar:"Your team gains +20 points.",t1_party_favor:"Every team gains +10 points.",t1_donation:"The team with the lowest score gains +20 points.",t1_nothing:"Nothing happens this time.",t2_double_next:"Your next card is doubled.",t2_steal40_one:"Steal 40 points from anohter team.",t2_give40_one:"Plus 40 points to another team.",t3_triple_next:"Your next card is tripled!",t3_steal20_each:"Steal 20 points from ALL other teams.",t3_swap_any_team:"Swap your total score with any team.",t3_rain_of_points:"You gain +80 points, every other team gains +40 points."},q=[{type:"lose_all",weight:22},{type:"lose_half",weight:18},{type:"return",weight:25},{type:"double",weight:18},{type:"triple",weight:10},{type:"quadruple",weight:7}],K=[],X=$(()=>!(E.value||p.value<10||p.value%10!==0||y.maxWager!=null&&p.value>y.maxWager)),V=$(()=>!!w.value&&!!D.value&&!E.value),F=$(()=>ie(p.value)),fe=$(()=>w.value?U[w.value.id]??w.value.label:"");function k(e){switch(e){case"lose_all":return"Lose all wager";case"lose_half":return"Lose half wager";case"return":return"No change (return wager)";case"double":return"Double wager";case"triple":return"Triple wager";case"quadruple":return"Quadruple wager"}}$(()=>{const e=q.reduce((t,n)=>t+n.weight,0);return q.map(({type:t,weight:n})=>{const i=n/e*100;return{type:t,name:k(t),percent:i.toFixed(1)}})});function te(){p.value<0&&(p.value=0),y.maxWager!=null&&p.value>y.maxWager&&(p.value=y.maxWager),p.value%10!==0&&(p.value=Math.round(p.value/10)*10)}function ie(e){return e>=100?3:e>=50?2:1}function re(e){let t=[];e>=1&&(t=t.concat(de)),e>=2&&(t=t.concat(ee)),e>=3&&(t=t.concat(be));const n=Math.floor(Math.random()*t.length);return t[n]}function ue(){const e=q.reduce((i,x)=>i+x.weight,0),t=Math.random()*e;let n=0;for(const i of q)if(n+=i.weight,t<=n)return i.type;return"return"}function ye(e,t){let n="",i=0;switch(e){case"lose_all":n="You lost your entire wager",i=-t;break;case"lose_half":n="You lost half your wager",i=-Math.round(t/2);break;case"return":n="Your wager was returned (no change)",i=0;break;case"double":n="Your wager was doubled",i=t;break;case"triple":n="Your wager was tripled",i=2*t;break;case"quadruple":n="Your wager was quadrupled",i=3*t;break}return{outcome:{type:e,label:n},delta:i}}function ve(e){const n=`rotateX(${z.value[e]}deg)`;if(_.value)return{transform:n,transition:"transform 0s"};if(E.value){const i=se[e]??Oe;return{transform:n,transition:`transform ${i}ms cubic-bezier(.2,.8,.3,1.1)`}}return{transform:n,transition:"transform 0s"}}function R(e){return{transform:`rotateX(${e*h}deg) translateZ(${At}px)`}}function pe(e,t){const n=e===0?"0 points":`${e>0?"+":""}${e} points`;Z.value=n,N.value=!0,m(t)}function he(){N.value=!1}function ce(){if(!X.value)return;te(),D.value=null,w.value=null,le.value=0,oe.value=null,H.value=!1,N.value=!1;const e=ue(),{outcome:t,delta:n}=ye(e,p.value),i=ie(p.value),x=re(i),L=W[e],b=I.indexOf(L),M=b>=0?b:0;E.value=!1,_.value=!0,z.value=[0,0,0];try{document.body.offsetHeight}catch{}window.requestAnimationFrame(()=>{_.value=!1,E.value=!0;const Ve=3;z.value=z.value.map((Se,Ge)=>-((Ve+Ge)*360+M*h));const Ye=window.setTimeout(()=>{D.value=t,w.value=x,le.value=n,E.value=!1;const Se={wager:p.value,wagerOutcome:t,pointsDelta:n,tier:i,effect:x};oe.value=Se,A("resolved",Se),pe(n,t.type)},Oe);K.push(Ye)})}function l(){if(!X.value||E.value)return;ne.value=!0,c();const e=window.setTimeout(()=>{ne.value=!1},350);K.push(e),ce()}function o(e){E.value||(p.value+=e,p.value<0&&(p.value=0),te())}function r(){if(!V.value||!w.value||!D.value)return;H.value=!0;const e=oe.value??{wager:p.value,wagerOutcome:D.value,pointsDelta:le.value,tier:ie(p.value),effect:w.value};console.log("[MysteryMachine] effect-opened",e.effect.id,e),A("effect-opened",e)}function f(){H.value=!1}function S(){A("close")}function a(){S()}return Ue(()=>{K.forEach(e=>clearTimeout(e))}),(e,t)=>(u(),d("section",{class:"mystery-machine-overlay",role:"dialog","aria-modal":"true",onClick:J(a,["self"])},[s("button",{class:"overlay-prizes-btn",type:"button",onClick:t[0]||(t[0]=n=>Q.value=!0),"aria-label":"View prize tiers"}," â“ "),s("button",{class:"overlay-close-btn",type:"button",onClick:S,"aria-label":"Close Mystery Machine"}," âœ• "),s("div",lt,[s("section",ot,[s("div",it,[s("div",rt,[s("section",ut,[s("div",ct,[s("div",dt,[t[4]||(t[4]=s("span",{class:"wager-label"},"Wager",-1)),s("span",{class:j(["wager-tier-pill",`tier-${F.value}`])}," Tier "+g(F.value),3)]),s("div",ft,[s("button",{type:"button",class:"arrow-btn",onClick:t[1]||(t[1]=n=>o(-10)),disabled:E.value||p.value<=0,"aria-label":"Decrease wager"}," â—€ ",8,vt),s("div",pt,[s("span",mt,g(p.value)+" pts ",1)]),s("button",{type:"button",class:"arrow-btn",onClick:t[2]||(t[2]=n=>o(10)),disabled:E.value||e.maxWager!=null&&p.value>=e.maxWager,"aria-label":"Increase wager"}," â–¶ ",8,bt)])])])]),s("div",yt,[we(Ce,{name:"mm-toast-slide"},{default:Me(()=>[N.value?(u(),d("div",ht,[s("span",_t,g(Z.value),1),s("button",{class:"mm-toast-close",type:"button",onClick:he,"aria-label":"Dismiss message"}," âœ• ")])):C("",!0)]),_:1})]),s("div",gt,[s("div",wt,[(u(!0),d(B,null,Y(z.value,(n,i)=>(u(),d("div",{key:i,class:"reel3d"},[s("div",{class:"reel3d-inner",style:ge(ve(i))},[(u(),d(B,null,Y(I,(x,L)=>s("div",{key:L,class:"reel-face",style:ge(R(L))},[s("span",kt,g(x),1)],4)),64))],4)]))),128))])]),s("img",{src:Ie(O),alt:"Mystery Machine body",class:"machine-body-img",draggable:"false"},null,8,Tt),V.value&&!H.value?(u(),d("button",{key:0,class:j(["prize-btn",{"has-prize":V.value}]),type:"button",onClick:r},[...t[5]||(t[5]=[s("span",{class:"prize-label"},"ðŸŽ Mystery Prize",-1)])],2)):C("",!0),s("button",{class:"slot-arm-btn",type:"button",disabled:!X.value||E.value,onClick:l,"aria-disabled":!X.value||E.value},[s("img",{src:Ie(G),alt:"Pull to spin",class:j(["slot-arm-img",{"is-disabled":!X.value||E.value,"is-pulled":ne.value}]),draggable:"false"},null,10,Mt)],8,xt)])])]),H.value&&w.value?(u(),d("div",{key:0,class:"effect-modal-overlay",onClick:J(f,["self"])},[we(Ce,{name:"mm-card-pop"},{default:Me(()=>[H.value?(u(),d("div",Ct,[s("div",St,[s("h3",$t,g(w.value.label),1),s("span",{class:j(["effect-tier-chip",`tier-${w.value.tier}`])}," Tier "+g(w.value.tier),3)]),s("div",Pt,[s("p",Et,g(fe.value),1)]),s("div",{class:"effect-actions"},[s("button",{class:"pill-btn primary",type:"button",onClick:f}," Close ")])])):C("",!0)]),_:1})])):C("",!0),Q.value?(u(),d("div",{key:1,class:"effect-modal-overlay",onClick:t[3]||(t[3]=J(n=>Q.value=!1,["self"]))},[...t[6]||(t[6]=[qe('<div class="effect-modal info-modal" data-v-3796f3fb><h3 class="effect-title" data-v-3796f3fb>Mystery Machine: Outcomes &amp; Prizes</h3><div class="prize-grid" data-v-3796f3fb><section class="prize-col" data-v-3796f3fb><h4 class="prize-heading" data-v-3796f3fb>Wager Outcomes</h4><div class="outcome-grid" data-v-3796f3fb><div class="outcome-card outcome-bad-1" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>Lose all</span><span class="outcome-pct" data-v-3796f3fb>~22%</span></div><div class="outcome-card outcome-bad-2" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>Lose half</span><span class="outcome-pct" data-v-3796f3fb>~18%</span></div><div class="outcome-card outcome-neutral" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>No change</span><span class="outcome-pct" data-v-3796f3fb>~25%</span></div><div class="outcome-card outcome-good" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>2Ã—</span><span class="outcome-pct" data-v-3796f3fb>~18%</span></div><div class="outcome-card outcome-good" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>3Ã—</span><span class="outcome-pct" data-v-3796f3fb>~10%</span></div><div class="outcome-card outcome-good" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>4Ã—</span><span class="outcome-pct" data-v-3796f3fb>~7%</span></div></div></section><section class="prize-col" data-v-3796f3fb><h4 class="prize-heading" data-v-3796f3fb>Prize Cards by Tier</h4><div class="tier-grid" data-v-3796f3fb><article class="tier-card tier-1" data-v-3796f3fb><header class="tier-header" data-v-3796f3fb><span class="tier-title" data-v-3796f3fb>Tier 1: 10+ points</span></header><ul class="tier-list" data-v-3796f3fb><li data-v-3796f3fb>+20 points</li><li data-v-3796f3fb>+10 to every team</li><li data-v-3796f3fb>+20 to the lowest team</li><li data-v-3796f3fb>Nothing happens</li></ul></article><article class="tier-card tier-2" data-v-3796f3fb><header class="tier-header" data-v-3796f3fb><span class="tier-title" data-v-3796f3fb>Tier 2: 50+ points</span></header><ul class="tier-list" data-v-3796f3fb><li data-v-3796f3fb>Double next card (x2)</li><li data-v-3796f3fb>Steal 40 from one team</li><li data-v-3796f3fb>+40 to one team</li></ul></article><article class="tier-card tier-3" data-v-3796f3fb><header class="tier-header" data-v-3796f3fb><span class="tier-title" data-v-3796f3fb>Tier 3: 100+ points</span></header><ul class="tier-list" data-v-3796f3fb><li data-v-3796f3fb>Triple next card (x3)</li><li data-v-3796f3fb>Steal 20 from each team</li><li data-v-3796f3fb>Swap scores with any team</li><li data-v-3796f3fb>Rain of Points (+80 you, +40 others)</li></ul></article></div></section></div><p class="prize-disclaimer" data-v-3796f3fb> All prizes are applied automatically. There is no need to manually edit team points to apply prize effects. </p></div>',1)])])):C("",!0)]))}}),Dt=De(Ut,[["__scopeId","data-v-3796f3fb"]]),It={key:0,class:"team-points-tracker"},Nt={key:0,class:"tracker-shell"},Rt={class:"tracker-row"},Ft={class:"left-stack"},Ot=["disabled"],Wt=["aria-pressed","title"],Lt={class:"tabs-row"},zt=["onClick"],Bt={class:"tab-inner"},jt={class:"team-name"},Ht={class:"team-points"},Vt={key:0,class:"team-powerups"},Yt={key:0,class:"leader-crown","aria-label":"Current leader",role:"img"},Gt={class:"team-controls"},qt=["disabled"],Kt=["disabled"],Xt={class:"edit-field"},Jt={class:"edit-field"},Qt={key:0,class:"edit-field powerups-field"},Zt={class:"edit-powerups-list"},ea=["onClick"],ta={class:"chip-label"},aa={class:"edit-actions"},sa=["disabled"],na={class:"fullscreen-modal"},la={class:"fullscreen-grid"},oa={key:0,class:"fullscreen-crown","aria-label":"Current leader",role:"img"},ia={class:"fullscreen-name"},ra={class:"fullscreen-points"},ua={class:"fullscreen-modal"},ca={class:"fullscreen-header"},da={class:"fullscreen-title"},fa={class:"fullscreen-subtitle"},va={class:"fullscreen-grid"},pa=["onClick"],ma={key:0,class:"fullscreen-crown","aria-label":"Current leader",role:"img"},ba={class:"fullscreen-name"},ya={class:"fullscreen-points"},ha={key:0,class:"rain-overlay"},_a=Ae({__name:"TeamPointsTracker",props:{teams:{},maxTeams:{}},emits:["update:teams","team-selected"],setup(ke,{expose:ae,emit:O}){const G=ke,P=O,T=$(()=>{const a=G.maxTeams??8;return Math.min(Math.max(a,1),8)}),c=v([]),m=v(-1),y=v(!1),A=v(!1),p=v(!0),I=v(!1),W=v([]),h=Ke({name:"",points:0,powerUps:[]}),se=v(null),z=new Set(["t1_tip_jar","t1_party_favor","t1_donation","t1_nothing","t2_steal40_one","t2_give40_one","t3_swap_any_team","t3_rain_of_points","t3_steal20_each"]);function E(a){return z.has(a)}Ne(()=>G.teams,a=>{if(Array.isArray(a)&&a.length>0)c.value=a.slice(0,T.value).map((e,t)=>({id:e.id??t,name:e.name??`Team ${t+1}`,points:Number.isFinite(e.points)?e.points:0,powerUps:Array.isArray(e.powerUps)?[...e.powerUps]:[]}));else if(!c.value.length){const e=Math.min(4,T.value);c.value=Array.from({length:e}).map((t,n)=>({id:n,name:`Team ${n+1}`,points:0,powerUps:[]}))}},{immediate:!0,deep:!0});const _=$(()=>c.value.slice(0,T.value));Ne(()=>_.value.length,a=>{W.value=Array(a).fill(!1)},{immediate:!0});function ne(){const a=_.value.length;W.value.length!==a&&(W.value=Array(a).fill(!1))}function D(a){return a<0||a>=c.value.length?null:c.value[a]}function w(a,e){const t=[...c.value];t[a]=e,c.value=t,P("update:teams",t)}function le(a){m.value===a?(m.value=-1,y.value=!1,P("team-selected",null)):(m.value=a,y.value=!1,P("team-selected",_.value[a]??null))}function oe(){const a=m.value;if(!(a<0||a>=_.value.length)&&(y.value=!y.value,y.value)){const e=_.value[a];h.name=e.name,h.points=e.points,h.powerUps=Array.isArray(e.powerUps)?[...e.powerUps]:[]}}function H(){if(m.value<0||m.value>=_.value.length)return;const a=m.value,e=[...c.value],t=Number.isFinite(h.points)?Math.round(h.points):0,n=e[a];e[a]={...n,name:h.name.trim()||`Team ${a+1}`,points:t,powerUps:[...h.powerUps]},c.value=e,P("update:teams",e),y.value=!1}function Q(a){if(!y.value)return;const e=se.value;if(!e)return;const t=a.target;t&&(e.contains(t)||(y.value=!1))}const N=$(()=>{const a=_.value;if(!a.length)return-1;let e=-1/0,t=-1;return a.forEach((n,i)=>{n.points>e&&(e=n.points,t=i)}),e<=0?-1:t}),Z=$(()=>N.value!==-1),de=$(()=>c.value.length<T.value),ee=$(()=>c.value.length>1);function be(){if(!de.value)return;const a=[...c.value],e=a.length,n={id:(a.length>0?Math.max(...a.map(i=>i.id)):-1)+1,name:`Team ${e+1}`,points:0,powerUps:[]};a.push(n),c.value=a,m.value=e,y.value=!1,P("update:teams",a),P("team-selected",n)}function U(){if(!ee.value)return;const a=m.value;a<0||K(a)}function q(){ee.value&&(m.value<0||m.value>=_.value.length||K(m.value))}function K(a){const e=[...c.value];if(a<0||a>=e.length)return;e.splice(a,1);const t=Math.min(a,e.length-1);m.value=e.length?Math.max(t,0):-1,y.value=!1,c.value=e,P("update:teams",e),P("team-selected",e[m.value]??null)}function X(a){a<0||a>=h.powerUps.length||h.powerUps.splice(a,1)}function V(){A.value=!A.value}function F(){A.value=!1}function fe(a){if(!_.value.length||!Number.isFinite(a))return;const e=m.value;if(e<0||e>=_.value.length)return;const t=D(e);if(!t)return;const n=Math.round(a),i={...t,points:(t.points??0)+n,powerUps:t.powerUps??[]};w(e,i)}function k(a,e){if(a<0||a>=c.value.length||!Number.isFinite(e))return;const t=D(a);if(!t)return;const n={...t,points:t.points+Math.round(e),powerUps:t.powerUps??[]};w(a,n)}function te(a,e){if(a<0||a>=c.value.length)return;const t=D(a);if(!t)return;const n={...t,points:Math.round(e),powerUps:t.powerUps??[]};w(a,n)}function ie(a,e,t,n,i){if(a<0||a>=c.value.length)return;const x=D(a);if(!x)return;const b=[...x.powerUps??[],{id:e,tier:t,label:n,scope:i}],M={...x,powerUps:b};w(a,M)}function re(a){if(E(a.id))return;const e=m.value;e<0||e>=_.value.length||ie(e,a.id,a.tier,a.label,"round")}function ue(){const a=m.value;if(a<0||a>=c.value.length)return[];const e=c.value[a];return Array.isArray(e.powerUps)?[...e.powerUps]:[]}function ye(a){const e=m.value;if(e<0||e>=c.value.length)return;const t=D(e);if(!t)return;const n=Array.isArray(t.powerUps)?[...t.powerUps]:[],i=n.findIndex(L=>L.id===a);if(i===-1)return;n.splice(i,1);const x={...t,powerUps:n};w(e,x)}function ve(){const a=c.value.map(e=>({...e,powerUps:[]}));c.value=a,P("update:teams",a)}const R=v(null),pe=$(()=>{const a=R.value;if(!a)return"";switch(a.mode){case"steal40_one":return"Steal 40 points";case"give40_one":return"Give 40 points";case"swap_any_team":return"Swap scores with a team"}}),he=$(()=>{const a=R.value;if(!a)return"";switch(a.mode){case"steal40_one":return"Click a team to steal 40 points from them.";case"give40_one":return"Click a team to give them 40 points.";case"swap_any_team":return"Click a team to swap total scores with them."}});function ce(a){const e=c.value;e.length&&(I.value=!0,window.setTimeout(()=>{e.forEach((t,n)=>{n===a?k(n,80):k(n,40)}),I.value=!1},900))}function l(a){const e=m.value;if(e<0||e>=_.value.length)return!1;switch(a.id){case"t1_tip_jar":return k(e,20),!0;case"t1_party_favor":return c.value.forEach((t,n)=>k(n,10)),!0;case"t1_donation":{let t=-1,n=1/0;return c.value.forEach((i,x)=>{i.points<n&&(n=i.points,t=x)}),t!==-1&&k(t,20),!0}case"t1_nothing":return!0;case"t2_steal40_one":return R.value={mode:"steal40_one",prize:a,sourceIndex:e},!0;case"t2_give40_one":return R.value={mode:"give40_one",prize:a,sourceIndex:e},!0;case"t3_swap_any_team":return R.value={mode:"swap_any_team",prize:a,sourceIndex:e},!0;case"t3_rain_of_points":return ce(e),!0;case"t3_steal20_each":{let t=0;return c.value.forEach((n,i)=>{i!==e&&(k(i,-20),t+=20)}),t&&k(e,t),!0}default:return!1}}function o(){R.value=null}function r(a){const e=R.value;if(!e)return;const t=e.sourceIndex;if(!(a<0||a>=c.value.length)&&a!==t){switch(e.mode){case"steal40_one":k(a,-40),k(t,40);break;case"give40_one":k(a,40);break;case"swap_any_team":{const n=D(t),i=D(a);if(!n||!i)break;const x=n.points,L=i.points;te(t,L),te(a,x);break}}R.value=null}}function f(a,e){switch(a){case"t2_double_next":return"x2";case"t3_triple_next":return"x3";case"t1_tip_jar":return"Tip +20";case"t1_party_favor":return"+10 all";case"t1_donation":return"Donate +20";case"t1_nothing":return"No bonus";default:return e}}async function S(){const a=[...c.value],e=a.length;if(e<=1)return;const t=a.map(b=>b.points),n=Array.from({length:e},(b,M)=>M);for(let b=e-1;b>0;b--){const M=Math.floor(Math.random()*b);[n[b],n[M]]=[n[M],n[b]]}const i=n.map(b=>t[b]);if(i.some((b,M)=>b===t[M])){const b=t.slice(1).concat(t[0]);for(let M=0;M<e;M++)i[M]=b[M]}ne(),W.value=W.value.map(()=>!0),await new Promise(b=>setTimeout(b,260));const L=a.map((b,M)=>({...b,points:i[M]}));c.value=L,P("update:teams",L);for(let b=0;b<e;b++)W.value[b]=!1,W.value=[...W.value],await new Promise(M=>setTimeout(M,140))}return ae({addPoints:k,setPoints:te,applyDeltaToSelected:fe,addPrizeToSelected:re,getHeldPowersForSelected:ue,consumeHeldPower:ye,clearRoundPowerUps:ve,resolveImmediateMysteryEffect:l,shuffleAllTeamPoints:S}),Le(()=>{window.addEventListener("pointerdown",Q,{capture:!0})}),Ue(()=>{window.removeEventListener("pointerdown",Q,{capture:!0})}),(a,e)=>_.value.length?(u(),d("section",It,[p.value?(u(),d("button",{key:0,type:"button",class:"reopen-btn",onClick:e[0]||(e[0]=t=>p.value=!1),title:"Show team scores"}," â–¾ ")):C("",!0),we(Ce,{name:"tracker-slide"},{default:Me(()=>[p.value?C("",!0):(u(),d("div",Nt,[s("div",Rt,[s("div",Ft,[s("button",{type:"button",class:"stack-btn collapse-btn",onClick:e[1]||(e[1]=t=>p.value=!0),title:"Hide team bar"}," â–´ "),s("button",{type:"button",class:"stack-btn edit-btn",onClick:oe,disabled:m.value<0||m.value>=_.value.length,title:"Edit selected team"}," âœ ",8,Ot),s("button",{type:"button",class:"stack-btn fullscreen-btn",onClick:V,"aria-pressed":A.value,title:A.value?"Close scoreboard view":"Open scoreboard view"}," â›¶ ",8,Wt)]),s("div",Lt,[(u(!0),d(B,null,Y(_.value,(t,n)=>(u(),d("button",{key:t.id,class:j(["team-tab",{"is-selected":n===m.value,"is-leader":n===N.value}]),type:"button",onClick:i=>le(n)},[s("div",Bt,[s("span",jt,g(t.name||`Team ${n+1}`),1),s("span",Ht,g(t.points),1),t.powerUps&&t.powerUps.length?(u(),d("div",Vt,[(u(!0),d(B,null,Y(t.powerUps,(i,x)=>(u(),d("span",{key:`${t.id}-pu-${x}`,class:j(["powerup-chip",[`tier-${i.tier}`,i.scope==="round"?"is-round":"is-next"]])},g(f(i.id,i.label)),3))),128))])):C("",!0)]),N.value===n&&Z.value?(u(),d("span",Yt," ðŸ‘‘ ")):C("",!0)],10,zt))),128))]),s("div",Gt,[s("button",{class:"side-btn",type:"button",onClick:ve,title:"Remove all perks from all teams"}," ðŸš« "),s("button",{class:"side-btn",type:"button",disabled:!ee.value,onClick:U,title:"Remove team"}," âˆ’ ",8,qt),s("button",{class:"side-btn",type:"button",disabled:!de.value,onClick:be,title:"Add team"}," ï¼‹ ",8,Kt)])]),y.value&&m.value!==-1?(u(),d("div",{key:0,class:"edit-panel",ref_key:"editPanelRef",ref:se},[s("div",Xt,[s("label",null,[e[4]||(e[4]=Pe(" Team name ",-1)),me(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>h.name=t),type:"text",maxlength:"24"},null,512),[[Re,h.name]])])]),s("div",Jt,[s("label",null,[e[5]||(e[5]=Pe(" Points ",-1)),me(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>h.points=t),type:"number",step:"1"},null,512),[[Re,h.points,void 0,{number:!0}]])])]),h.powerUps&&h.powerUps.length?(u(),d("div",Qt,[s("label",null,[e[7]||(e[7]=Pe(" Power-ups ",-1)),s("div",Zt,[(u(!0),d(B,null,Y(h.powerUps,(t,n)=>(u(),d("button",{key:`edit-pu-${n}-${t.id}`,type:"button",class:"edit-powerup-chip",onClick:i=>X(n)},[s("span",ta,g(f(t.id,t.label)),1),e[6]||(e[6]=s("span",{class:"chip-remove"},"âœ•",-1))],8,ea))),128))])])])):C("",!0),s("div",aa,[s("button",{type:"button",class:"btn small danger",disabled:!ee.value,onClick:q}," Delete ",8,sa),s("button",{type:"button",class:"btn small primary",onClick:H}," Save ")])],512)):C("",!0)]))]),_:1}),(u(),xe($e,{to:"body"},[A.value?(u(),d("div",{key:0,class:"fullscreen-overlay",onClick:J(F,["self"])},[s("div",na,[s("header",{class:"fullscreen-header"},[e[8]||(e[8]=s("h2",{class:"fullscreen-title"}," Team Scores ",-1)),s("button",{type:"button",class:"btn small secondary",onClick:F}," Close ")]),s("div",la,[(u(!0),d(B,null,Y(_.value,(t,n)=>(u(),d("article",{key:t.id,class:j(["fullscreen-card",{"is-leader":n===N.value}])},[n===N.value&&Z.value?(u(),d("div",oa," ðŸ‘‘ ")):C("",!0),s("div",ia,g(t.name||`Team ${n+1}`),1),s("div",ra,g(t.points),1)],2))),128))])])])):C("",!0)])),(u(),xe($e,{to:"body"},[R.value?(u(),d("div",{key:0,class:"fullscreen-overlay",onClick:J(o,["self"])},[s("div",ua,[s("header",ca,[s("h2",da,g(pe.value),1),s("button",{type:"button",class:"btn small secondary",onClick:o}," Cancel ")]),s("p",fa,g(he.value),1),s("div",va,[(u(!0),d(B,null,Y(_.value,(t,n)=>(u(),d("article",{key:"effect-"+t.id,class:j(["fullscreen-card",{"is-leader":n===N.value,"is-disabled":n===R.value?.sourceIndex}]),onClick:i=>r(n)},[n===N.value&&Z.value?(u(),d("div",ma," ðŸ‘‘ ")):C("",!0),s("div",ba,g(t.name||`Team ${n+1}`),1),s("div",ya,g(t.points),1)],10,pa))),128))])])])):C("",!0)])),(u(),xe($e,{to:"body"},[we(Ce,{name:"rain-pop"},{default:Me(()=>[I.value?(u(),d("div",ha,[...e[9]||(e[9]=[s("div",{class:"rain-label"}," ðŸŒ§ï¸ Rain of Points! ðŸŒˆ ",-1)])])):C("",!0)]),_:1})]))])):C("",!0)}}),ga=De(_a,[["__scopeId","data-v-4f7c7d59"]]),wa="/TaiyakiEduGames/assets/spinning_sfx-B-LM3m4d.mp3",ka="/TaiyakiEduGames/assets/mystery-machine-a5NpraJ-.mp3",Ta=["aria-expanded"],xa={class:"menu-row"},Ma={class:"menu-row"},Ca={class:"menu-row"},Sa={class:"menu-row"},$a={class:"mute-row"},Pa=["aria-pressed"],Ea={class:"label-cell row"},Aa=["onClick","onKeydown"],Ua={class:"face back"},Da=.35,We="random-points-settings",Ee=4,_e=6,Ia=150,Na=110,Ra=Ae({__name:"RandomPoints",setup(ke){const ae=v(!1),O=v(null),G=v(!1),P=v(null),T=v(!1),c=v(!0),m=v(!1),y=v(!0),A=v(!1);v(!1);const p=v(!1),I=Ee*_e,W=["A","B","C","D","E","F"],h=v(Array.from({length:I},(l,o)=>({id:o,value:0,display:"",revealed:!1}))),se=v(typeof window<"u"?window.innerHeight:800),z=v(typeof window<"u"?window.innerWidth:1280),E=Xe(),_=()=>E.back();function ne(){ae.value=!1}function D(){const l=O.value;if(!l||typeof l.getHeldPowersForSelected!="function")return[];const o=l.getHeldPowersForSelected();return Array.isArray(o)?o:[]}function w(l){const o=O.value,r=D(),f=r.some(t=>t.id==="t3_triple_next"),S=r.some(t=>t.id==="t2_double_next");let a=1;f?a=3:S&&(a=2);const e=l*a;if(a>1&&o&&typeof o.consumeHeldPower=="function"){const t=f?"t3_triple_next":"t2_double_next";o.consumeHeldPower(t)}return e}function le(l){if(!l||!l.effect||!G.value||!O.value)return;const o=O.value,r={id:l.effect.id,tier:l.effect.tier,label:l.effect.label,source:"mystery",wager:l.wager};typeof o.resolveImmediateMysteryEffect=="function"&&o.resolveImmediateMysteryEffect(r)||typeof o.addPrizeToSelected=="function"&&o.addPrizeToSelected(r)}function oe(l){if(!l||typeof l.pointsDelta!="number"||!G.value)return;const o=l.pointsDelta;o!==0&&O.value?.applyDeltaToSelected(o)}function H(l){G.value=!!l}const Q=$(()=>{const l=z.value;return l<=360?22:l<=420?24:l<=520?26:l<=680?28:30}),N=$(()=>{const l=z.value;return l<=360?6:l<=420?7:l<=520?8:l<=680?9:10}),Z=$(()=>({"--labelW":`${Q.value}px`,"--gap":`${N.value}px`})),de=$(()=>({height:`${Math.max(320,se.value-Ia-Na)}px`,gridTemplateColumns:`var(--labelW) repeat(${_e}, 1fr)`,gridTemplateRows:`repeat(${Ee}, 1fr)`,gap:"var(--gap)"})),ee=$(()=>({gridTemplateColumns:`var(--labelW) repeat(${_e}, 1fr)`,gap:"var(--gap)"})),be=(l,o)=>(l-1)*_e+(o-1),U=(l,o)=>h.value[be(l,o)],q=l=>l==="Mystery Machine",K=l=>l==="Tornado";function X(l){return typeof l=="number"?l>0?"val-pos":l<0?"val-neg":"val-zero":l==="Mystery Machine"?"val-mystery val-text":l==="Tornado"?"val-tornado val-text":"val-text"}function V(l,o){return Math.floor(Math.random()*(o-l+1))+l}const F={positive:new Audio(ze),negative:new Audio(He),swap:new Audio(wa),loseAll:new Audio(je),jackpot:new Audio(Be),mystery:new Audio(ka)};function fe(){const l=p.value?0:Da;F.positive.volume=l,F.negative.volume=l,F.swap.volume=l,F.loseAll.volume=l,F.jackpot.volume=l,F.mystery.volume=l}function k(l){const o=F[l];try{o.currentTime=0,o.play()}catch{}}function te(){p.value=!p.value,fe(),pe()}function ie(){const l=[],r=m.value?200:100;l.push(r);let f=I-l.length;if(y.value&&f>0){const t=V(2,4),n=Math.min(t,f);for(let i=0;i<n;i++)l.push("Mystery Machine");f=I-l.length}if(A.value&&f>0){const t=V(2,4),n=Math.min(t,f);for(let i=0;i<n;i++)l.push("Tornado");f=I-l.length}const S=I-l.length;let a=S,e=0;c.value&&(a=Math.floor(S*.7),e=S-a);for(let t=0;t<a;t++){const n=10*V(1,10),i=m.value?n*2:n;l.push(i)}for(let t=0;t<e;t++){const n=-10*V(1,5),i=m.value?n*2:n;l.push(i)}for(let t=l.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[l[t],l[n]]=[l[n],l[t]]}return l}function re(){const l=ie();for(let o=0;o<I;o++){const r=l[o],f=h.value[o];f.value=r,f.display=typeof r=="number"?String(r):r,f.revealed=!1}}function ue(l){if(!l||l.revealed)return;if(typeof l.value=="string")l.value==="Mystery Machine"?k("mystery"):l.value==="Tornado"?k("swap"):k("mystery");else{const a=m.value?200:100;l.value===a?k("jackpot"):l.value>0?k("positive"):k("negative")}if(l.revealed=!0,typeof l.value=="string"){if(l.value==="Tornado"){const S=O.value;S&&typeof S.shuffleAllTeamPoints=="function"?S.shuffleAllTeamPoints():console.warn("[RandomPoints] Tornado card revealed, but TeamPointsTracker.shuffleAllTeamPoints() not found.")}return}if(!G.value)return;const o=O.value;if(!o)return;const r=l.value,f=w(r);o.applyDeltaToSelected(f)}function ye(){for(const l of h.value)l.revealed=!0}function ve(){re()}function R(){T.value=!T.value}function pe(){localStorage.setItem(We,JSON.stringify({allowNegatives:c.value,doublePoints:m.value,allowSpecial:y.value,allowTornado:A.value,sfxMuted:p.value}))}function he(){pe(),re(),T.value=!1}function ce(){se.value=window.innerHeight,z.value=window.innerWidth}return Le(()=>{try{const l=localStorage.getItem(We);if(l){const o=JSON.parse(l);typeof o.allowNegatives=="boolean"&&(c.value=o.allowNegatives),typeof o.doublePoints=="boolean"&&(m.value=o.doublePoints),typeof o.allowSpecial=="boolean"&&(y.value=o.allowSpecial),typeof o.allowTornado=="boolean"&&(A.value=o.allowTornado),typeof o.sfxMuted=="boolean"&&(p.value=o.sfxMuted)}}catch{}fe(),re(),ce(),window.addEventListener("resize",ce,{passive:!0})}),Ue(()=>{window.removeEventListener("resize",ce)}),(l,o)=>(u(),d("section",{class:"random-points-page app-bg",style:ge(Z.value)},[we(ga,{ref_key:"teamTracker",ref:O,onTeamSelected:H},null,512),s("button",{class:"icon-btn back",type:"button",onClick:_,"aria-label":"Back",title:"Back"},[...o[7]||(o[7]=[s("img",{class:"icon",src:Je,alt:""},null,-1)])]),s("button",{class:"icon-btn settings",type:"button",onClick:R,"aria-haspopup":"dialog","aria-expanded":T.value,"aria-controls":"settings-menu","aria-label":"Open settings",title:"Settings"},[...o[8]||(o[8]=[s("img",{class:"icon",src:Qe,alt:""},null,-1)])],8,Ta),s("button",{class:"icon-btn mystery",type:"button",onClick:o[0]||(o[0]=r=>ae.value=!0),"aria-label":"Open Mystery Machine",title:"Mystery Machine"},[...o[9]||(o[9]=[s("img",{class:"icon",src:tt,alt:""},null,-1)])]),ae.value?(u(),xe(Dt,{key:0,maxWager:P.value,onClose:ne,onResolved:oe,onEffectOpened:le},null,8,["maxWager"])):C("",!0),T.value?(u(),d("div",{key:1,class:"settings-overlay",role:"presentation",onClick:o[6]||(o[6]=r=>T.value=!1)},[s("div",{id:"settings-menu",class:"settings-menu",role:"dialog","aria-modal":"true",onClick:o[5]||(o[5]=J(()=>{},["stop"]))},[o[14]||(o[14]=s("h3",{class:"menu-title"},"Settings",-1)),s("label",xa,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=r=>c.value=r)},null,512),[[Te,c.value]]),o[10]||(o[10]=s("span",null,"Negative Numbers",-1))]),s("label",Ma,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=r=>m.value=r)},null,512),[[Te,m.value]]),o[11]||(o[11]=s("span",null,"Double Points",-1))]),s("label",Ca,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=r=>A.value=r)},null,512),[[Te,A.value]]),o[12]||(o[12]=s("span",null,"Tornado Cards",-1))]),s("label",Sa,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=r=>y.value=r)},null,512),[[Te,y.value]]),o[13]||(o[13]=s("span",null,"Mystery Machine Cards",-1))]),s("div",$a,[s("button",{class:"mute-btn","aria-pressed":p.value,onClick:te},g(p.value?"Unmute SFX":"Mute SFX"),9,Pa)]),s("button",{class:"apply",onClick:he},"Apply")])])):C("",!0),o[17]||(o[17]=s("h1",{class:"title"},null,-1)),s("div",{class:"labels",style:ge(ee.value)},[o[15]||(o[15]=s("div",null,null,-1)),(u(),d(B,null,Y(W,r=>s("div",{key:r,class:"label-cell"},g(r),1)),64))],4),s("div",{class:"grid",style:ge(de.value)},[(u(),d(B,null,Y(Ee,r=>(u(),d(B,{key:`r-${r}`},[s("div",Ea,g(r),1),(u(),d(B,null,Y(_e,f=>s("div",{key:`c-${r}-${f}`,class:"grid-item"},[s("div",{class:j(["card",{"mystery-card":q(U(r,f).value),"mystery-card--revealed":q(U(r,f).value)&&U(r,f).revealed,"tornado-card":K(U(r,f).value),"tornado-card--revealed":K(U(r,f).value)&&U(r,f).revealed}]),role:"button",tabindex:"0",onClick:J(S=>ue(U(r,f)),["stop"]),onKeydown:[Fe(J(S=>ue(U(r,f)),["prevent"]),["enter"]),Fe(J(S=>ue(U(r,f)),["prevent"]),["space"])]},[s("div",{class:j(["flip-inner",{revealed:U(r,f).revealed}])},[o[16]||(o[16]=s("div",{class:"face front"},null,-1)),s("div",Ua,[s("span",{class:j(["value",X(U(r,f).value)])},g(U(r,f).display),3)])],2)],42,Aa)])),64))],64))),64))],4),s("div",{class:"controls"},[s("button",{class:"big-btn",onClick:ve},"Reset"),s("button",{class:"big-btn",onClick:ye},"See All")])],4))}}),Ha=De(Ra,[["__scopeId","data-v-46659d43"]]);export{Ha as default};
