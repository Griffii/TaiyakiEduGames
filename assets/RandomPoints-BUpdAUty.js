import{d as Ee,r as v,c as $,g as Ue,a as d,l as Q,b as s,e as C,p as V,t as g,x as we,w as Me,T as Ce,F as B,h as Y,v as Ie,K as qe,f as u,n as ge,_ as De,V as Ge,Q as Re,o as We,i as xe,L as $e,z as Pe,E as me,G as Ne,u as Xe,I as Te,m as Fe}from"./index-BgubLVmS.js";import{b as Qe}from"./back-icon-xKqy7r3s.js";import{s as Je}from"./settings-icon-DNAQU5t-.js";import{s as Ze,a as ze}from"./shokichi-w04Qad4i.js";import{s as Be,a as Ve,b as et,c as je}from"./kyo-DeKHWuAX.js";const tt="/assets/mystery-machine-icon-DFeu74Q1.png",at="/assets/mystery-machine-body-D8HKPlGZ.png",st="/assets/slot-arm-DQdLv0uY.png",nt="/assets/slot-machine-DpezDdAa.mp3",lt={class:"mm-stage"},ot={class:"mm-machine"},rt={class:"mm-stack"},it={class:"mm-top-panel"},ut={class:"wager-section"},ct={class:"wager-inner"},dt={class:"wager-header"},ft={class:"wager-controls"},vt=["disabled"],pt={class:"wager-value-block"},mt={class:"wager-amount"},bt=["disabled"],ht={class:"mm-toast-panel"},yt={key:"toast",class:"mm-toast"},_t={class:"mm-toast-text"},gt={class:"reels-layer"},wt={class:"slot-frame"},kt={class:"reel-symbol"},Tt=["src"],xt=["disabled","aria-disabled"],Mt=["src"],Ct={key:0,class:"effect-modal"},St={class:"effect-header"},$t={class:"effect-title"},Pt={class:"effect-body"},At={class:"effect-description"},Et=48,Le=3500,Ut=Ee({__name:"MysteryMachine",props:{maxWager:{}},emits:["close","resolved","effect-opened"],setup(ke,{emit:ae}){const L=at,K=st;let P=null;const T=new Map;typeof window<"u"&&typeof Audio<"u"&&(P=new Audio(nt),T.set("return",Ze),T.set("quadruple",Be),T.set("lose_all",Ve),T.set("double",et),T.set("lose_half",je),T.set("triple",ze));function c(){if(P)try{P.currentTime=0,P.play().catch(()=>{})}catch{}}function m(e){const t=T.get(e);if(t)try{const n=new Audio(t);n.currentTime=0,n.play().catch(()=>{})}catch{}}const h=ke,E=ae,p=v(10),I=["ðŸ’£","âš–ï¸","â­•","âœ¨","ðŸ†","7ï¸âƒ£"],O={lose_all:"ðŸ’£",lose_half:"â­•",return:"âš–ï¸",double:"âœ¨",triple:"ðŸ†",quadruple:"7ï¸âƒ£"},y=360/I.length,se=[2300,2900,3400],z=v([0,0,0]),A=v(!1),_=v(!1),ne=v(!1),D=v(null),w=v(null),le=v(0),oe=v(null),j=v(!1),J=v(!1),R=v(!1),Z=v(""),de=[{id:"t1_tip_jar",tier:1,label:"+20 points"},{id:"t1_party_favor",tier:1,label:"+10 points to every team"},{id:"t1_donation",tier:1,label:"+20 points to the lowest team"},{id:"t1_nothing",tier:1,label:"Nothing happens"}],ee=[{id:"t2_double_next",tier:2,label:"2x next card"},{id:"t2_steal40_one",tier:2,label:"Steal 40 points from one team"},{id:"t2_give40_one",tier:2,label:"+40 points to one team"}],be=[{id:"t3_triple_next",tier:3,label:"3x next card"},{id:"t3_steal20_each",tier:3,label:"Steal 20 points from each team"},{id:"t3_swap_any_team",tier:3,label:"Swap total points with another team"},{id:"t3_rain_of_points",tier:3,label:"Rain of points: +80 for you, +40 for all other teams"}],U={t1_tip_jar:"Your team gains +20 points.",t1_party_favor:"Every team gains +10 points.",t1_donation:"The team with the lowest score gains +20 points.",t1_nothing:"Nothing happens this time.",t2_double_next:"Your next card is doubled.",t2_steal40_one:"Steal 40 points from anohter team.",t2_give40_one:"Plus 40 points to another team.",t3_triple_next:"Your next card is tripled!",t3_steal20_each:"Steal 20 points from ALL other teams.",t3_swap_any_team:"Swap your total score with any team.",t3_rain_of_points:"You gain +80 points, every other team gains +40 points."},q=[{type:"lose_all",weight:22},{type:"lose_half",weight:18},{type:"return",weight:25},{type:"double",weight:18},{type:"triple",weight:10},{type:"quadruple",weight:7}],G=[],X=$(()=>!(A.value||p.value<10||p.value%10!==0||h.maxWager!=null&&p.value>h.maxWager)),H=$(()=>!!w.value&&!!D.value&&!A.value),F=$(()=>re(p.value)),fe=$(()=>w.value?U[w.value.id]??w.value.label:"");function k(e){switch(e){case"lose_all":return"Lose all wager";case"lose_half":return"Lose half wager";case"return":return"No change (return wager)";case"double":return"Double wager";case"triple":return"Triple wager";case"quadruple":return"Quadruple wager"}}$(()=>{const e=q.reduce((t,n)=>t+n.weight,0);return q.map(({type:t,weight:n})=>{const r=n/e*100;return{type:t,name:k(t),percent:r.toFixed(1)}})});function te(){p.value<0&&(p.value=0),h.maxWager!=null&&p.value>h.maxWager&&(p.value=h.maxWager),p.value%10!==0&&(p.value=Math.round(p.value/10)*10)}function re(e){return e>=100?3:e>=50?2:1}function ie(e){let t=[];e>=1&&(t=t.concat(de)),e>=2&&(t=t.concat(ee)),e>=3&&(t=t.concat(be));const n=Math.floor(Math.random()*t.length);return t[n]}function ue(){const e=q.reduce((r,x)=>r+x.weight,0),t=Math.random()*e;let n=0;for(const r of q)if(n+=r.weight,t<=n)return r.type;return"return"}function he(e,t){let n="",r=0;switch(e){case"lose_all":n="You lost your entire wager",r=-t;break;case"lose_half":n="You lost half your wager",r=-Math.round(t/2);break;case"return":n="Your wager was returned (no change)",r=0;break;case"double":n="Your wager was doubled",r=t;break;case"triple":n="Your wager was tripled",r=2*t;break;case"quadruple":n="Your wager was quadrupled",r=3*t;break}return{outcome:{type:e,label:n},delta:r}}function ve(e){const n=`rotateX(${z.value[e]}deg)`;if(_.value)return{transform:n,transition:"transform 0s"};if(A.value){const r=se[e]??Le;return{transform:n,transition:`transform ${r}ms cubic-bezier(.2,.8,.3,1.1)`}}return{transform:n,transition:"transform 0s"}}function N(e){return{transform:`rotateX(${e*y}deg) translateZ(${Et}px)`}}function pe(e,t){const n=e===0?"0 points":`${e>0?"+":""}${e} points`;Z.value=n,R.value=!0,m(t)}function ye(){R.value=!1}function ce(){if(!X.value)return;te(),D.value=null,w.value=null,le.value=0,oe.value=null,j.value=!1,R.value=!1;const e=ue(),{outcome:t,delta:n}=he(e,p.value),r=re(p.value),x=ie(r),W=O[e],b=I.indexOf(W),M=b>=0?b:0;A.value=!1,_.value=!0,z.value=[0,0,0];try{document.body.offsetHeight}catch{}window.requestAnimationFrame(()=>{_.value=!1,A.value=!0;const He=3;z.value=z.value.map((Se,Ke)=>-((He+Ke)*360+M*y));const Ye=window.setTimeout(()=>{D.value=t,w.value=x,le.value=n,A.value=!1;const Se={wager:p.value,wagerOutcome:t,pointsDelta:n,tier:r,effect:x};oe.value=Se,E("resolved",Se),pe(n,t.type)},Le);G.push(Ye)})}function l(){if(!X.value||A.value)return;ne.value=!0,c();const e=window.setTimeout(()=>{ne.value=!1},350);G.push(e),ce()}function o(e){A.value||(p.value+=e,p.value<0&&(p.value=0),te())}function i(){if(!H.value||!w.value||!D.value)return;j.value=!0;const e=oe.value??{wager:p.value,wagerOutcome:D.value,pointsDelta:le.value,tier:re(p.value),effect:w.value};console.log("[MysteryMachine] effect-opened",e.effect.id,e),E("effect-opened",e)}function f(){j.value=!1}function S(){E("close")}function a(){S()}return Ue(()=>{G.forEach(e=>clearTimeout(e))}),(e,t)=>(u(),d("section",{class:"mystery-machine-overlay",role:"dialog","aria-modal":"true",onClick:Q(a,["self"])},[s("button",{class:"overlay-prizes-btn",type:"button",onClick:t[0]||(t[0]=n=>J.value=!0),"aria-label":"View prize tiers"}," â“ "),s("button",{class:"overlay-close-btn",type:"button",onClick:S,"aria-label":"Close Mystery Machine"}," âœ• "),s("div",lt,[s("section",ot,[s("div",rt,[s("div",it,[s("section",ut,[s("div",ct,[s("div",dt,[t[4]||(t[4]=s("span",{class:"wager-label"},"Wager",-1)),s("span",{class:V(["wager-tier-pill",`tier-${F.value}`])}," Tier "+g(F.value),3)]),s("div",ft,[s("button",{type:"button",class:"arrow-btn",onClick:t[1]||(t[1]=n=>o(-10)),disabled:A.value||p.value<=0,"aria-label":"Decrease wager"}," â—€ ",8,vt),s("div",pt,[s("span",mt,g(p.value)+" pts ",1)]),s("button",{type:"button",class:"arrow-btn",onClick:t[2]||(t[2]=n=>o(10)),disabled:A.value||e.maxWager!=null&&p.value>=e.maxWager,"aria-label":"Increase wager"}," â–¶ ",8,bt)])])])]),s("div",ht,[we(Ce,{name:"mm-toast-slide"},{default:Me(()=>[R.value?(u(),d("div",yt,[s("span",_t,g(Z.value),1),s("button",{class:"mm-toast-close",type:"button",onClick:ye,"aria-label":"Dismiss message"}," âœ• ")])):C("",!0)]),_:1})]),s("div",gt,[s("div",wt,[(u(!0),d(B,null,Y(z.value,(n,r)=>(u(),d("div",{key:r,class:"reel3d"},[s("div",{class:"reel3d-inner",style:ge(ve(r))},[(u(),d(B,null,Y(I,(x,W)=>s("div",{key:W,class:"reel-face",style:ge(N(W))},[s("span",kt,g(x),1)],4)),64))],4)]))),128))])]),s("img",{src:Ie(L),alt:"Mystery Machine body",class:"machine-body-img",draggable:"false"},null,8,Tt),H.value&&!j.value?(u(),d("button",{key:0,class:V(["prize-btn",{"has-prize":H.value}]),type:"button",onClick:i},[...t[5]||(t[5]=[s("span",{class:"prize-label"},"ðŸŽ Mystery Prize",-1)])],2)):C("",!0),s("button",{class:"slot-arm-btn",type:"button",disabled:!X.value||A.value,onClick:l,"aria-disabled":!X.value||A.value},[s("img",{src:Ie(K),alt:"Pull to spin",class:V(["slot-arm-img",{"is-disabled":!X.value||A.value,"is-pulled":ne.value}]),draggable:"false"},null,10,Mt)],8,xt)])])]),j.value&&w.value?(u(),d("div",{key:0,class:"effect-modal-overlay",onClick:Q(f,["self"])},[we(Ce,{name:"mm-card-pop"},{default:Me(()=>[j.value?(u(),d("div",Ct,[s("div",St,[s("h3",$t,g(w.value.label),1),s("span",{class:V(["effect-tier-chip",`tier-${w.value.tier}`])}," Tier "+g(w.value.tier),3)]),s("div",Pt,[s("p",At,g(fe.value),1)]),s("div",{class:"effect-actions"},[s("button",{class:"pill-btn primary",type:"button",onClick:f}," Close ")])])):C("",!0)]),_:1})])):C("",!0),J.value?(u(),d("div",{key:1,class:"effect-modal-overlay",onClick:t[3]||(t[3]=Q(n=>J.value=!1,["self"]))},[...t[6]||(t[6]=[qe('<div class="effect-modal info-modal" data-v-3796f3fb><h3 class="effect-title" data-v-3796f3fb>Mystery Machine: Outcomes &amp; Prizes</h3><div class="prize-grid" data-v-3796f3fb><section class="prize-col" data-v-3796f3fb><h4 class="prize-heading" data-v-3796f3fb>Wager Outcomes</h4><div class="outcome-grid" data-v-3796f3fb><div class="outcome-card outcome-bad-1" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>Lose all</span><span class="outcome-pct" data-v-3796f3fb>~22%</span></div><div class="outcome-card outcome-bad-2" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>Lose half</span><span class="outcome-pct" data-v-3796f3fb>~18%</span></div><div class="outcome-card outcome-neutral" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>No change</span><span class="outcome-pct" data-v-3796f3fb>~25%</span></div><div class="outcome-card outcome-good" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>2Ã—</span><span class="outcome-pct" data-v-3796f3fb>~18%</span></div><div class="outcome-card outcome-good" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>3Ã—</span><span class="outcome-pct" data-v-3796f3fb>~10%</span></div><div class="outcome-card outcome-good" data-v-3796f3fb><span class="outcome-label" data-v-3796f3fb>4Ã—</span><span class="outcome-pct" data-v-3796f3fb>~7%</span></div></div></section><section class="prize-col" data-v-3796f3fb><h4 class="prize-heading" data-v-3796f3fb>Prize Cards by Tier</h4><div class="tier-grid" data-v-3796f3fb><article class="tier-card tier-1" data-v-3796f3fb><header class="tier-header" data-v-3796f3fb><span class="tier-title" data-v-3796f3fb>Tier 1: 10+ points</span></header><ul class="tier-list" data-v-3796f3fb><li data-v-3796f3fb>+20 points</li><li data-v-3796f3fb>+10 to every team</li><li data-v-3796f3fb>+20 to the lowest team</li><li data-v-3796f3fb>Nothing happens</li></ul></article><article class="tier-card tier-2" data-v-3796f3fb><header class="tier-header" data-v-3796f3fb><span class="tier-title" data-v-3796f3fb>Tier 2: 50+ points</span></header><ul class="tier-list" data-v-3796f3fb><li data-v-3796f3fb>Double next card (x2)</li><li data-v-3796f3fb>Steal 40 from one team</li><li data-v-3796f3fb>+40 to one team</li></ul></article><article class="tier-card tier-3" data-v-3796f3fb><header class="tier-header" data-v-3796f3fb><span class="tier-title" data-v-3796f3fb>Tier 3: 100+ points</span></header><ul class="tier-list" data-v-3796f3fb><li data-v-3796f3fb>Triple next card (x3)</li><li data-v-3796f3fb>Steal 20 from each team</li><li data-v-3796f3fb>Swap scores with any team</li><li data-v-3796f3fb>Rain of Points (+80 you, +40 others)</li></ul></article></div></section></div><p class="prize-disclaimer" data-v-3796f3fb> All prizes are applied automatically. There is no need to manually edit team points to apply prize effects. </p></div>',1)])])):C("",!0)]))}}),Dt=De(Ut,[["__scopeId","data-v-3796f3fb"]]),It={key:0,class:"team-points-tracker"},Rt={key:0,class:"tracker-shell"},Nt={class:"tracker-row"},Ft={class:"left-stack"},Lt=["disabled"],Ot=["aria-pressed","title"],Wt={class:"tabs-row"},zt=["onClick"],Bt={class:"tab-inner"},Vt={class:"team-name"},jt={class:"team-points"},Ht={key:0,class:"team-powerups"},Yt={key:0,class:"leader-crown","aria-label":"Current leader",role:"img"},Kt={class:"team-controls"},qt=["disabled"],Gt=["disabled"],Xt={class:"edit-field"},Qt={class:"edit-field"},Jt={key:0,class:"edit-field powerups-field"},Zt={class:"edit-powerups-list"},ea=["onClick"],ta={class:"chip-label"},aa={class:"edit-actions"},sa=["disabled"],na={class:"fullscreen-modal"},la={class:"fullscreen-grid"},oa={key:0,class:"fullscreen-crown","aria-label":"Current leader",role:"img"},ra={class:"fullscreen-name"},ia={class:"fullscreen-points"},ua={class:"fullscreen-modal"},ca={class:"fullscreen-header"},da={class:"fullscreen-title"},fa={class:"fullscreen-subtitle"},va={class:"fullscreen-grid"},pa=["onClick"],ma={key:0,class:"fullscreen-crown","aria-label":"Current leader",role:"img"},ba={class:"fullscreen-name"},ha={class:"fullscreen-points"},ya={key:0,class:"rain-overlay"},_a=Ee({__name:"TeamPointsTracker",props:{teams:{},maxTeams:{}},emits:["update:teams","team-selected"],setup(ke,{expose:ae,emit:L}){const K=ke,P=L,T=$(()=>{const a=K.maxTeams??8;return Math.min(Math.max(a,1),8)}),c=v([]),m=v(-1),h=v(!1),E=v(!1),p=v(!0),I=v(!1),O=v([]),y=Ge({name:"",points:0,powerUps:[]}),se=v(null),z=new Set(["t1_tip_jar","t1_party_favor","t1_donation","t1_nothing","t2_steal40_one","t2_give40_one","t3_swap_any_team","t3_rain_of_points","t3_steal20_each"]);function A(a){return z.has(a)}Re(()=>K.teams,a=>{if(Array.isArray(a)&&a.length>0)c.value=a.slice(0,T.value).map((e,t)=>({id:e.id??t,name:e.name??`Team ${t+1}`,points:Number.isFinite(e.points)?e.points:0,powerUps:Array.isArray(e.powerUps)?[...e.powerUps]:[]}));else if(!c.value.length){const e=Math.min(4,T.value);c.value=Array.from({length:e}).map((t,n)=>({id:n,name:`Team ${n+1}`,points:0,powerUps:[]}))}},{immediate:!0,deep:!0});const _=$(()=>c.value.slice(0,T.value));Re(()=>_.value.length,a=>{O.value=Array(a).fill(!1)},{immediate:!0});function ne(){const a=_.value.length;O.value.length!==a&&(O.value=Array(a).fill(!1))}function D(a){return a<0||a>=c.value.length?null:c.value[a]}function w(a,e){const t=[...c.value];t[a]=e,c.value=t,P("update:teams",t)}function le(a){m.value===a?(m.value=-1,h.value=!1,P("team-selected",null)):(m.value=a,h.value=!1,P("team-selected",_.value[a]??null))}function oe(){const a=m.value;if(!(a<0||a>=_.value.length)&&(h.value=!h.value,h.value)){const e=_.value[a];y.name=e.name,y.points=e.points,y.powerUps=Array.isArray(e.powerUps)?[...e.powerUps]:[]}}function j(){if(m.value<0||m.value>=_.value.length)return;const a=m.value,e=[...c.value],t=Number.isFinite(y.points)?Math.round(y.points):0,n=e[a];e[a]={...n,name:y.name.trim()||`Team ${a+1}`,points:t,powerUps:[...y.powerUps]},c.value=e,P("update:teams",e),h.value=!1}function J(a){if(!h.value)return;const e=se.value;if(!e)return;const t=a.target;t&&(e.contains(t)||(h.value=!1))}const R=$(()=>{const a=_.value;if(!a.length)return-1;let e=-1/0,t=-1;return a.forEach((n,r)=>{n.points>e&&(e=n.points,t=r)}),e<=0?-1:t}),Z=$(()=>R.value!==-1),de=$(()=>c.value.length<T.value),ee=$(()=>c.value.length>1);function be(){if(!de.value)return;const a=[...c.value],e=a.length,n={id:(a.length>0?Math.max(...a.map(r=>r.id)):-1)+1,name:`Team ${e+1}`,points:0,powerUps:[]};a.push(n),c.value=a,m.value=e,h.value=!1,P("update:teams",a),P("team-selected",n)}function U(){if(!ee.value)return;const a=m.value;a<0||G(a)}function q(){ee.value&&(m.value<0||m.value>=_.value.length||G(m.value))}function G(a){const e=[...c.value];if(a<0||a>=e.length)return;e.splice(a,1);const t=Math.min(a,e.length-1);m.value=e.length?Math.max(t,0):-1,h.value=!1,c.value=e,P("update:teams",e),P("team-selected",e[m.value]??null)}function X(a){a<0||a>=y.powerUps.length||y.powerUps.splice(a,1)}function H(){E.value=!E.value}function F(){E.value=!1}function fe(a){if(!_.value.length||!Number.isFinite(a))return;const e=m.value;if(e<0||e>=_.value.length)return;const t=D(e);if(!t)return;const n=Math.round(a),r={...t,points:(t.points??0)+n,powerUps:t.powerUps??[]};w(e,r)}function k(a,e){if(a<0||a>=c.value.length||!Number.isFinite(e))return;const t=D(a);if(!t)return;const n={...t,points:t.points+Math.round(e),powerUps:t.powerUps??[]};w(a,n)}function te(a,e){if(a<0||a>=c.value.length)return;const t=D(a);if(!t)return;const n={...t,points:Math.round(e),powerUps:t.powerUps??[]};w(a,n)}function re(a,e,t,n,r){if(a<0||a>=c.value.length)return;const x=D(a);if(!x)return;const b=[...x.powerUps??[],{id:e,tier:t,label:n,scope:r}],M={...x,powerUps:b};w(a,M)}function ie(a){if(A(a.id))return;const e=m.value;e<0||e>=_.value.length||re(e,a.id,a.tier,a.label,"round")}function ue(){const a=m.value;if(a<0||a>=c.value.length)return[];const e=c.value[a];return Array.isArray(e.powerUps)?[...e.powerUps]:[]}function he(a){const e=m.value;if(e<0||e>=c.value.length)return;const t=D(e);if(!t)return;const n=Array.isArray(t.powerUps)?[...t.powerUps]:[],r=n.findIndex(W=>W.id===a);if(r===-1)return;n.splice(r,1);const x={...t,powerUps:n};w(e,x)}function ve(){const a=c.value.map(e=>({...e,powerUps:[]}));c.value=a,P("update:teams",a)}const N=v(null),pe=$(()=>{const a=N.value;if(!a)return"";switch(a.mode){case"steal40_one":return"Steal 40 points";case"give40_one":return"Give 40 points";case"swap_any_team":return"Swap scores with a team"}}),ye=$(()=>{const a=N.value;if(!a)return"";switch(a.mode){case"steal40_one":return"Click a team to steal 40 points from them.";case"give40_one":return"Click a team to give them 40 points.";case"swap_any_team":return"Click a team to swap total scores with them."}});function ce(a){const e=c.value;e.length&&(I.value=!0,window.setTimeout(()=>{e.forEach((t,n)=>{n===a?k(n,80):k(n,40)}),I.value=!1},900))}function l(a){const e=m.value;if(e<0||e>=_.value.length)return!1;switch(a.id){case"t1_tip_jar":return k(e,20),!0;case"t1_party_favor":return c.value.forEach((t,n)=>k(n,10)),!0;case"t1_donation":{let t=-1,n=1/0;return c.value.forEach((r,x)=>{r.points<n&&(n=r.points,t=x)}),t!==-1&&k(t,20),!0}case"t1_nothing":return!0;case"t2_steal40_one":return N.value={mode:"steal40_one",prize:a,sourceIndex:e},!0;case"t2_give40_one":return N.value={mode:"give40_one",prize:a,sourceIndex:e},!0;case"t3_swap_any_team":return N.value={mode:"swap_any_team",prize:a,sourceIndex:e},!0;case"t3_rain_of_points":return ce(e),!0;case"t3_steal20_each":{let t=0;return c.value.forEach((n,r)=>{r!==e&&(k(r,-20),t+=20)}),t&&k(e,t),!0}default:return!1}}function o(){N.value=null}function i(a){const e=N.value;if(!e)return;const t=e.sourceIndex;if(!(a<0||a>=c.value.length)&&a!==t){switch(e.mode){case"steal40_one":k(a,-40),k(t,40);break;case"give40_one":k(a,40);break;case"swap_any_team":{const n=D(t),r=D(a);if(!n||!r)break;const x=n.points,W=r.points;te(t,W),te(a,x);break}}N.value=null}}function f(a,e){switch(a){case"t2_double_next":return"x2";case"t3_triple_next":return"x3";case"t1_tip_jar":return"Tip +20";case"t1_party_favor":return"+10 all";case"t1_donation":return"Donate +20";case"t1_nothing":return"No bonus";default:return e}}async function S(){const a=[...c.value],e=a.length;if(e<=1)return;const t=a.map(b=>b.points),n=Array.from({length:e},(b,M)=>M);for(let b=e-1;b>0;b--){const M=Math.floor(Math.random()*b);[n[b],n[M]]=[n[M],n[b]]}const r=n.map(b=>t[b]);if(r.some((b,M)=>b===t[M])){const b=t.slice(1).concat(t[0]);for(let M=0;M<e;M++)r[M]=b[M]}ne(),O.value=O.value.map(()=>!0),await new Promise(b=>setTimeout(b,260));const W=a.map((b,M)=>({...b,points:r[M]}));c.value=W,P("update:teams",W);for(let b=0;b<e;b++)O.value[b]=!1,O.value=[...O.value],await new Promise(M=>setTimeout(M,140))}return ae({addPoints:k,setPoints:te,applyDeltaToSelected:fe,addPrizeToSelected:ie,getHeldPowersForSelected:ue,consumeHeldPower:he,clearRoundPowerUps:ve,resolveImmediateMysteryEffect:l,shuffleAllTeamPoints:S}),We(()=>{window.addEventListener("pointerdown",J,{capture:!0})}),Ue(()=>{window.removeEventListener("pointerdown",J,{capture:!0})}),(a,e)=>_.value.length?(u(),d("section",It,[p.value?(u(),d("button",{key:0,type:"button",class:"reopen-btn",onClick:e[0]||(e[0]=t=>p.value=!1),title:"Show team scores"}," â–¾ ")):C("",!0),we(Ce,{name:"tracker-slide"},{default:Me(()=>[p.value?C("",!0):(u(),d("div",Rt,[s("div",Nt,[s("div",Ft,[s("button",{type:"button",class:"stack-btn collapse-btn",onClick:e[1]||(e[1]=t=>p.value=!0),title:"Hide team bar"}," â–´ "),s("button",{type:"button",class:"stack-btn edit-btn",onClick:oe,disabled:m.value<0||m.value>=_.value.length,title:"Edit selected team"}," âœ ",8,Lt),s("button",{type:"button",class:"stack-btn fullscreen-btn",onClick:H,"aria-pressed":E.value,title:E.value?"Close scoreboard view":"Open scoreboard view"}," â›¶ ",8,Ot)]),s("div",Wt,[(u(!0),d(B,null,Y(_.value,(t,n)=>(u(),d("button",{key:t.id,class:V(["team-tab",{"is-selected":n===m.value,"is-leader":n===R.value}]),type:"button",onClick:r=>le(n)},[s("div",Bt,[s("span",Vt,g(t.name||`Team ${n+1}`),1),s("span",jt,g(t.points),1),t.powerUps&&t.powerUps.length?(u(),d("div",Ht,[(u(!0),d(B,null,Y(t.powerUps,(r,x)=>(u(),d("span",{key:`${t.id}-pu-${x}`,class:V(["powerup-chip",[`tier-${r.tier}`,r.scope==="round"?"is-round":"is-next"]])},g(f(r.id,r.label)),3))),128))])):C("",!0)]),R.value===n&&Z.value?(u(),d("span",Yt," ðŸ‘‘ ")):C("",!0)],10,zt))),128))]),s("div",Kt,[s("button",{class:"side-btn",type:"button",onClick:ve,title:"Remove all perks from all teams"}," ðŸš« "),s("button",{class:"side-btn",type:"button",disabled:!ee.value,onClick:U,title:"Remove team"}," âˆ’ ",8,qt),s("button",{class:"side-btn",type:"button",disabled:!de.value,onClick:be,title:"Add team"}," ï¼‹ ",8,Gt)])]),h.value&&m.value!==-1?(u(),d("div",{key:0,class:"edit-panel",ref_key:"editPanelRef",ref:se},[s("div",Xt,[s("label",null,[e[4]||(e[4]=Pe(" Team name ",-1)),me(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>y.name=t),type:"text",maxlength:"24"},null,512),[[Ne,y.name]])])]),s("div",Qt,[s("label",null,[e[5]||(e[5]=Pe(" Points ",-1)),me(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>y.points=t),type:"number",step:"1"},null,512),[[Ne,y.points,void 0,{number:!0}]])])]),y.powerUps&&y.powerUps.length?(u(),d("div",Jt,[s("label",null,[e[7]||(e[7]=Pe(" Power-ups ",-1)),s("div",Zt,[(u(!0),d(B,null,Y(y.powerUps,(t,n)=>(u(),d("button",{key:`edit-pu-${n}-${t.id}`,type:"button",class:"edit-powerup-chip",onClick:r=>X(n)},[s("span",ta,g(f(t.id,t.label)),1),e[6]||(e[6]=s("span",{class:"chip-remove"},"âœ•",-1))],8,ea))),128))])])])):C("",!0),s("div",aa,[s("button",{type:"button",class:"btn small danger",disabled:!ee.value,onClick:q}," Delete ",8,sa),s("button",{type:"button",class:"btn small primary",onClick:j}," Save ")])],512)):C("",!0)]))]),_:1}),(u(),xe($e,{to:"body"},[E.value?(u(),d("div",{key:0,class:"fullscreen-overlay",onClick:Q(F,["self"])},[s("div",na,[s("header",{class:"fullscreen-header"},[e[8]||(e[8]=s("h2",{class:"fullscreen-title"}," Team Scores ",-1)),s("button",{type:"button",class:"btn small secondary",onClick:F}," Close ")]),s("div",la,[(u(!0),d(B,null,Y(_.value,(t,n)=>(u(),d("article",{key:t.id,class:V(["fullscreen-card",{"is-leader":n===R.value}])},[n===R.value&&Z.value?(u(),d("div",oa," ðŸ‘‘ ")):C("",!0),s("div",ra,g(t.name||`Team ${n+1}`),1),s("div",ia,g(t.points),1)],2))),128))])])])):C("",!0)])),(u(),xe($e,{to:"body"},[N.value?(u(),d("div",{key:0,class:"fullscreen-overlay",onClick:Q(o,["self"])},[s("div",ua,[s("header",ca,[s("h2",da,g(pe.value),1),s("button",{type:"button",class:"btn small secondary",onClick:o}," Cancel ")]),s("p",fa,g(ye.value),1),s("div",va,[(u(!0),d(B,null,Y(_.value,(t,n)=>(u(),d("article",{key:"effect-"+t.id,class:V(["fullscreen-card",{"is-leader":n===R.value,"is-disabled":n===N.value?.sourceIndex}]),onClick:r=>i(n)},[n===R.value&&Z.value?(u(),d("div",ma," ðŸ‘‘ ")):C("",!0),s("div",ba,g(t.name||`Team ${n+1}`),1),s("div",ha,g(t.points),1)],10,pa))),128))])])])):C("",!0)])),(u(),xe($e,{to:"body"},[we(Ce,{name:"rain-pop"},{default:Me(()=>[I.value?(u(),d("div",ya,[...e[9]||(e[9]=[s("div",{class:"rain-label"}," ðŸŒ§ï¸ Rain of Points! ðŸŒˆ ",-1)])])):C("",!0)]),_:1})]))])):C("",!0)}}),ga=De(_a,[["__scopeId","data-v-4f7c7d59"]]),wa="/assets/spinning_sfx-B-LM3m4d.mp3",ka="/assets/mystery-machine-a5NpraJ-.mp3",Ta=["aria-expanded"],xa={class:"menu-row"},Ma={class:"menu-row"},Ca={class:"menu-row"},Sa={class:"menu-row"},$a={class:"mute-row"},Pa=["aria-pressed"],Aa={class:"label-cell row"},Ea=["onClick","onKeydown"],Ua={class:"face back"},Da=.35,Oe="random-points-settings",Ae=4,_e=6,Ia=150,Ra=110,Na=Ee({__name:"RandomPoints",setup(ke){const ae=v(!1),L=v(null),K=v(!1),P=v(null),T=v(!1),c=v(!0),m=v(!1),h=v(!0),E=v(!1);v(!1);const p=v(!1),I=Ae*_e,O=["A","B","C","D","E","F"],y=v(Array.from({length:I},(l,o)=>({id:o,value:0,display:"",revealed:!1}))),se=v(typeof window<"u"?window.innerHeight:800),z=v(typeof window<"u"?window.innerWidth:1280),A=Xe(),_=()=>A.back();function ne(){ae.value=!1}function D(){const l=L.value;if(!l||typeof l.getHeldPowersForSelected!="function")return[];const o=l.getHeldPowersForSelected();return Array.isArray(o)?o:[]}function w(l){const o=L.value,i=D(),f=i.some(t=>t.id==="t3_triple_next"),S=i.some(t=>t.id==="t2_double_next");let a=1;f?a=3:S&&(a=2);const e=l*a;if(a>1&&o&&typeof o.consumeHeldPower=="function"){const t=f?"t3_triple_next":"t2_double_next";o.consumeHeldPower(t)}return e}function le(l){if(!l||!l.effect||!K.value||!L.value)return;const o=L.value,i={id:l.effect.id,tier:l.effect.tier,label:l.effect.label,source:"mystery",wager:l.wager};typeof o.resolveImmediateMysteryEffect=="function"&&o.resolveImmediateMysteryEffect(i)||typeof o.addPrizeToSelected=="function"&&o.addPrizeToSelected(i)}function oe(l){if(!l||typeof l.pointsDelta!="number"||!K.value)return;const o=l.pointsDelta;o!==0&&L.value?.applyDeltaToSelected(o)}function j(l){K.value=!!l}const J=$(()=>{const l=z.value;return l<=360?22:l<=420?24:l<=520?26:l<=680?28:30}),R=$(()=>{const l=z.value;return l<=360?6:l<=420?7:l<=520?8:l<=680?9:10}),Z=$(()=>({"--labelW":`${J.value}px`,"--gap":`${R.value}px`})),de=$(()=>({height:`${Math.max(320,se.value-Ia-Ra)}px`,gridTemplateColumns:`var(--labelW) repeat(${_e}, 1fr)`,gridTemplateRows:`repeat(${Ae}, 1fr)`,gap:"var(--gap)"})),ee=$(()=>({gridTemplateColumns:`var(--labelW) repeat(${_e}, 1fr)`,gap:"var(--gap)"})),be=(l,o)=>(l-1)*_e+(o-1),U=(l,o)=>y.value[be(l,o)],q=l=>l==="Mystery Machine",G=l=>l==="Tornado";function X(l){return typeof l=="number"?l>0?"val-pos":l<0?"val-neg":"val-zero":l==="Mystery Machine"?"val-mystery val-text":l==="Tornado"?"val-tornado val-text":"val-text"}function H(l,o){return Math.floor(Math.random()*(o-l+1))+l}const F={positive:new Audio(ze),negative:new Audio(je),swap:new Audio(wa),loseAll:new Audio(Ve),jackpot:new Audio(Be),mystery:new Audio(ka)};function fe(){const l=p.value?0:Da;F.positive.volume=l,F.negative.volume=l,F.swap.volume=l,F.loseAll.volume=l,F.jackpot.volume=l,F.mystery.volume=l}function k(l){const o=F[l];try{o.currentTime=0,o.play()}catch{}}function te(){p.value=!p.value,fe(),pe()}function re(){const l=[],i=m.value?200:100;l.push(i);let f=I-l.length;if(h.value&&f>0){const t=H(2,4),n=Math.min(t,f);for(let r=0;r<n;r++)l.push("Mystery Machine");f=I-l.length}if(E.value&&f>0){const t=H(2,4),n=Math.min(t,f);for(let r=0;r<n;r++)l.push("Tornado");f=I-l.length}const S=I-l.length;let a=S,e=0;c.value&&(a=Math.floor(S*.7),e=S-a);for(let t=0;t<a;t++){const n=10*H(1,10),r=m.value?n*2:n;l.push(r)}for(let t=0;t<e;t++){const n=-10*H(1,5),r=m.value?n*2:n;l.push(r)}for(let t=l.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[l[t],l[n]]=[l[n],l[t]]}return l}function ie(){const l=re();for(let o=0;o<I;o++){const i=l[o],f=y.value[o];f.value=i,f.display=typeof i=="number"?String(i):i,f.revealed=!1}}function ue(l){if(!l||l.revealed)return;if(typeof l.value=="string")l.value==="Mystery Machine"?k("mystery"):l.value==="Tornado"?k("swap"):k("mystery");else{const a=m.value?200:100;l.value===a?k("jackpot"):l.value>0?k("positive"):k("negative")}if(l.revealed=!0,typeof l.value=="string"){if(l.value==="Tornado"){const S=L.value;S&&typeof S.shuffleAllTeamPoints=="function"?S.shuffleAllTeamPoints():console.warn("[RandomPoints] Tornado card revealed, but TeamPointsTracker.shuffleAllTeamPoints() not found.")}return}if(!K.value)return;const o=L.value;if(!o)return;const i=l.value,f=w(i);o.applyDeltaToSelected(f)}function he(){for(const l of y.value)l.revealed=!0}function ve(){ie()}function N(){T.value=!T.value}function pe(){localStorage.setItem(Oe,JSON.stringify({allowNegatives:c.value,doublePoints:m.value,allowSpecial:h.value,allowTornado:E.value,sfxMuted:p.value}))}function ye(){pe(),ie(),T.value=!1}function ce(){se.value=window.innerHeight,z.value=window.innerWidth}return We(()=>{try{const l=localStorage.getItem(Oe);if(l){const o=JSON.parse(l);typeof o.allowNegatives=="boolean"&&(c.value=o.allowNegatives),typeof o.doublePoints=="boolean"&&(m.value=o.doublePoints),typeof o.allowSpecial=="boolean"&&(h.value=o.allowSpecial),typeof o.allowTornado=="boolean"&&(E.value=o.allowTornado),typeof o.sfxMuted=="boolean"&&(p.value=o.sfxMuted)}}catch{}fe(),ie(),ce(),window.addEventListener("resize",ce,{passive:!0})}),Ue(()=>{window.removeEventListener("resize",ce)}),(l,o)=>(u(),d("section",{class:"random-points-page app-bg",style:ge(Z.value)},[we(ga,{ref_key:"teamTracker",ref:L,onTeamSelected:j},null,512),s("button",{class:"icon-btn back",type:"button",onClick:_,"aria-label":"Back",title:"Back"},[...o[7]||(o[7]=[s("img",{class:"icon",src:Qe,alt:""},null,-1)])]),s("button",{class:"icon-btn settings",type:"button",onClick:N,"aria-haspopup":"dialog","aria-expanded":T.value,"aria-controls":"settings-menu","aria-label":"Open settings",title:"Settings"},[...o[8]||(o[8]=[s("img",{class:"icon",src:Je,alt:""},null,-1)])],8,Ta),s("button",{class:"icon-btn mystery",type:"button",onClick:o[0]||(o[0]=i=>ae.value=!0),"aria-label":"Open Mystery Machine",title:"Mystery Machine"},[...o[9]||(o[9]=[s("img",{class:"icon",src:tt,alt:""},null,-1)])]),ae.value?(u(),xe(Dt,{key:0,maxWager:P.value,onClose:ne,onResolved:oe,onEffectOpened:le},null,8,["maxWager"])):C("",!0),T.value?(u(),d("div",{key:1,class:"settings-overlay",role:"presentation",onClick:o[6]||(o[6]=i=>T.value=!1)},[s("div",{id:"settings-menu",class:"settings-menu",role:"dialog","aria-modal":"true",onClick:o[5]||(o[5]=Q(()=>{},["stop"]))},[o[14]||(o[14]=s("h3",{class:"menu-title"},"Settings",-1)),s("label",xa,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=i=>c.value=i)},null,512),[[Te,c.value]]),o[10]||(o[10]=s("span",null,"Negative Numbers",-1))]),s("label",Ma,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=i=>m.value=i)},null,512),[[Te,m.value]]),o[11]||(o[11]=s("span",null,"Double Points",-1))]),s("label",Ca,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=i=>E.value=i)},null,512),[[Te,E.value]]),o[12]||(o[12]=s("span",null,"Tornado Cards",-1))]),s("label",Sa,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=i=>h.value=i)},null,512),[[Te,h.value]]),o[13]||(o[13]=s("span",null,"Mystery Machine Cards",-1))]),s("div",$a,[s("button",{class:"mute-btn","aria-pressed":p.value,onClick:te},g(p.value?"Unmute SFX":"Mute SFX"),9,Pa)]),s("button",{class:"apply",onClick:ye},"Apply")])])):C("",!0),o[17]||(o[17]=s("h1",{class:"title"},null,-1)),s("div",{class:"labels",style:ge(ee.value)},[o[15]||(o[15]=s("div",null,null,-1)),(u(),d(B,null,Y(O,i=>s("div",{key:i,class:"label-cell"},g(i),1)),64))],4),s("div",{class:"grid",style:ge(de.value)},[(u(),d(B,null,Y(Ae,i=>(u(),d(B,{key:`r-${i}`},[s("div",Aa,g(i),1),(u(),d(B,null,Y(_e,f=>s("div",{key:`c-${i}-${f}`,class:"grid-item"},[s("div",{class:V(["card",{"mystery-card":q(U(i,f).value),"mystery-card--revealed":q(U(i,f).value)&&U(i,f).revealed,"tornado-card":G(U(i,f).value),"tornado-card--revealed":G(U(i,f).value)&&U(i,f).revealed}]),role:"button",tabindex:"0",onClick:Q(S=>ue(U(i,f)),["stop"]),onKeydown:[Fe(Q(S=>ue(U(i,f)),["prevent"]),["enter"]),Fe(Q(S=>ue(U(i,f)),["prevent"]),["space"])]},[s("div",{class:V(["flip-inner",{revealed:U(i,f).revealed}])},[o[16]||(o[16]=s("div",{class:"face front"},null,-1)),s("div",Ua,[s("span",{class:V(["value",X(U(i,f).value)])},g(U(i,f).display),3)])],2)],42,Ea)])),64))],64))),64))],4),s("div",{class:"controls"},[s("button",{class:"big-btn",onClick:ve},"Reset"),s("button",{class:"big-btn",onClick:he},"See All")])],4))}}),ja=De(Na,[["__scopeId","data-v-46659d43"]]);export{ja as default};
