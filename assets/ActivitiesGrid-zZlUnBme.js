import{i as W,r as h,j as P,A as B,c as y,a as n,d as o,h as l,t as a,F as v,e as p,s as T,b as i,g as A,u as I,_ as R}from"./index-wh3CbFb4.js";const X={class:"page"},F={class:"head"},G={class:"left"},M={key:0,class:"count"},V={class:"content"},j={key:0,class:"muted"},D={key:1,class:"error"},H={key:2,class:"list-section"},K={key:0,class:"muted center"},O={key:1},q={key:0,class:"section-head"},J={class:"section-count"},Q={key:1,class:"tb-grid"},Y=["onClick"],Z={class:"corner-rail"},tt={key:0,class:"corner tl xp"},et={key:1,class:"corner tr new"},st={class:"cover"},nt=["src","alt","onError"],it={key:1,class:"cover-fallback"},ot={class:"cover-fallback-title"},rt={class:"tb-body"},lt={class:"tb-title"},at={key:0,class:"chip-row"},ct={key:2,class:"section-head tools-head"},ut={class:"section-count"},dt={key:3,class:"tb-grid"},_t=["onClick"],ht={class:"corner-rail"},vt={key:0,class:"corner tl xp"},pt={key:1,class:"corner tr new"},gt={class:"cover"},ft=["src","alt","onError"],mt={key:1,class:"cover-fallback"},yt={class:"cover-fallback-title"},kt={class:"tb-body"},bt={class:"tb-title"},wt={key:0,class:"chip-row"},St="public-assets",L="game-icons/",xt=W({__name:"ActivitiesGrid",setup(Et){const k=I(),g=h(!0),f=h(null),b=h([]),w=h(new Set);function m(e){return(e.tags||[]).map(t=>String(t).toLowerCase().trim())}function S(e){const t=m(e);return t.includes("teacher tool")||t.includes("teacher-tool")||t.includes("teachertool")}function x(e){const t=m(e);return t.includes("xp")||t.includes("gives_xp")||t.includes("givesxp")||t.includes("experience")}function E(e){const t=m(e);return e.status&&String(e.status).toLowerCase().trim()==="new"?!0:t.includes("new")||t.includes("recent")}P(async()=>{await B(async()=>{try{const{data:e,error:t}=await T.from("activities").select("id, slug, name, type, url_path, external_url, icon_url, thumbnail_url, tags, status, archived_at").is("archived_at",null).order("name",{ascending:!0});if(t)throw t;b.value=e||[]}catch(e){console.error(e),f.value=e?.message??String(e)}finally{g.value=!1}},250)});const c=y(()=>b.value.slice().sort((e,t)=>(e.name||"").localeCompare(t.name||""))),u=y(()=>c.value.filter(S)),d=y(()=>c.value.filter(e=>!S(e)));function N(e){return!!e&&/^[a-z][a-z0-9+\-.]*:\/\//i.test(String(e).trim())}function _(e){if(w.value.has(e.id))return"";const t=e.thumbnail_url||e.icon_url||"";if(!t)return"";if(N(t))return t;let s=String(t).replace(/^\/+/,"");s.startsWith(L)||(s=L+s);const{data:r}=T.storage.from(St).getPublicUrl(s);return r?.publicUrl||""}function z(e){w.value.add(e)}function U(e){if(!e)return"";let t=String(e).trim();if(!t)return"";if(/^[a-z][a-z0-9+\-.]*:\/\//i.test(t)||/^[a-z][a-z0-9+\-.]*:/i.test(t))return t;if(t.startsWith("//"))return(window.location?.protocol||"https:")+t;/^[\w.-]+\.[a-z]{2,}([/:?#]|$)/i.test(t)&&(t="https://"+t);try{const s=new URL(t,window.location.origin);return!/\.[a-z0-9]+$/i.test(s.pathname.split("/").pop()||"")&&!s.search&&!s.hash&&!s.pathname.endsWith("/")&&(s.pathname+="/"),s.toString()}catch{return t}}function $(e){if(!e)return"";let t=String(e).trim();return t?(t.startsWith("/")||(t="/"+t),t):""}function C(e){if(e.url_path){k.push($(e.url_path));return}if(e.slug){k.push(`/activities/${e.slug}`);return}if(e.external_url){const t=U(e.external_url);if(t){window.open(t,"_blank","noopener,noreferrer");return}}alert("No activity URL is configured.")}return(e,t)=>(i(),n("div",X,[o("header",F,[o("div",G,[t[0]||(t[0]=o("h1",{class:"title"},"Activities",-1)),g.value?l("",!0):(i(),n("span",M,"("+a(c.value.length)+")",1))])]),o("main",V,[g.value?(i(),n("p",j,"Loading activitiesâ€¦")):f.value?(i(),n("p",D,a(f.value),1)):(i(),n("section",H,[c.value.length===0?(i(),n("div",K," No activities found. ")):(i(),n("div",O,[d.value.length?(i(),n("div",q,[t[1]||(t[1]=o("h2",{class:"section-title"},"Games",-1)),o("span",J,"("+a(d.value.length)+")",1)])):l("",!0),d.value.length?(i(),n("div",Q,[(i(!0),n(v,null,p(d.value,s=>(i(),n("article",{key:s.id,class:"tb-card",onClick:r=>C(s)},[o("div",Z,[x(s)?(i(),n("div",tt,[...t[2]||(t[2]=[o("span",null,"XP",-1)])])):l("",!0),E(s)?(i(),n("div",et,[...t[3]||(t[3]=[o("span",null,"NEW",-1)])])):l("",!0)]),o("figure",st,[_(s)?(i(),n("img",{key:0,src:_(s),alt:s.name,loading:"lazy",decoding:"async",onError:A(r=>z(s.id),["stop"])},null,40,nt)):(i(),n("div",it,[o("span",ot,a(s.name),1)]))]),o("div",rt,[o("h3",lt,a(s.name),1),(s.tags||[]).length?(i(),n("div",at,[(i(!0),n(v,null,p(s.tags,r=>(i(),n("span",{key:String(r),class:"chip"},a(r),1))),128))])):l("",!0)])],8,Y))),128))])):l("",!0),u.value.length?(i(),n("div",ct,[t[4]||(t[4]=o("h2",{class:"section-title"},"Teacher Tools",-1)),o("span",ut,"("+a(u.value.length)+")",1)])):l("",!0),u.value.length?(i(),n("div",dt,[(i(!0),n(v,null,p(u.value,s=>(i(),n("article",{key:s.id,class:"tb-card",onClick:r=>C(s)},[o("div",ht,[x(s)?(i(),n("div",vt,[...t[5]||(t[5]=[o("span",null,"XP",-1)])])):l("",!0),E(s)?(i(),n("div",pt,[...t[6]||(t[6]=[o("span",null,"NEW",-1)])])):l("",!0)]),o("figure",gt,[_(s)?(i(),n("img",{key:0,src:_(s),alt:s.name,loading:"lazy",decoding:"async",onError:A(r=>z(s.id),["stop"])},null,40,ft)):(i(),n("div",mt,[o("span",yt,a(s.name),1)]))]),o("div",kt,[o("h3",bt,a(s.name),1),(s.tags||[]).length?(i(),n("div",wt,[(i(!0),n(v,null,p(s.tags,r=>(i(),n("span",{key:String(r),class:"chip"},a(r),1))),128))])):l("",!0)])],8,_t))),128))])):l("",!0)]))]))])]))}}),Ct=R(xt,[["__scopeId","data-v-0caab9d9"]]);export{Ct as default};
