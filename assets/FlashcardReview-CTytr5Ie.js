import{d as ce,r as o,c as y,o as de,k as V,g as ve,Q as fe,a as r,b as s,E as ge,e as v,B as x,$ as me,p as S,t as w,u as pe,A as he,f as c,s as f,_ as ke}from"./index-CYZ2aWoM.js";const we=["src"],Ce=["aria-expanded"],be=["src"],ye=["aria-hidden"],Se={key:0,class:"card-content"},Le={key:0,class:"image-container"},Ae=["src"],Re={key:1,class:"japanese-container"},Ee={id:"japanese-text"},Ue={id:"kanji"},Me={id:"furigana"},_e={key:1,class:"english-container"},Be={key:2,class:"finished-overlay"},Ie={key:2,class:"progress","aria-live":"polite"},xe=["src"],j="public-assets",je=ce({__name:"FlashcardReview",setup(qe){const M=he(),W=pe(),T=new URL("data:image/png;base64,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",import.meta.url).href,Z=new URL("/TaiyakiEduGames/assets/settings-icon-yUop-EjA.png",import.meta.url).href,O=new URL("/TaiyakiEduGames/assets/fanfare-C8oL-oxy.mp3",import.meta.url).href,q=o(null),g=o(!1),m=o(!0),p=o(!0),C=o(!1),z=o(2e3);let U=null;const h=o(""),L=o(null),_=o("review"),K=o(""),A=o([]),d=o(0),u=o(!1),l=o(!1),G=`${j}/`;function $(){g.value=!g.value}function J(){W.back()}function ee(a){return!!a&&/^https?:\/\//i.test(a)}function F(a){if(!a)return"";if(ee(a))return a;const e=a.replace(/^\/+/,"").match(/^storage\/v1\/object\/public\/([^/]+)\/(.+)$/i);if(e){const[,i,t]=e,{data:E}=f.storage.from(i).getPublicUrl(t);return E?.publicUrl??""}if(a.startsWith(G)){const i=a.slice(G.length),{data:t}=f.storage.from(j).getPublicUrl(i);return t?.publicUrl??""}const{data:n}=f.storage.from(j).getPublicUrl(a);return n?.publicUrl??""}function ae(a){const e=a.ids??a.cardIds??null;return e?Array.isArray(e)?e.map(String):typeof e=="string"?e.split(",").map(n=>n.trim()).filter(Boolean):null:null}function te(a){const e=String(a.mode||"").toLowerCase();return e==="random"?"random":e==="japanese"?"japanese":"review"}function H(){const a=M.params,e=M.query;h.value=a.id??a.deckId??e.id??"",L.value=ae(e),_.value=te(e)}H();const k=y(()=>A.value.length),R=y(()=>A.value[d.value]??null),ne=y(()=>R.value?.image_url?R.value.image_url:""),ie=y(()=>k.value?`${d.value+1} / ${k.value}`:""),se=y(()=>({"image-hidden":!p.value,"japanese-hidden":!m.value})),le=y(()=>({"image-hidden":!p.value,"japanese-hidden":!m.value}));function Y(a){const e=a.slice();for(let n=e.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[e[n],e[i]]=[e[i],e[n]]}return e}function B(){U&&(window.clearTimeout(U),U=null)}function b(){B(),!(!C.value||l.value||k.value===0)&&(U=window.setTimeout(()=>{!C.value||l.value||(u.value?(Q(),l.value||b()):(u.value=!0,b()))},z.value))}function oe(){C.value=!C.value,b()}function I(){!k.value||l.value||(u.value?Q():u.value=!0,b())}function P(){!k.value||l.value||(d.value>0&&(d.value-=1,u.value=!1),b())}function Q(){!k.value||l.value||(d.value<k.value-1?(d.value+=1,u.value=!1):(u.value=!0,l.value=!0,B(),q.value?.play().catch(()=>{}),setTimeout(()=>J(),2e3)))}async function ue(){const{data:a}=await f.from("decks").select("id, title, slug").eq("id",h.value).maybeSingle();K.value=a?.title||a?.slug||"Flashcards";const{data:e,error:n}=await f.from("v_deck_cards_expanded").select(`
      deck_id,
      card_id,
      position,
      english,
      japanese_kanji,
      japanese_furigana,
      image_url
    `).eq("deck_id",h.value).order("position",{ascending:!0});if(n)throw n;let i=(e??[]).map(t=>({id:t.card_id,english:t.english||"",japanese:{kanji:t.japanese_kanji||void 0,furigana:t.japanese_furigana||void 0},image_url:F(t.image_url||"")}));if(L.value?.length){const t=new Set(L.value);i=i.filter(E=>t.has(E.id))}return _.value==="random"&&(i=Y(i)),i}async function re(){const{data:a}=await f.from("custom_decks").select("id, title").eq("id",h.value).maybeSingle();a?.title&&(K.value=a.title);let{data:e,error:n}=await f.from("v_custom_deck_cards_expanded").select(`
      deck_id,
      card_id,
      position,
      english,
      japanese_kanji,
      japanese_furigana,
      image_url
    `).eq("deck_id",h.value).order("position",{ascending:!0});if(!n&&(!e||e.length===0)){const t=await f.from("v_custom_deck_cards_expanded").select(`
        deck_id:custom_deck_id,
        card_id,
        position,
        english,
        japanese_kanji,
        japanese_furigana,
        image_url
      `).eq("custom_deck_id",h.value).order("position",{ascending:!0});t.error?n=t.error:e=t.data??[]}if(n)throw n;let i=(e??[]).map(t=>({id:t.card_id,english:t.english||"",japanese:{kanji:t.japanese_kanji||void 0,furigana:t.japanese_furigana||void 0},image_url:F(t.image_url||"")}));if(L.value?.length){const t=new Set(L.value);i=i.filter(E=>t.has(E.id))}return _.value==="random"&&(i=Y(i)),i}async function X(){if(l.value=!1,u.value=!1,d.value=0,!h.value)throw new Error("Missing deck id in route.");let a=[];try{a=await ue()}catch{}if(a.length)A.value=a;else try{A.value=await re()}catch{A.value=[]}d.value=0,u.value=!1,b()}de(async()=>{document.addEventListener("click",D,{capture:!0}),document.addEventListener("keydown",N),await V(async()=>{await X()},150)}),ve(()=>{B(),document.removeEventListener("click",D,{capture:!0}),document.removeEventListener("keydown",N)}),fe(()=>M.fullPath,async()=>{H(),await V(async()=>{await X()},150)});function D(a){const e=a.target;g.value&&!e.closest(".settings-menu")&&!e.closest(".settings-button")&&(g.value=!1)}function N(a){if(l.value)return;const e=a.key.toLowerCase();e==="arrowright"||e==="d"||a.key===" "?(a.preventDefault(),I()):(e==="arrowleft"||e==="a"||e==="backspace")&&(a.preventDefault(),P())}return(a,e)=>(c(),r("section",{class:S(["flashcards-page",se.value])},[s("button",{class:"home-button",type:"button",onClick:J,"aria-label":"Back"},[s("img",{src:x(T),alt:"Back"},null,8,we)]),s("button",{class:"settings-button",type:"button",onClick:$,"aria-haspopup":"dialog","aria-expanded":g.value},[s("img",{src:x(Z),alt:"Settings"},null,8,be)],8,Ce),ge(s("div",{id:"settings-menu",class:"settings-menu",role:"dialog","aria-modal":!1,"aria-hidden":!g.value},[s("button",{id:"toggle-japanese-btn",class:S(["toggle-btn",{off:!m.value}]),type:"button",onClick:e[0]||(e[0]=n=>m.value=!m.value)},w(m.value?"Hide Japanese":"Show Japanese"),3),s("button",{id:"toggle-image-btn",class:S(["toggle-btn",{off:!p.value}]),type:"button",onClick:e[1]||(e[1]=n=>p.value=!p.value)},w(p.value?"Hide Image":"Show Image"),3),s("button",{id:"auto-mode-btn",type:"button",class:S({on:C.value}),onClick:oe}," Auto Mode: "+w(C.value?"ON":"OFF"),3)],8,ye),[[me,g.value]]),l.value?v("",!0):(c(),r("div",{key:0,id:"left-screen",class:"screen-half",onClick:P,"aria-hidden":"true"})),l.value?v("",!0):(c(),r("div",{key:1,id:"right-screen",class:"screen-half",onClick:I,"aria-hidden":"true"})),s("div",{id:"flashcard",class:S(["flashcard-container fade",le.value]),onClick:I},[l.value?v("",!0):(c(),r("div",Se,[p.value?(c(),r("div",Le,[s("img",{id:"card-image",src:ne.value,alt:""},null,8,Ae)])):v("",!0),m.value?(c(),r("div",Re,[s("ruby",Ee,[s("span",Ue,w(R.value?.japanese?.kanji||""),1),s("rt",Me,w(R.value?.japanese?.furigana||""),1)])])):v("",!0)])),l.value?v("",!0):(c(),r("div",_e,[s("div",{class:S(["english",{hidden:!u.value}]),id:"english-text"},w(R.value?.english||""),3)])),l.value?(c(),r("div",Be,[...e[2]||(e[2]=[s("div",{class:"finished-card"},[s("h2",null,"Good Job!"),s("p",null,"Heading backâ€¦")],-1)])])):v("",!0)],2),l.value?v("",!0):(c(),r("div",Ie,w(ie.value),1)),s("audio",{ref_key:"finishAudioRef",ref:q,src:x(O),preload:"auto"},null,8,xe)],2))}}),Ge=ke(je,[["__scopeId","data-v-c7c3333c"]]);export{Ge as default};
