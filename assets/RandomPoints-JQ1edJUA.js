import{i as Ae,r as p,c as $,o as Ue,a as d,g as K,d as s,h as x,f as j,t as g,k as we,v as Ce,T as xe,F as z,e as V,p as Ne,E as qe,b as u,n as ge,_ as Ie,N as Xe,w as De,j as We,C as Me,H as $e,G as Ee,x as me,y as Re,u as Je,B as Te,O as Fe}from"./index-wh3CbFb4.js";import{b as Ke}from"./back-icon-xKqy7r3s.js";import{s as Ze}from"./settings-icon-DJLQOoae.js";import{h as Qe,w as Le}from"./shokichi-KW1WytDh.js";const et="/TaiyakiEduGames/assets/mystery-machine-icon-DFeu74Q1.png",tt="/TaiyakiEduGames/assets/mystery-machine-body-D8HKPlGZ.png",at="/TaiyakiEduGames/assets/slot-arm-christmas-42_i7_I_.png",st="/TaiyakiEduGames/assets/slot-machine-DpezDdAa.mp3",ze="/TaiyakiEduGames/assets/daikichi-C_c_FTXQ.mp3",je="/TaiyakiEduGames/assets/daikyo-CY7yqnN5.mp3",nt="/TaiyakiEduGames/assets/kichi--kgZ_B-c.mp3",He="/TaiyakiEduGames/assets/kyo-B7Jx3MGi.mp3",lt={class:"mm-stage"},ot={class:"mm-machine"},it={class:"mm-stack"},rt={class:"mm-top-panel"},ut={class:"wager-section"},ct={class:"wager-inner"},dt={class:"wager-header"},vt={class:"wager-controls"},pt=["disabled"],ft={class:"wager-value-block"},mt={class:"wager-amount"},yt=["disabled"],ht={class:"mm-toast-panel"},_t={key:"toast",class:"mm-toast"},bt={class:"mm-toast-text"},gt={class:"reels-layer"},wt={class:"slot-frame"},kt={class:"reel-symbol"},Tt=["src"],Mt=["disabled","aria-disabled"],Ct=["src"],xt={key:0,class:"effect-modal"},St={class:"effect-header"},$t={class:"effect-title"},Et={class:"effect-body"},Pt={class:"effect-description"},At=48,Oe=3500,Ut=Ae({__name:"MysteryMachine",props:{maxWager:{}},emits:["close","resolved","effect-opened"],setup(ke,{emit:ae}){const O=tt,Y=at;let E=null;const T=new Map;typeof window<"u"&&typeof Audio<"u"&&(E=new Audio(st),T.set("return",Qe),T.set("quadruple",ze),T.set("lose_all",je),T.set("double",nt),T.set("lose_half",He),T.set("triple",Le));function c(){if(E)try{E.currentTime=0,E.play().catch(()=>{})}catch{}}function m(e){const t=T.get(e);if(t)try{const n=new Audio(t);n.currentTime=0,n.play().catch(()=>{})}catch{}}const h=ke,A=ae,f=p(10),N=["ðŸ’£","âš–ï¸","â­•","âœ¨","ðŸ†","7ï¸âƒ£"],B={lose_all:"ðŸ’£",lose_half:"â­•",return:"âš–ï¸",double:"âœ¨",triple:"ðŸ†",quadruple:"7ï¸âƒ£"},_=360/N.length,se=[2300,2900,3400],L=p([0,0,0]),P=p(!1),b=p(!1),ne=p(!1),I=p(null),w=p(null),le=p(0),oe=p(null),H=p(!1),Z=p(!1),D=p(!1),Q=p(""),de=[{id:"t1_tip_jar",tier:1,label:"+20 points"},{id:"t1_party_favor",tier:1,label:"+10 points to every team"},{id:"t1_donation",tier:1,label:"+20 points to the lowest team"},{id:"t1_nothing",tier:1,label:"Nothing happens"}],ee=[{id:"t2_double_next",tier:2,label:"2x next card"},{id:"t2_steal40_one",tier:2,label:"Steal 40 points from one team"},{id:"t2_give40_one",tier:2,label:"+40 points to one team"}],ye=[{id:"t3_triple_next",tier:3,label:"3x next card"},{id:"t3_steal20_each",tier:3,label:"Steal 20 points from each team"},{id:"t3_swap_any_team",tier:3,label:"Swap total points with another team"},{id:"t3_rain_of_points",tier:3,label:"Rain of points: +80 for you, +40 for all other teams"}],U={t1_tip_jar:"Your team gains +20 points.",t1_party_favor:"Every team gains +10 points.",t1_donation:"The team with the lowest score gains +20 points.",t1_nothing:"Nothing happens this time.",t2_double_next:"Your next card is doubled.",t2_steal40_one:"Steal 40 points from anohter team.",t2_give40_one:"Plus 40 points to another team.",t3_triple_next:"Your next card is tripled!",t3_steal20_each:"Steal 20 points from ALL other teams.",t3_swap_any_team:"Swap your total score with any team.",t3_rain_of_points:"You gain +80 points, every other team gains +40 points."},q=[{type:"lose_all",weight:22},{type:"lose_half",weight:18},{type:"return",weight:25},{type:"double",weight:18},{type:"triple",weight:10},{type:"quadruple",weight:7}],X=[],J=$(()=>!(P.value||f.value<10||f.value%10!==0||h.maxWager!=null&&f.value>h.maxWager)),G=$(()=>!!w.value&&!!I.value&&!P.value),F=$(()=>ie(f.value)),ve=$(()=>w.value?U[w.value.id]??w.value.label:"");function k(e){switch(e){case"lose_all":return"Lose all wager";case"lose_half":return"Lose half wager";case"return":return"No change (return wager)";case"double":return"Double wager";case"triple":return"Triple wager";case"quadruple":return"Quadruple wager"}}$(()=>{const e=q.reduce((t,n)=>t+n.weight,0);return q.map(({type:t,weight:n})=>{const i=n/e*100;return{type:t,name:k(t),percent:i.toFixed(1)}})});function te(){f.value<0&&(f.value=0),h.maxWager!=null&&f.value>h.maxWager&&(f.value=h.maxWager),f.value%10!==0&&(f.value=Math.round(f.value/10)*10)}function ie(e){return e>=100?3:e>=50?2:1}function re(e){let t=[];e>=1&&(t=t.concat(de)),e>=2&&(t=t.concat(ee)),e>=3&&(t=t.concat(ye));const n=Math.floor(Math.random()*t.length);return t[n]}function ue(){const e=q.reduce((i,M)=>i+M.weight,0),t=Math.random()*e;let n=0;for(const i of q)if(n+=i.weight,t<=n)return i.type;return"return"}function he(e,t){let n="",i=0;switch(e){case"lose_all":n="You lost your entire wager",i=-t;break;case"lose_half":n="You lost half your wager",i=-Math.round(t/2);break;case"return":n="Your wager was returned (no change)",i=0;break;case"double":n="Your wager was doubled",i=t;break;case"triple":n="Your wager was tripled",i=2*t;break;case"quadruple":n="Your wager was quadrupled",i=3*t;break}return{outcome:{type:e,label:n},delta:i}}function pe(e){const n=`rotateX(${L.value[e]}deg)`;if(b.value)return{transform:n,transition:"transform 0s"};if(P.value){const i=se[e]??Oe;return{transform:n,transition:`transform ${i}ms cubic-bezier(.2,.8,.3,1.1)`}}return{transform:n,transition:"transform 0s"}}function R(e){return{transform:`rotateX(${e*_}deg) translateZ(${At}px)`}}function fe(e,t){const n=e===0?"0 points":`${e>0?"+":""}${e} points`;Q.value=n,D.value=!0,m(t)}function _e(){D.value=!1}function ce(){if(!J.value)return;te(),I.value=null,w.value=null,le.value=0,oe.value=null,H.value=!1,D.value=!1;const e=ue(),{outcome:t,delta:n}=he(e,f.value),i=ie(f.value),M=re(i),W=B[e],y=N.indexOf(W),C=y>=0?y:0;P.value=!1,b.value=!0,L.value=[0,0,0];try{document.body.offsetHeight}catch{}window.requestAnimationFrame(()=>{b.value=!1,P.value=!0;const Ge=3;L.value=L.value.map((Se,Ye)=>-((Ge+Ye)*360+C*_));const Ve=window.setTimeout(()=>{I.value=t,w.value=M,le.value=n,P.value=!1;const Se={wager:f.value,wagerOutcome:t,pointsDelta:n,tier:i,effect:M};oe.value=Se,A("resolved",Se),fe(n,t.type)},Oe);X.push(Ve)})}function l(){if(!J.value||P.value)return;ne.value=!0,c();const e=window.setTimeout(()=>{ne.value=!1},350);X.push(e),ce()}function o(e){P.value||(f.value+=e,f.value<0&&(f.value=0),te())}function r(){if(!G.value||!w.value||!I.value)return;H.value=!0;const e=oe.value??{wager:f.value,wagerOutcome:I.value,pointsDelta:le.value,tier:ie(f.value),effect:w.value};console.log("[MysteryMachine] effect-opened",e.effect.id,e),A("effect-opened",e)}function v(){H.value=!1}function S(){A("close")}function a(){S()}return Ue(()=>{X.forEach(e=>clearTimeout(e))}),(e,t)=>(u(),d("section",{class:"mystery-machine-overlay",role:"dialog","aria-modal":"true",onClick:K(a,["self"])},[s("button",{class:"overlay-prizes-btn",type:"button",onClick:t[0]||(t[0]=n=>Z.value=!0),"aria-label":"View prize tiers"}," â“ "),s("button",{class:"overlay-close-btn",type:"button",onClick:S,"aria-label":"Close Mystery Machine"}," âœ• "),s("div",lt,[s("section",ot,[s("div",it,[s("div",rt,[s("section",ut,[s("div",ct,[s("div",dt,[t[4]||(t[4]=s("span",{class:"wager-label"},"Wager",-1)),s("span",{class:j(["wager-tier-pill",`tier-${F.value}`])}," Tier "+g(F.value),3)]),s("div",vt,[s("button",{type:"button",class:"arrow-btn",onClick:t[1]||(t[1]=n=>o(-10)),disabled:P.value||f.value<=0,"aria-label":"Decrease wager"}," â—€ ",8,pt),s("div",ft,[s("span",mt,g(f.value)+" pts ",1)]),s("button",{type:"button",class:"arrow-btn",onClick:t[2]||(t[2]=n=>o(10)),disabled:P.value||e.maxWager!=null&&f.value>=e.maxWager,"aria-label":"Increase wager"}," â–¶ ",8,yt)])])])]),s("div",ht,[we(xe,{name:"mm-toast-slide"},{default:Ce(()=>[D.value?(u(),d("div",_t,[s("span",bt,g(Q.value),1),s("button",{class:"mm-toast-close",type:"button",onClick:_e,"aria-label":"Dismiss message"}," âœ• ")])):x("",!0)]),_:1})]),s("div",gt,[s("div",wt,[(u(!0),d(z,null,V(L.value,(n,i)=>(u(),d("div",{key:i,class:"reel3d"},[s("div",{class:"reel3d-inner",style:ge(pe(i))},[(u(),d(z,null,V(N,(M,W)=>s("div",{key:W,class:"reel-face",style:ge(R(W))},[s("span",kt,g(M),1)],4)),64))],4)]))),128))])]),s("img",{src:Ne(O),alt:"Mystery Machine body",class:"machine-body-img",draggable:"false"},null,8,Tt),G.value&&!H.value?(u(),d("button",{key:0,class:j(["prize-btn",{"has-prize":G.value}]),type:"button",onClick:r},[...t[5]||(t[5]=[s("span",{class:"prize-label"},"ðŸŽ Mystery Prize",-1)])],2)):x("",!0),s("button",{class:"slot-arm-btn",type:"button",disabled:!J.value||P.value,onClick:l,"aria-disabled":!J.value||P.value},[s("img",{src:Ne(Y),alt:"Pull to spin",class:j(["slot-arm-img",{"is-disabled":!J.value||P.value,"is-pulled":ne.value}]),draggable:"false"},null,10,Ct)],8,Mt)])])]),H.value&&w.value?(u(),d("div",{key:0,class:"effect-modal-overlay",onClick:K(v,["self"])},[we(xe,{name:"mm-card-pop"},{default:Ce(()=>[H.value?(u(),d("div",xt,[s("div",St,[s("h3",$t,g(w.value.label),1),s("span",{class:j(["effect-tier-chip",`tier-${w.value.tier}`])}," Tier "+g(w.value.tier),3)]),s("div",Et,[s("p",Pt,g(ve.value),1)]),s("div",{class:"effect-actions"},[s("button",{class:"pill-btn primary",type:"button",onClick:v}," Close ")])])):x("",!0)]),_:1})])):x("",!0),Z.value?(u(),d("div",{key:1,class:"effect-modal-overlay",onClick:t[3]||(t[3]=K(n=>Z.value=!1,["self"]))},[...t[6]||(t[6]=[qe('<div class="effect-modal info-modal" data-v-425168c6><h3 class="effect-title" data-v-425168c6>Mystery Machine: Outcomes &amp; Prizes</h3><div class="prize-grid" data-v-425168c6><section class="prize-col" data-v-425168c6><h4 class="prize-heading" data-v-425168c6>Wager Outcomes</h4><div class="outcome-grid" data-v-425168c6><div class="outcome-card outcome-bad-1" data-v-425168c6><span class="outcome-label" data-v-425168c6>Lose all</span><span class="outcome-pct" data-v-425168c6>~22%</span></div><div class="outcome-card outcome-bad-2" data-v-425168c6><span class="outcome-label" data-v-425168c6>Lose half</span><span class="outcome-pct" data-v-425168c6>~18%</span></div><div class="outcome-card outcome-neutral" data-v-425168c6><span class="outcome-label" data-v-425168c6>No change</span><span class="outcome-pct" data-v-425168c6>~25%</span></div><div class="outcome-card outcome-good" data-v-425168c6><span class="outcome-label" data-v-425168c6>2Ã—</span><span class="outcome-pct" data-v-425168c6>~18%</span></div><div class="outcome-card outcome-good" data-v-425168c6><span class="outcome-label" data-v-425168c6>3Ã—</span><span class="outcome-pct" data-v-425168c6>~10%</span></div><div class="outcome-card outcome-good" data-v-425168c6><span class="outcome-label" data-v-425168c6>4Ã—</span><span class="outcome-pct" data-v-425168c6>~7%</span></div></div></section><section class="prize-col" data-v-425168c6><h4 class="prize-heading" data-v-425168c6>Prize Cards by Tier</h4><div class="tier-grid" data-v-425168c6><article class="tier-card tier-1" data-v-425168c6><header class="tier-header" data-v-425168c6><span class="tier-title" data-v-425168c6>Tier 1: 10+ points</span></header><ul class="tier-list" data-v-425168c6><li data-v-425168c6>+20 points</li><li data-v-425168c6>+10 to every team</li><li data-v-425168c6>+20 to the lowest team</li><li data-v-425168c6>Nothing happens</li></ul></article><article class="tier-card tier-2" data-v-425168c6><header class="tier-header" data-v-425168c6><span class="tier-title" data-v-425168c6>Tier 2: 50+ points</span></header><ul class="tier-list" data-v-425168c6><li data-v-425168c6>Double next card (x2)</li><li data-v-425168c6>Steal 40 from one team</li><li data-v-425168c6>+40 to one team</li></ul></article><article class="tier-card tier-3" data-v-425168c6><header class="tier-header" data-v-425168c6><span class="tier-title" data-v-425168c6>Tier 3: 100+ points</span></header><ul class="tier-list" data-v-425168c6><li data-v-425168c6>Triple next card (x3)</li><li data-v-425168c6>Steal 20 from each team</li><li data-v-425168c6>Swap scores with any team</li><li data-v-425168c6>Rain of Points (+80 you, +40 others)</li></ul></article></div></section></div><p class="prize-disclaimer" data-v-425168c6> All prizes are applied automatically. There is no need to manually edit team points to apply prize effects. </p></div>',1)])])):x("",!0)]))}}),It=Ie(Ut,[["__scopeId","data-v-425168c6"]]),Nt={key:0,class:"team-points-tracker"},Dt={key:0,class:"tracker-shell"},Rt={class:"tracker-row"},Ft={class:"left-stack"},Ot=["disabled"],Bt=["aria-pressed","title"],Wt={class:"tabs-row"},Lt=["onClick"],zt={class:"tab-inner"},jt={class:"team-name"},Ht={class:"team-points"},Gt={key:0,class:"team-powerups"},Vt={key:0,class:"leader-crown","aria-label":"Current leader",role:"img"},Yt={class:"team-controls"},qt=["disabled"],Xt=["disabled"],Jt={class:"edit-field"},Kt={class:"edit-field"},Zt={key:0,class:"edit-field powerups-field"},Qt={class:"edit-powerups-list"},ea=["onClick"],ta={class:"chip-label"},aa={class:"edit-actions"},sa=["disabled"],na={class:"fullscreen-modal"},la={class:"fullscreen-grid"},oa={key:0,class:"fullscreen-crown","aria-label":"Current leader",role:"img"},ia={class:"fullscreen-name"},ra={class:"fullscreen-points"},ua={class:"fullscreen-modal"},ca={class:"fullscreen-header"},da={class:"fullscreen-title"},va={class:"fullscreen-subtitle"},pa={class:"fullscreen-grid"},fa=["onClick"],ma={key:0,class:"fullscreen-crown","aria-label":"Current leader",role:"img"},ya={class:"fullscreen-name"},ha={class:"fullscreen-points"},_a={key:0,class:"rain-overlay"},ba=Ae({__name:"TeamPointsTracker",props:{teams:{},maxTeams:{}},emits:["update:teams","team-selected"],setup(ke,{expose:ae,emit:O}){const Y=ke,E=O,T=$(()=>{const a=Y.maxTeams??8;return Math.min(Math.max(a,1),8)}),c=p([]),m=p(-1),h=p(!1),A=p(!1),f=p(!0),N=p(!1),B=p([]),_=Xe({name:"",points:0,powerUps:[]}),se=p(null),L=new Set(["t1_tip_jar","t1_party_favor","t1_donation","t1_nothing","t2_steal40_one","t2_give40_one","t3_swap_any_team","t3_rain_of_points","t3_steal20_each"]);function P(a){return L.has(a)}De(()=>Y.teams,a=>{if(Array.isArray(a)&&a.length>0)c.value=a.slice(0,T.value).map((e,t)=>({id:e.id??t,name:e.name??`Team ${t+1}`,points:Number.isFinite(e.points)?e.points:0,powerUps:Array.isArray(e.powerUps)?[...e.powerUps]:[]}));else if(!c.value.length){const e=Math.min(4,T.value);c.value=Array.from({length:e}).map((t,n)=>({id:n,name:`Team ${n+1}`,points:0,powerUps:[]}))}},{immediate:!0,deep:!0});const b=$(()=>c.value.slice(0,T.value));De(()=>b.value.length,a=>{B.value=Array(a).fill(!1)},{immediate:!0});function ne(){const a=b.value.length;B.value.length!==a&&(B.value=Array(a).fill(!1))}function I(a){return a<0||a>=c.value.length?null:c.value[a]}function w(a,e){const t=[...c.value];t[a]=e,c.value=t,E("update:teams",t)}function le(a){m.value===a?(m.value=-1,h.value=!1,E("team-selected",null)):(m.value=a,h.value=!1,E("team-selected",b.value[a]??null))}function oe(){const a=m.value;if(!(a<0||a>=b.value.length)&&(h.value=!h.value,h.value)){const e=b.value[a];_.name=e.name,_.points=e.points,_.powerUps=Array.isArray(e.powerUps)?[...e.powerUps]:[]}}function H(){if(m.value<0||m.value>=b.value.length)return;const a=m.value,e=[...c.value],t=Number.isFinite(_.points)?Math.round(_.points):0,n=e[a];e[a]={...n,name:_.name.trim()||`Team ${a+1}`,points:t,powerUps:[..._.powerUps]},c.value=e,E("update:teams",e),h.value=!1}function Z(a){if(!h.value)return;const e=se.value;if(!e)return;const t=a.target;t&&(e.contains(t)||(h.value=!1))}const D=$(()=>{const a=b.value;if(!a.length)return-1;let e=-1/0,t=-1;return a.forEach((n,i)=>{n.points>e&&(e=n.points,t=i)}),e<=0?-1:t}),Q=$(()=>D.value!==-1),de=$(()=>c.value.length<T.value),ee=$(()=>c.value.length>1);function ye(){if(!de.value)return;const a=[...c.value],e=a.length,n={id:(a.length>0?Math.max(...a.map(i=>i.id)):-1)+1,name:`Team ${e+1}`,points:0,powerUps:[]};a.push(n),c.value=a,m.value=e,h.value=!1,E("update:teams",a),E("team-selected",n)}function U(){if(!ee.value)return;const a=m.value;a<0||X(a)}function q(){ee.value&&(m.value<0||m.value>=b.value.length||X(m.value))}function X(a){const e=[...c.value];if(a<0||a>=e.length)return;e.splice(a,1);const t=Math.min(a,e.length-1);m.value=e.length?Math.max(t,0):-1,h.value=!1,c.value=e,E("update:teams",e),E("team-selected",e[m.value]??null)}function J(a){a<0||a>=_.powerUps.length||_.powerUps.splice(a,1)}function G(){A.value=!A.value}function F(){A.value=!1}function ve(a){if(!b.value.length||!Number.isFinite(a))return;const e=m.value;if(e<0||e>=b.value.length)return;const t=I(e);if(!t)return;const n=Math.round(a),i={...t,points:(t.points??0)+n,powerUps:t.powerUps??[]};w(e,i)}function k(a,e){if(a<0||a>=c.value.length||!Number.isFinite(e))return;const t=I(a);if(!t)return;const n={...t,points:t.points+Math.round(e),powerUps:t.powerUps??[]};w(a,n)}function te(a,e){if(a<0||a>=c.value.length)return;const t=I(a);if(!t)return;const n={...t,points:Math.round(e),powerUps:t.powerUps??[]};w(a,n)}function ie(a,e,t,n,i){if(a<0||a>=c.value.length)return;const M=I(a);if(!M)return;const y=[...M.powerUps??[],{id:e,tier:t,label:n,scope:i}],C={...M,powerUps:y};w(a,C)}function re(a){if(P(a.id))return;const e=m.value;e<0||e>=b.value.length||ie(e,a.id,a.tier,a.label,"round")}function ue(){const a=m.value;if(a<0||a>=c.value.length)return[];const e=c.value[a];return Array.isArray(e.powerUps)?[...e.powerUps]:[]}function he(a){const e=m.value;if(e<0||e>=c.value.length)return;const t=I(e);if(!t)return;const n=Array.isArray(t.powerUps)?[...t.powerUps]:[],i=n.findIndex(W=>W.id===a);if(i===-1)return;n.splice(i,1);const M={...t,powerUps:n};w(e,M)}function pe(){const a=c.value.map(e=>({...e,powerUps:[]}));c.value=a,E("update:teams",a)}const R=p(null),fe=$(()=>{const a=R.value;if(!a)return"";switch(a.mode){case"steal40_one":return"Steal 40 points";case"give40_one":return"Give 40 points";case"swap_any_team":return"Swap scores with a team"}}),_e=$(()=>{const a=R.value;if(!a)return"";switch(a.mode){case"steal40_one":return"Click a team to steal 40 points from them.";case"give40_one":return"Click a team to give them 40 points.";case"swap_any_team":return"Click a team to swap total scores with them."}});function ce(a){const e=c.value;e.length&&(N.value=!0,window.setTimeout(()=>{e.forEach((t,n)=>{n===a?k(n,80):k(n,40)}),N.value=!1},900))}function l(a){const e=m.value;if(e<0||e>=b.value.length)return!1;switch(a.id){case"t1_tip_jar":return k(e,20),!0;case"t1_party_favor":return c.value.forEach((t,n)=>k(n,10)),!0;case"t1_donation":{let t=-1,n=1/0;return c.value.forEach((i,M)=>{i.points<n&&(n=i.points,t=M)}),t!==-1&&k(t,20),!0}case"t1_nothing":return!0;case"t2_steal40_one":return R.value={mode:"steal40_one",prize:a,sourceIndex:e},!0;case"t2_give40_one":return R.value={mode:"give40_one",prize:a,sourceIndex:e},!0;case"t3_swap_any_team":return R.value={mode:"swap_any_team",prize:a,sourceIndex:e},!0;case"t3_rain_of_points":return ce(e),!0;case"t3_steal20_each":{let t=0;return c.value.forEach((n,i)=>{i!==e&&(k(i,-20),t+=20)}),t&&k(e,t),!0}default:return!1}}function o(){R.value=null}function r(a){const e=R.value;if(!e)return;const t=e.sourceIndex;if(!(a<0||a>=c.value.length)&&a!==t){switch(e.mode){case"steal40_one":k(a,-40),k(t,40);break;case"give40_one":k(a,40);break;case"swap_any_team":{const n=I(t),i=I(a);if(!n||!i)break;const M=n.points,W=i.points;te(t,W),te(a,M);break}}R.value=null}}function v(a,e){switch(a){case"t2_double_next":return"x2";case"t3_triple_next":return"x3";case"t1_tip_jar":return"Tip +20";case"t1_party_favor":return"+10 all";case"t1_donation":return"Donate +20";case"t1_nothing":return"No bonus";default:return e}}async function S(){const a=[...c.value],e=a.length;if(e<=1)return;const t=a.map(y=>y.points),n=Array.from({length:e},(y,C)=>C);for(let y=e-1;y>0;y--){const C=Math.floor(Math.random()*y);[n[y],n[C]]=[n[C],n[y]]}const i=n.map(y=>t[y]);if(i.some((y,C)=>y===t[C])){const y=t.slice(1).concat(t[0]);for(let C=0;C<e;C++)i[C]=y[C]}ne(),B.value=B.value.map(()=>!0),await new Promise(y=>setTimeout(y,260));const W=a.map((y,C)=>({...y,points:i[C]}));c.value=W,E("update:teams",W);for(let y=0;y<e;y++)B.value[y]=!1,B.value=[...B.value],await new Promise(C=>setTimeout(C,140))}return ae({addPoints:k,setPoints:te,applyDeltaToSelected:ve,addPrizeToSelected:re,getHeldPowersForSelected:ue,consumeHeldPower:he,clearRoundPowerUps:pe,resolveImmediateMysteryEffect:l,shuffleAllTeamPoints:S}),We(()=>{window.addEventListener("pointerdown",Z,{capture:!0})}),Ue(()=>{window.removeEventListener("pointerdown",Z,{capture:!0})}),(a,e)=>b.value.length?(u(),d("section",Nt,[f.value?(u(),d("button",{key:0,type:"button",class:"reopen-btn",onClick:e[0]||(e[0]=t=>f.value=!1),title:"Show team scores"}," â–¾ ")):x("",!0),we(xe,{name:"tracker-slide"},{default:Ce(()=>[f.value?x("",!0):(u(),d("div",Dt,[s("div",Rt,[s("div",Ft,[s("button",{type:"button",class:"stack-btn collapse-btn",onClick:e[1]||(e[1]=t=>f.value=!0),title:"Hide team bar"}," â–´ "),s("button",{type:"button",class:"stack-btn edit-btn",onClick:oe,disabled:m.value<0||m.value>=b.value.length,title:"Edit selected team"}," âœ ",8,Ot),s("button",{type:"button",class:"stack-btn fullscreen-btn",onClick:G,"aria-pressed":A.value,title:A.value?"Close scoreboard view":"Open scoreboard view"}," â›¶ ",8,Bt)]),s("div",Wt,[(u(!0),d(z,null,V(b.value,(t,n)=>(u(),d("button",{key:t.id,class:j(["team-tab",{"is-selected":n===m.value,"is-leader":n===D.value}]),type:"button",onClick:i=>le(n)},[s("div",zt,[s("span",jt,g(t.name||`Team ${n+1}`),1),s("span",Ht,g(t.points),1),t.powerUps&&t.powerUps.length?(u(),d("div",Gt,[(u(!0),d(z,null,V(t.powerUps,(i,M)=>(u(),d("span",{key:`${t.id}-pu-${M}`,class:j(["powerup-chip",[`tier-${i.tier}`,i.scope==="round"?"is-round":"is-next"]])},g(v(i.id,i.label)),3))),128))])):x("",!0)]),D.value===n&&Q.value?(u(),d("span",Vt," ðŸ‘‘ ")):x("",!0)],10,Lt))),128))]),s("div",Yt,[s("button",{class:"side-btn",type:"button",onClick:pe,title:"Remove all perks from all teams"}," ðŸš« "),s("button",{class:"side-btn",type:"button",disabled:!ee.value,onClick:U,title:"Remove team"}," âˆ’ ",8,qt),s("button",{class:"side-btn",type:"button",disabled:!de.value,onClick:ye,title:"Add team"}," ï¼‹ ",8,Xt)])]),h.value&&m.value!==-1?(u(),d("div",{key:0,class:"edit-panel",ref_key:"editPanelRef",ref:se},[s("div",Jt,[s("label",null,[e[4]||(e[4]=Ee(" Team name ",-1)),me(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>_.name=t),type:"text",maxlength:"24"},null,512),[[Re,_.name]])])]),s("div",Kt,[s("label",null,[e[5]||(e[5]=Ee(" Points ",-1)),me(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>_.points=t),type:"number",step:"1"},null,512),[[Re,_.points,void 0,{number:!0}]])])]),_.powerUps&&_.powerUps.length?(u(),d("div",Zt,[s("label",null,[e[7]||(e[7]=Ee(" Power-ups ",-1)),s("div",Qt,[(u(!0),d(z,null,V(_.powerUps,(t,n)=>(u(),d("button",{key:`edit-pu-${n}-${t.id}`,type:"button",class:"edit-powerup-chip",onClick:i=>J(n)},[s("span",ta,g(v(t.id,t.label)),1),e[6]||(e[6]=s("span",{class:"chip-remove"},"âœ•",-1))],8,ea))),128))])])])):x("",!0),s("div",aa,[s("button",{type:"button",class:"btn small danger",disabled:!ee.value,onClick:q}," Delete ",8,sa),s("button",{type:"button",class:"btn small primary",onClick:H}," Save ")])],512)):x("",!0)]))]),_:1}),(u(),Me($e,{to:"body"},[A.value?(u(),d("div",{key:0,class:"fullscreen-overlay",onClick:K(F,["self"])},[s("div",na,[s("header",{class:"fullscreen-header"},[e[8]||(e[8]=s("h2",{class:"fullscreen-title"}," Team Scores ",-1)),s("button",{type:"button",class:"btn small secondary",onClick:F}," Close ")]),s("div",la,[(u(!0),d(z,null,V(b.value,(t,n)=>(u(),d("article",{key:t.id,class:j(["fullscreen-card",{"is-leader":n===D.value}])},[n===D.value&&Q.value?(u(),d("div",oa," ðŸ‘‘ ")):x("",!0),s("div",ia,g(t.name||`Team ${n+1}`),1),s("div",ra,g(t.points),1)],2))),128))])])])):x("",!0)])),(u(),Me($e,{to:"body"},[R.value?(u(),d("div",{key:0,class:"fullscreen-overlay",onClick:K(o,["self"])},[s("div",ua,[s("header",ca,[s("h2",da,g(fe.value),1),s("button",{type:"button",class:"btn small secondary",onClick:o}," Cancel ")]),s("p",va,g(_e.value),1),s("div",pa,[(u(!0),d(z,null,V(b.value,(t,n)=>(u(),d("article",{key:"effect-"+t.id,class:j(["fullscreen-card",{"is-leader":n===D.value,"is-disabled":n===R.value?.sourceIndex}]),onClick:i=>r(n)},[n===D.value&&Q.value?(u(),d("div",ma," ðŸ‘‘ ")):x("",!0),s("div",ya,g(t.name||`Team ${n+1}`),1),s("div",ha,g(t.points),1)],10,fa))),128))])])])):x("",!0)])),(u(),Me($e,{to:"body"},[we(xe,{name:"rain-pop"},{default:Ce(()=>[N.value?(u(),d("div",_a,[...e[9]||(e[9]=[s("div",{class:"rain-label"}," ðŸŒ§ï¸ Rain of Points! ðŸŒˆ ",-1)])])):x("",!0)]),_:1})]))])):x("",!0)}}),ga=Ie(ba,[["__scopeId","data-v-4f7c7d59"]]),wa="/TaiyakiEduGames/assets/spinning_sfx-B-LM3m4d.mp3",ka="/TaiyakiEduGames/assets/mystery-machine-a5NpraJ-.mp3",Ta=["aria-expanded"],Ma={class:"menu-row"},Ca={class:"menu-row"},xa={class:"menu-row"},Sa={class:"menu-row"},$a={class:"mute-row"},Ea=["aria-pressed"],Pa={class:"label-cell row"},Aa=["onClick","onKeydown"],Ua={class:"face back"},Ia=.35,Be="random-points-settings",Pe=4,be=6,Na=150,Da=110,Ra=Ae({__name:"RandomPoints",setup(ke){const ae=p(!1),O=p(null),Y=p(!1),E=p(null),T=p(!1),c=p(!0),m=p(!1),h=p(!0),A=p(!1);p(!1);const f=p(!1),N=Pe*be,B=["A","B","C","D","E","F"],_=p(Array.from({length:N},(l,o)=>({id:o,value:0,display:"",revealed:!1}))),se=p(typeof window<"u"?window.innerHeight:800),L=p(typeof window<"u"?window.innerWidth:1280),P=Je(),b=()=>P.back();function ne(){ae.value=!1}function I(){const l=O.value;if(!l||typeof l.getHeldPowersForSelected!="function")return[];const o=l.getHeldPowersForSelected();return Array.isArray(o)?o:[]}function w(l){const o=O.value,r=I(),v=r.some(t=>t.id==="t3_triple_next"),S=r.some(t=>t.id==="t2_double_next");let a=1;v?a=3:S&&(a=2);const e=l*a;if(a>1&&o&&typeof o.consumeHeldPower=="function"){const t=v?"t3_triple_next":"t2_double_next";o.consumeHeldPower(t)}return e}function le(l){if(!l||!l.effect||!Y.value||!O.value)return;const o=O.value,r={id:l.effect.id,tier:l.effect.tier,label:l.effect.label,source:"mystery",wager:l.wager};typeof o.resolveImmediateMysteryEffect=="function"&&o.resolveImmediateMysteryEffect(r)||typeof o.addPrizeToSelected=="function"&&o.addPrizeToSelected(r)}function oe(l){if(!l||typeof l.pointsDelta!="number"||!Y.value)return;const o=l.pointsDelta;o!==0&&O.value?.applyDeltaToSelected(o)}function H(l){Y.value=!!l}const Z=$(()=>{const l=L.value;return l<=360?22:l<=420?24:l<=520?26:l<=680?28:30}),D=$(()=>{const l=L.value;return l<=360?6:l<=420?7:l<=520?8:l<=680?9:10}),Q=$(()=>({"--labelW":`${Z.value}px`,"--gap":`${D.value}px`})),de=$(()=>({height:`${Math.max(320,se.value-Na-Da)}px`,gridTemplateColumns:`var(--labelW) repeat(${be}, 1fr)`,gridTemplateRows:`repeat(${Pe}, 1fr)`,gap:"var(--gap)"})),ee=$(()=>({gridTemplateColumns:`var(--labelW) repeat(${be}, 1fr)`,gap:"var(--gap)"})),ye=(l,o)=>(l-1)*be+(o-1),U=(l,o)=>_.value[ye(l,o)],q=l=>l==="Mystery Machine",X=l=>l==="Tornado";function J(l){return typeof l=="number"?l>0?"val-pos":l<0?"val-neg":"val-zero":l==="Mystery Machine"?"val-mystery val-text":l==="Tornado"?"val-tornado val-text":"val-text"}function G(l,o){return Math.floor(Math.random()*(o-l+1))+l}const F={positive:new Audio(Le),negative:new Audio(He),swap:new Audio(wa),loseAll:new Audio(je),jackpot:new Audio(ze),mystery:new Audio(ka)};function ve(){const l=f.value?0:Ia;F.positive.volume=l,F.negative.volume=l,F.swap.volume=l,F.loseAll.volume=l,F.jackpot.volume=l,F.mystery.volume=l}function k(l){const o=F[l];try{o.currentTime=0,o.play()}catch{}}function te(){f.value=!f.value,ve(),fe()}function ie(){const l=[],r=m.value?200:100;l.push(r);let v=N-l.length;if(h.value&&v>0){const t=G(2,4),n=Math.min(t,v);for(let i=0;i<n;i++)l.push("Mystery Machine");v=N-l.length}if(A.value&&v>0){const t=G(2,4),n=Math.min(t,v);for(let i=0;i<n;i++)l.push("Tornado");v=N-l.length}const S=N-l.length;let a=S,e=0;c.value&&(a=Math.floor(S*.7),e=S-a);for(let t=0;t<a;t++){const n=10*G(1,10),i=m.value?n*2:n;l.push(i)}for(let t=0;t<e;t++){const n=-10*G(1,5),i=m.value?n*2:n;l.push(i)}for(let t=l.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[l[t],l[n]]=[l[n],l[t]]}return l}function re(){const l=ie();for(let o=0;o<N;o++){const r=l[o],v=_.value[o];v.value=r,v.display=typeof r=="number"?String(r):r,v.revealed=!1}}function ue(l){if(!l||l.revealed)return;if(typeof l.value=="string")l.value==="Mystery Machine"?k("mystery"):l.value==="Tornado"?k("swap"):k("mystery");else{const a=m.value?200:100;l.value===a?k("jackpot"):l.value>0?k("positive"):k("negative")}if(l.revealed=!0,typeof l.value=="string"){if(l.value==="Tornado"){const S=O.value;S&&typeof S.shuffleAllTeamPoints=="function"?S.shuffleAllTeamPoints():console.warn("[RandomPoints] Tornado card revealed, but TeamPointsTracker.shuffleAllTeamPoints() not found.")}return}if(!Y.value)return;const o=O.value;if(!o)return;const r=l.value,v=w(r);o.applyDeltaToSelected(v)}function he(){for(const l of _.value)l.revealed=!0}function pe(){re()}function R(){T.value=!T.value}function fe(){localStorage.setItem(Be,JSON.stringify({allowNegatives:c.value,doublePoints:m.value,allowSpecial:h.value,allowTornado:A.value,sfxMuted:f.value}))}function _e(){fe(),re(),T.value=!1}function ce(){se.value=window.innerHeight,L.value=window.innerWidth}return We(()=>{try{const l=localStorage.getItem(Be);if(l){const o=JSON.parse(l);typeof o.allowNegatives=="boolean"&&(c.value=o.allowNegatives),typeof o.doublePoints=="boolean"&&(m.value=o.doublePoints),typeof o.allowSpecial=="boolean"&&(h.value=o.allowSpecial),typeof o.allowTornado=="boolean"&&(A.value=o.allowTornado),typeof o.sfxMuted=="boolean"&&(f.value=o.sfxMuted)}}catch{}ve(),re(),ce(),window.addEventListener("resize",ce,{passive:!0})}),Ue(()=>{window.removeEventListener("resize",ce)}),(l,o)=>(u(),d("section",{class:"random-points-page app-bg",style:ge(Q.value)},[we(ga,{ref_key:"teamTracker",ref:O,onTeamSelected:H},null,512),s("button",{class:"icon-btn back",type:"button",onClick:b,"aria-label":"Back",title:"Back"},[...o[7]||(o[7]=[s("img",{class:"icon",src:Ke,alt:""},null,-1)])]),s("button",{class:"icon-btn settings",type:"button",onClick:R,"aria-haspopup":"dialog","aria-expanded":T.value,"aria-controls":"settings-menu","aria-label":"Open settings",title:"Settings"},[...o[8]||(o[8]=[s("img",{class:"icon",src:Ze,alt:""},null,-1)])],8,Ta),s("button",{class:"icon-btn mystery",type:"button",onClick:o[0]||(o[0]=r=>ae.value=!0),"aria-label":"Open Mystery Machine",title:"Mystery Machine"},[...o[9]||(o[9]=[s("img",{class:"icon",src:et,alt:""},null,-1)])]),ae.value?(u(),Me(It,{key:0,maxWager:E.value,onClose:ne,onResolved:oe,onEffectOpened:le},null,8,["maxWager"])):x("",!0),T.value?(u(),d("div",{key:1,class:"settings-overlay",role:"presentation",onClick:o[6]||(o[6]=r=>T.value=!1)},[s("div",{id:"settings-menu",class:"settings-menu",role:"dialog","aria-modal":"true",onClick:o[5]||(o[5]=K(()=>{},["stop"]))},[o[14]||(o[14]=s("h3",{class:"menu-title"},"Settings",-1)),s("label",Ma,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[1]||(o[1]=r=>c.value=r)},null,512),[[Te,c.value]]),o[10]||(o[10]=s("span",null,"Negative Numbers",-1))]),s("label",Ca,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=r=>m.value=r)},null,512),[[Te,m.value]]),o[11]||(o[11]=s("span",null,"Double Points",-1))]),s("label",xa,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[3]||(o[3]=r=>A.value=r)},null,512),[[Te,A.value]]),o[12]||(o[12]=s("span",null,"Tornado Cards",-1))]),s("label",Sa,[me(s("input",{type:"checkbox","onUpdate:modelValue":o[4]||(o[4]=r=>h.value=r)},null,512),[[Te,h.value]]),o[13]||(o[13]=s("span",null,"Mystery Machine Cards",-1))]),s("div",$a,[s("button",{class:"mute-btn","aria-pressed":f.value,onClick:te},g(f.value?"Unmute SFX":"Mute SFX"),9,Ea)]),s("button",{class:"apply",onClick:_e},"Apply")])])):x("",!0),o[17]||(o[17]=s("h1",{class:"title"},null,-1)),s("div",{class:"labels",style:ge(ee.value)},[o[15]||(o[15]=s("div",null,null,-1)),(u(),d(z,null,V(B,r=>s("div",{key:r,class:"label-cell"},g(r),1)),64))],4),s("div",{class:"grid",style:ge(de.value)},[(u(),d(z,null,V(Pe,r=>(u(),d(z,{key:`r-${r}`},[s("div",Pa,g(r),1),(u(),d(z,null,V(be,v=>s("div",{key:`c-${r}-${v}`,class:"grid-item"},[s("div",{class:j(["card",{"mystery-card":q(U(r,v).value),"mystery-card--revealed":q(U(r,v).value)&&U(r,v).revealed,"tornado-card":X(U(r,v).value),"tornado-card--revealed":X(U(r,v).value)&&U(r,v).revealed}]),role:"button",tabindex:"0",onClick:K(S=>ue(U(r,v)),["stop"]),onKeydown:[Fe(K(S=>ue(U(r,v)),["prevent"]),["enter"]),Fe(K(S=>ue(U(r,v)),["prevent"]),["space"])]},[s("div",{class:j(["flip-inner",{revealed:U(r,v).revealed}])},[o[16]||(o[16]=s("div",{class:"face front"},null,-1)),s("div",Ua,[s("span",{class:j(["value",J(U(r,v).value)])},g(U(r,v).display),3)])],2)],42,Aa)])),64))],64))),64))],4),s("div",{class:"controls"},[s("button",{class:"big-btn",onClick:pe},"Reset"),s("button",{class:"big-btn",onClick:he},"See All")])],4))}}),ja=Ie(Ra,[["__scopeId","data-v-46659d43"]]);export{ja as default};
