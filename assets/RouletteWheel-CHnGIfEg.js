import{d as et,r as u,a5 as tt,c as nt,o as at,Q as lt,g as st,a as he,b as l,x as ge,v as be,e as ot,n as it,t as we,w as Se,T as xe,u as rt,f as ye,E as P,a0 as _e,l as Me,G as ne,a6 as ut,_ as ct}from"./index-DsfmNCgp.js";import{b as dt}from"./back-icon-xKqy7r3s.js";import{s as ft}from"./settings-icon-DJLQOoae.js";const mt={class:"roulette-page"},pt=["src"],vt=["aria-expanded"],ht=["src"],gt={class:"wheel-container"},bt=["disabled"],wt={key:0,class:"muted"},St={class:"popup",role:"dialog","aria-modal":"true","aria-labelledby":"popupText"},xt={class:"popup-card"},yt={id:"popupText",class:"pop-value"},_t={class:"popup-card settings-card"},Mt={class:"row"},It={class:"controls-inline"},kt={class:"row"},Tt={class:"controls-inline"},Nt={class:"actions"},At={class:"actions-left"},Ct=["disabled"],Rt=6e3,Ie=1.25,Bt=6,ke=100,Pt=et({__name:"RouletteWheel",setup(Et){const ae=rt(),F=u(null);let I=null;const k=u(E("rw_start",1)),T=u(E("rw_end",32)),N=u(H("rw_exclude","")),s=u(Ce()),x=u(!1),g=u(!1),b=u(!1),A=u(null),y=u(re());let C=-Math.PI/2,_=C,W=0,L=0,w=null;const Te=new Audio(tt),le=u("sample"),se=u("single"),oe=u(.25),Ne=u([ut]);let G=null,m=[],q=0;const ie=u(null);let J=null;function Ae(){window.history.length>1?ae.back():ae.push("/")}function H(t,n){try{return localStorage.getItem(t)??n}catch{return n}}function E(t,n){const e=H(t,String(n)),a=Number(e);return Number.isFinite(a)?a:n}function Ce(){try{const t=localStorage.getItem("rw_numbers");if(!t)return $(E("rw_start",1),E("rw_end",32),H("rw_exclude",""));const n=JSON.parse(t);if(Array.isArray(n)&&n.every(e=>Number.isInteger(e)))return n}catch{}return $(1,32,"")}function Re(){try{localStorage.setItem("rw_start",String(k.value)),localStorage.setItem("rw_end",String(T.value)),localStorage.setItem("rw_exclude",N.value)}catch{}}function z(){try{localStorage.setItem("rw_numbers",JSON.stringify(s.value))}catch{}}function Be(t){return t.split(",").map(n=>Number(n.trim())).filter(n=>Number.isInteger(n))}function $(t,n,e){let a=Math.min(t,n),o=Math.max(t,n);const i=new Set(Be(e)),c=[];for(let d=a;d<=o;d++)i.has(d)||c.push(d);return c}function Pe(){const t=$(k.value,T.value,N.value);if(t.length>ke){alert(`You must have ${ke} segments or less.`);return}Re(),JSON.stringify(t)!==JSON.stringify(s.value)&&(s.value=t,z(),h(S()))}function Ee(){Pe(),R()}function ze(){if(s.value.length){for(let t=s.value.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[s.value[t],s.value[n]]=[s.value[n],s.value[t]]}z(),h(S()),R()}}function re(){const t=Math.max(320,Math.min(window.innerWidth,1600)),n=Math.max(400,Math.min(window.innerHeight,1200)),e=Math.round(Math.min(t,n)*.72);return Math.max(300,Math.min(720,e))}function j(){const t=F.value;if(!t)return;const n=y.value,e=window.devicePixelRatio||1;t.style.width=n+"px",t.style.height=n+"px",t.width=Math.floor(n*e),t.height=Math.floor(n*e),I=t.getContext("2d"),I&&(I.setTransform(1,0,0,1,0,0),I.scale(e,e))}function $e(){const t=re();t!==y.value&&(y.value=t,j(),h(S()))}function De(t){return t>=1?1:1-Math.pow(2,-10*t)}function S(){if(!x.value)return _;const t=performance.now(),n=Math.min(1,(t-W)/L),e=De(n);return C+(_-C)*e}function Ue(){const t=Math.random(),n=t*t*(3-2*t);return Ie+n*(Bt-Ie)}function h(t){const n=F.value;if(!n)return null;const e=I??n.getContext("2d");if(!e)return null;const a=y.value,o=a,i=a;if(e.clearRect(0,0,o,i),s.value.length===0)return null;const c=s.value.length,d=2*Math.PI/c,p=o/2,v=i/2,f=Math.round(a*.45),fe=[];for(let r=0;r<c;r++){const O=((t+r*d+d/2)*180/Math.PI+360)%360;fe.push({index:r,angleDeg:O})}const M=ue(fe,270);ie.value=M;const Xe=210,Ke=8,D=50,me=62,Y=54,Qe=performance.now(),U=.62+.38*Math.abs(Math.sin(Qe/160));for(let r=0;r<c;r++){const B=t+r*d,O=B+d,Ye=B+d/2,V=Xe+(r%4-1.5)*(Ke/1),Ze=`hsl(${V} ${D}% ${r%2===0?me:Y}%)`;if(e.beginPath(),e.moveTo(p,v),e.arc(p,v,f,B,O),e.closePath(),r===M){const te=e.createRadialGradient(p,v,f*.18,p,v,f);te.addColorStop(0,`hsla(${V} ${D+10}% ${me+8}% / ${.9*U})`),te.addColorStop(1,`hsla(${V} ${D+10}% ${Y-8}% / ${.92*U})`),e.fillStyle=te,e.shadowColor=`hsla(${V} ${D+25}% ${Y-14}% / ${.9*U})`,e.shadowBlur=24*U}else e.fillStyle=Ze,e.shadowBlur=0;e.fill(),e.strokeStyle="rgba(0,0,0,.18)",e.lineWidth=1,e.stroke(),r===M&&(e.save(),e.beginPath(),e.arc(p,v,f,B,O),e.strokeStyle="rgba(255,255,255,.95)",e.lineWidth=Math.max(3,f*.035),e.shadowColor="rgba(160,200,255,.9)",e.shadowBlur=20,e.stroke(),e.restore()),e.save(),e.translate(p,v),e.rotate(Ye),e.textAlign="center",e.textBaseline="middle";const pe=Math.max(14,Math.min(22,f*.12)),ve=r===M?pe*1.35:pe;e.font=`800 ${ve}px system-ui, -apple-system, Segoe UI, Arial`;const ee=f-Math.max(34,f*.2);r===M?(e.lineJoin="round",e.miterLimit=2,e.strokeStyle="rgba(255,255,255,.95)",e.lineWidth=Math.max(3,ve*.14),e.strokeText(String(s.value[r]),ee,0),e.fillStyle="#0b1a2b",e.fillText(String(s.value[r]),ee,0)):(e.fillStyle="rgba(0,0,0,.82)",e.fillText(String(s.value[r]),ee,0)),e.restore()}e.beginPath(),e.arc(p,v,Math.max(10,f*.06),0,2*Math.PI);const Z=e.createRadialGradient(p,v,2,p,v,f*.08);return Z.addColorStop(0,"#ffffff"),Z.addColorStop(1,"#e8edf6"),e.fillStyle=Z,e.fill(),e.strokeStyle="rgba(0,0,0,.15)",e.stroke(),M}function ue(t,n=270){if(!t.length)return null;let e=0,a=360;for(let o=0;o<t.length;o++){let i=Math.abs((t[o].angleDeg-n+360)%360);i>180&&(i=360-i),i<a&&(a=i,e=o)}return t[e].index}function X(){if(s.value.length===0||x.value||g.value||b.value)return;K()&&Fe();const n=Ue(),e=Math.random()*(2*Math.PI);C=S(),_=C+n*(2*Math.PI)+e,L=Rt,W=performance.now(),x.value=!0,J=null,w=requestAnimationFrame(ce)}function ce(){const t=performance.now(),n=Math.min(1,(t-W)/L),e=S(),a=h(e);a!==null&&a!==J&&(J=a,Le()),n<1?w=requestAnimationFrame(ce):(x.value=!1,w&&cancelAnimationFrame(w),w=null,h(_),setTimeout(Oe,280))}function Oe(){if(s.value.length===0)return;const t=s.value.length,n=2*Math.PI/t,e=[];for(let o=0;o<t;o++){const c=((_+o*n+n/2)*180/Math.PI+360)%360;e.push({index:o,angleDeg:c})}const a=ue(e,270);ie.value=a,A.value=a==null?null:s.value[a]??null;try{const o=Te;o.currentTime=0,o.play()}catch{}g.value=!0}function K(){const t=window.AudioContext||window.webkitAudioContext;if(!t)return null;G||(G=new t);const n=G;return n.state==="suspended"&&n.resume(),n}async function Ve(t){const n=K();if(!n)return null;try{const a=await(await fetch(t)).arrayBuffer();return await n.decodeAudioData(a)}catch{return null}}async function Fe(){if(m.length||le.value!=="sample")return;const t=Ne.value.slice();m=(await Promise.all(t.map(e=>Ve(e)))).filter(e=>!!e),q=0}function We(){if(!m.length)return null;if(se.value==="single")return m[0];if(se.value==="random"){const n=Math.floor(Math.random()*m.length);return m[n]}const t=m[q%m.length];return q++,t}function Le(){const t=K();if(t){if(le.value==="sample"&&m.length){const n=We();if(n){const e=t.createBufferSource();e.buffer=n;const a=t.createGain();a.gain.value=oe.value,e.connect(a).connect(t.destination),e.start();return}}Ge(t)}}function Ge(t){const n=t.createOscillator(),e=t.createGain(),a=t.currentTime,o=1100,i=(Math.random()-.5)*120;n.type="square",n.frequency.setValueAtTime(o+i,a);const c=Math.max(.05,Math.min(1,oe.value));e.gain.setValueAtTime(0,a),e.gain.linearRampToValueAtTime(.22*c,a+.006),e.gain.exponentialRampToValueAtTime(1e-4,a+.07),n.connect(e).connect(t.destination),n.start(a),n.stop(a+.08)}function qe(){b.value=!0}function R(){b.value=!1}function Je(){A.value!=null&&(s.value=s.value.filter(t=>t!==A.value),z(),g.value=!1,h(S()))}function de(){g.value=!1}const He=nt(()=>A.value==null?"":String(A.value));at(()=>{s.value.length||(s.value=$(k.value,T.value,N.value),z()),j(),h(_);const t=e=>{e.code==="Space"&&!g.value&&!b.value&&(e.preventDefault(),X()),e.code==="Escape"&&(g.value?(e.preventDefault(),de()):b.value&&(e.preventDefault(),R()))},n=je($e,100);window.addEventListener("keydown",t),window.addEventListener("resize",n),Q.push(()=>window.removeEventListener("keydown",t)),Q.push(()=>window.removeEventListener("resize",n))}),lt([s,y],()=>{j(),h(S())});const Q=[];st(()=>{w&&cancelAnimationFrame(w),Q.forEach(t=>t())});function je(t,n){let e=0,a=null;return function(...o){const i=Date.now();i-e>=n?(e=i,t.apply(this,o)):a||(a=window.setTimeout(()=>{e=Date.now(),a=null,t.apply(this,o)},n-(i-e)))}}return(t,n)=>(ye(),he("section",mt,[l("button",{class:"home-button",type:"button",onClick:Ae,"aria-label":"Back"},[l("img",{src:be(dt),alt:""},null,8,pt)]),l("button",{class:"settings-button",type:"button",onClick:qe,"aria-label":"Open settings","aria-expanded":b.value?"true":"false","aria-controls":"settingsModal"},[l("img",{src:be(ft),alt:""},null,8,ht)],8,vt),l("div",gt,[l("div",{class:"wheel-wrap",style:it({"--wheel-size":y.value+"px"}),onClick:X},[n[3]||(n[3]=l("div",{class:"indicator","aria-hidden":"true"},null,-1)),l("canvas",{ref_key:"canvasEl",ref:F,class:"wheel"},null,512)],4),l("button",{id:"spinButton",class:"spin-btn",type:"button",disabled:s.value.length===0||x.value,onClick:X,"aria-live":"polite"},we(x.value?"SPINNINGâ€¦":"SPIN"),9,bt),s.value.length===0?(ye(),he("p",wt,"No values. Open settings to set a range.")):ot("",!0)]),ge(xe,{name:"fade-zoom"},{default:Se(()=>[P(l("div",St,[l("div",xt,[l("h2",yt,we(He.value),1),l("div",{class:"pop-actions"},[l("button",{class:"btn subtle",type:"button",onClick:Je},"Remove Value"),l("button",{class:"btn",type:"button",onClick:de},"Continue")])])],512),[[_e,g.value]])]),_:1}),ge(xe,{name:"fade-zoom"},{default:Se(()=>[P(l("div",{class:"popup",role:"dialog","aria-modal":"true","aria-labelledby":"settingsTitle",id:"settingsModal",onClick:Me(R,["self"])},[l("div",_t,[n[8]||(n[8]=l("h2",{id:"settingsTitle",class:"settings-title"},"Settings",-1)),l("form",{class:"settings-form",onSubmit:Me(Ee,["prevent"])},[l("div",Mt,[n[5]||(n[5]=l("label",{for:"startNum",class:"lbl"},"Range:",-1)),l("div",It,[P(l("input",{id:"startNum",class:"num",type:"number","onUpdate:modelValue":n[0]||(n[0]=e=>k.value=e),min:"1",inputmode:"numeric"},null,512),[[ne,k.value,void 0,{number:!0}]]),n[4]||(n[4]=l("span",{class:"dash"},"-",-1)),P(l("input",{id:"endNum",class:"num",type:"number","onUpdate:modelValue":n[1]||(n[1]=e=>T.value=e),min:"1",inputmode:"numeric"},null,512),[[ne,T.value,void 0,{number:!0}]])])]),l("div",kt,[n[6]||(n[6]=l("label",{for:"excludeInput",class:"lbl"},"Exclude:",-1)),l("div",Tt,[P(l("input",{id:"excludeInput",class:"ex-input",type:"text","onUpdate:modelValue":n[2]||(n[2]=e=>N.value=e),placeholder:"e.g., 3,7,15","aria-label":"Exclude numbers"},null,512),[[ne,N.value,void 0,{trim:!0}]])])]),l("div",Nt,[l("div",At,[l("button",{class:"btn rand sm",type:"button",disabled:s.value.length===0,onClick:ze,"aria-label":"Randomize the order of values on the wheel"}," Randomize ",8,Ct)]),l("div",{class:"actions-right"},[l("button",{class:"btn subtle sm",type:"button",onClick:R},"Cancel"),n[7]||(n[7]=l("button",{class:"btn sm",type:"submit"},"Update",-1))])])],32)])],512),[[_e,b.value]])]),_:1})]))}}),Ut=ct(Pt,[["__scopeId","data-v-a5fed2f8"]]);export{Ut as default};
